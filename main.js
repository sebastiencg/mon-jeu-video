(()=>{"use strict";var e=Object.defineProperty,t=(t,n)=>e(t,"name",{value:n,configurable:!0}),n=(t,n,r)=>(((t,n,r)=>{n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[n]=r})(t,"symbol"!=typeof n?n+"":n,r),r),r=(()=>{for(var e=new Uint8Array(128),t=0;t<64;t++)e[t<26?t+65:t<52?t+71:t<62?t-4:4*t-205]=t;return t=>{for(var n=t.length,r=new Uint8Array(3*(n-("="==t[n-1])-("="==t[n-2]))/4|0),i=0,s=0;i<n;){var o=e[t.charCodeAt(i++)],a=e[t.charCodeAt(i++)],l=e[t.charCodeAt(i++)],h=e[t.charCodeAt(i++)];r[s++]=o<<2|a>>4,r[s++]=a<<4|l>>2,r[s++]=l<<6|h}return r}})();function i(e){return e*Math.PI/180}function s(e){return 180*e/Math.PI}function o(e,t,n){return t>n?o(e,n,t):Math.min(Math.max(e,t),n)}function a(e,t,n){if("number"==typeof e&&"number"==typeof t)return e+(t-e)*n;if(e instanceof u&&t instanceof u)return e.lerp(t,n);if(e instanceof f&&t instanceof f)return e.lerp(t,n);throw new Error(`Bad value for lerp(): ${e}, ${t}. Only number, Vec2 and Color is supported.`)}function l(e,t,n,r,i){return r+(e-t)/(n-t)*(i-r)}function h(e,t,n,r,i){return o(l(e,t,n,r,i),r,i)}t(i,"deg2rad"),t(s,"rad2deg"),t(o,"clamp"),t(a,"lerp"),t(l,"map"),t(h,"mapc");var d=class{x=0;y=0;constructor(e=0,t=e){this.x=e,this.y=t}static fromAngle(e){let t=i(e);return new d(Math.cos(t),Math.sin(t))}clone(){return new d(this.x,this.y)}add(...e){let t=c(...e);return new d(this.x+t.x,this.y+t.y)}sub(...e){let t=c(...e);return new d(this.x-t.x,this.y-t.y)}scale(...e){let t=c(...e);return new d(this.x*t.x,this.y*t.y)}dist(...e){let t=c(...e);return this.sub(t).len()}sdist(...e){let t=c(...e);return this.sub(t).slen()}len(){return Math.sqrt(this.dot(this))}slen(){return this.dot(this)}unit(){let e=this.len();return 0===e?new d(0):this.scale(1/e)}normal(){return new d(this.y,-this.x)}reflect(e){return this.sub(e.scale(2*this.dot(e)))}project(e){return e.scale(e.dot(this)/e.len())}reject(e){return this.sub(this.project(e))}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}angle(...e){let t=c(...e);return s(Math.atan2(this.y-t.y,this.x-t.x))}angleBetween(...e){let t=c(...e);return s(Math.atan2(this.cross(t),this.dot(t)))}lerp(e,t){return new d(a(this.x,e.x,t),a(this.y,e.y,t))}slerp(e,t){let n=this.dot(e),r=this.cross(e),i=Math.atan2(r,n);return this.scale(Math.sin((1-t)*i)).add(e.scale(Math.sin(t*i))).scale(1/r)}isZero(){return 0===this.x&&0===this.y}toFixed(e){return new d(Number(this.x.toFixed(e)),Number(this.y.toFixed(e)))}transform(e){return e.multVec2(this)}eq(e){return this.x===e.x&&this.y===e.y}bbox(){return new O(this,0,0)}toString(){return`vec2(${this.x.toFixed(2)}, ${this.y.toFixed(2)})`}},u=d;function c(...e){if(1===e.length){if(e[0]instanceof u)return new u(e[0].x,e[0].y);if(Array.isArray(e[0])&&2===e[0].length)return new u(...e[0])}return new u(...e)}t(u,"Vec2"),n(u,"LEFT",new d(-1,0)),n(u,"RIGHT",new d(1,0)),n(u,"UP",new d(0,-1)),n(u,"DOWN",new d(0,1)),t(c,"vec2");var p=class{r=255;g=255;b=255;constructor(e,t,n){this.r=o(e,0,255),this.g=o(t,0,255),this.b=o(n,0,255)}static fromArray(e){return new p(e[0],e[1],e[2])}static fromHex(e){if("number"==typeof e)return new p(e>>16&255,e>>8&255,e>>0&255);if("string"==typeof e){let t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return new p(parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16))}throw new Error("Invalid hex color format")}static fromHSL(e,n,r){if(0==n)return new p(255*r,255*r,255*r);let i=t(((e,t,n)=>(n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+(t-e)*(2/3-n)*6:e)),"hue2rgb"),s=r<.5?r*(1+n):r+n-r*n,o=2*r-s,a=i(o,s,e+1/3),l=i(o,s,e),h=i(o,s,e-1/3);return new p(Math.round(255*a),Math.round(255*l),Math.round(255*h))}clone(){return new p(this.r,this.g,this.b)}lighten(e){return new p(this.r+e,this.g+e,this.b+e)}darken(e){return this.lighten(-e)}invert(){return new p(255-this.r,255-this.g,255-this.b)}mult(e){return new p(this.r*e.r/255,this.g*e.g/255,this.b*e.b/255)}lerp(e,t){return new p(a(this.r,e.r,t),a(this.g,e.g,t),a(this.b,e.b,t))}eq(e){return this.r===e.r&&this.g===e.g&&this.b===e.b}toString(){return`rgb(${this.r}, ${this.g}, ${this.b})`}toHex(){return"#"+((1<<24)+(this.r<<16)+(this.g<<8)+this.b).toString(16).slice(1)}},f=p;function m(...e){if(0===e.length)return new f(255,255,255);if(1===e.length){if(e[0]instanceof f)return e[0].clone();if("string"==typeof e[0])return f.fromHex(e[0]);if(Array.isArray(e[0])&&3===e[0].length)return f.fromArray(e[0])}return new f(...e)}t(f,"Color"),n(f,"RED",new p(255,0,0)),n(f,"GREEN",new p(0,255,0)),n(f,"BLUE",new p(0,0,255)),n(f,"YELLOW",new p(255,255,0)),n(f,"MAGENTA",new p(255,0,255)),n(f,"CYAN",new p(0,255,255)),n(f,"WHITE",new p(255,255,255)),n(f,"BLACK",new p(0,0,0)),t(m,"rgb");var g=t(((e,t,n)=>f.fromHSL(e,t,n)),"hsl2rgb"),w=class{x=0;y=0;w=1;h=1;constructor(e,t,n,r){this.x=e,this.y=t,this.w=n,this.h=r}scale(e){return new w(this.x+this.w*e.x,this.y+this.h*e.y,this.w*e.w,this.h*e.h)}pos(){return new u(this.x,this.y)}clone(){return new w(this.x,this.y,this.w,this.h)}eq(e){return this.x===e.x&&this.y===e.y&&this.w===e.w&&this.h===e.h}toString(){return`quad(${this.x}, ${this.y}, ${this.w}, ${this.h})`}};function A(e,t,n,r){return new w(e,t,n,r)}t(w,"Quad"),t(A,"quad");var y=class{m=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];constructor(e){e&&(this.m=e)}static translate(e){return new y([1,0,0,0,0,1,0,0,0,0,1,0,e.x,e.y,0,1])}static scale(e){return new y([e.x,0,0,0,0,e.y,0,0,0,0,1,0,0,0,0,1])}static rotateX(e){e=i(-e);let t=Math.cos(e),n=Math.sin(e);return new y([1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1])}static rotateY(e){e=i(-e);let t=Math.cos(e),n=Math.sin(e);return new y([t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1])}static rotateZ(e){e=i(-e);let t=Math.cos(e),n=Math.sin(e);return new y([t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1])}translate(e){return this.m[12]+=this.m[0]*e.x+this.m[4]*e.y,this.m[13]+=this.m[1]*e.x+this.m[5]*e.y,this.m[14]+=this.m[2]*e.x+this.m[6]*e.y,this.m[15]+=this.m[3]*e.x+this.m[7]*e.y,this}scale(e){return this.m[0]*=e.x,this.m[4]*=e.y,this.m[1]*=e.x,this.m[5]*=e.y,this.m[2]*=e.x,this.m[6]*=e.y,this.m[3]*=e.x,this.m[7]*=e.y,this}rotate(e){e=i(-e);let t=Math.cos(e),n=Math.sin(e),r=this.m[0],s=this.m[1],o=this.m[4],a=this.m[5];return this.m[0]=r*t+s*n,this.m[1]=-r*n+s*t,this.m[4]=o*t+a*n,this.m[5]=-o*n+a*t,this}mult(e){let t=[];for(let n=0;n<4;n++)for(let r=0;r<4;r++)t[4*n+r]=this.m[0+r]*e.m[4*n+0]+this.m[4+r]*e.m[4*n+1]+this.m[8+r]*e.m[4*n+2]+this.m[12+r]*e.m[4*n+3];return new y(t)}multVec2(e){return new u(e.x*this.m[0]+e.y*this.m[4]+this.m[12],e.x*this.m[1]+e.y*this.m[5]+this.m[13])}getTranslation(){return new u(this.m[12],this.m[13])}getScale(){if(0!=this.m[0]||0!=this.m[1]){let e=this.m[0]*this.m[5]-this.m[1]*this.m[4],t=Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]);return new u(t,e/t)}if(0!=this.m[4]||0!=this.m[5]){let e=this.m[0]*this.m[5]-this.m[1]*this.m[4],t=Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]);return new u(e/t,t)}return new u(0,0)}getRotation(){if(0!=this.m[0]||0!=this.m[1]){let e=Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]);return s(this.m[1]>0?Math.acos(this.m[0]/e):-Math.acos(this.m[0]/e))}if(0!=this.m[4]||0!=this.m[5]){let e=Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]);return s(Math.PI/2-(this.m[5]>0?Math.acos(-this.m[4]/e):-Math.acos(this.m[4]/e)))}return 0}getSkew(){if(0!=this.m[0]||0!=this.m[1]){let e=Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]);return new u(Math.atan(this.m[0]*this.m[4]+this.m[1]*this.m[5])/(e*e),0)}if(0!=this.m[4]||0!=this.m[5]){let e=Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]);return new u(0,Math.atan(this.m[0]*this.m[4]+this.m[1]*this.m[5])/(e*e))}return new u(0,0)}invert(){let e=[],t=this.m[10]*this.m[15]-this.m[14]*this.m[11],n=this.m[9]*this.m[15]-this.m[13]*this.m[11],r=this.m[9]*this.m[14]-this.m[13]*this.m[10],i=this.m[8]*this.m[15]-this.m[12]*this.m[11],s=this.m[8]*this.m[14]-this.m[12]*this.m[10],o=this.m[8]*this.m[13]-this.m[12]*this.m[9],a=this.m[6]*this.m[15]-this.m[14]*this.m[7],l=this.m[5]*this.m[15]-this.m[13]*this.m[7],h=this.m[5]*this.m[14]-this.m[13]*this.m[6],d=this.m[4]*this.m[15]-this.m[12]*this.m[7],u=this.m[4]*this.m[14]-this.m[12]*this.m[6],c=this.m[5]*this.m[15]-this.m[13]*this.m[7],p=this.m[4]*this.m[13]-this.m[12]*this.m[5],f=this.m[6]*this.m[11]-this.m[10]*this.m[7],m=this.m[5]*this.m[11]-this.m[9]*this.m[7],g=this.m[5]*this.m[10]-this.m[9]*this.m[6],w=this.m[4]*this.m[11]-this.m[8]*this.m[7],A=this.m[4]*this.m[10]-this.m[8]*this.m[6],v=this.m[4]*this.m[9]-this.m[8]*this.m[5];e[0]=this.m[5]*t-this.m[6]*n+this.m[7]*r,e[4]=-(this.m[4]*t-this.m[6]*i+this.m[7]*s),e[8]=this.m[4]*n-this.m[5]*i+this.m[7]*o,e[12]=-(this.m[4]*r-this.m[5]*s+this.m[6]*o),e[1]=-(this.m[1]*t-this.m[2]*n+this.m[3]*r),e[5]=this.m[0]*t-this.m[2]*i+this.m[3]*s,e[9]=-(this.m[0]*n-this.m[1]*i+this.m[3]*o),e[13]=this.m[0]*r-this.m[1]*s+this.m[2]*o,e[2]=this.m[1]*a-this.m[2]*l+this.m[3]*h,e[6]=-(this.m[0]*a-this.m[2]*d+this.m[3]*u),e[10]=this.m[0]*c-this.m[1]*d+this.m[3]*p,e[14]=-(this.m[0]*h-this.m[1]*u+this.m[2]*p),e[3]=-(this.m[1]*f-this.m[2]*m+this.m[3]*g),e[7]=this.m[0]*f-this.m[2]*w+this.m[3]*A,e[11]=-(this.m[0]*m-this.m[1]*w+this.m[3]*v),e[15]=this.m[0]*g-this.m[1]*A+this.m[2]*v;let V=this.m[0]*e[0]+this.m[1]*e[4]+this.m[2]*e[8]+this.m[3]*e[12];for(let t=0;t<4;t++)for(let n=0;n<4;n++)e[4*t+n]*=1/V;return new y(e)}clone(){return new y([...this.m])}toString(){return this.m.toString()}};function v(e,t,n,r=Math.sin){return e+(r(n)+1)/2*(t-e)}t(y,"Mat4"),t(v,"wave");var V=2147483648,E=class{seed;constructor(e){this.seed=e}gen(){return this.seed=(1103515245*this.seed+12345)%V,this.seed/V}genNumber(e,t){return e+this.gen()*(t-e)}genVec2(e,t){return new u(this.genNumber(e.x,t.x),this.genNumber(e.y,t.y))}genColor(e,t){return new f(this.genNumber(e.r,t.r),this.genNumber(e.g,t.g),this.genNumber(e.b,t.b))}genAny(...e){if(0===e.length)return this.gen();if(1===e.length){if("number"==typeof e[0])return this.genNumber(0,e[0]);if(e[0]instanceof u)return this.genVec2(c(0,0),e[0]);if(e[0]instanceof f)return this.genColor(m(0,0,0),e[0])}else if(2===e.length){if("number"==typeof e[0]&&"number"==typeof e[1])return this.genNumber(e[0],e[1]);if(e[0]instanceof u&&e[1]instanceof u)return this.genVec2(e[0],e[1]);if(e[0]instanceof f&&e[1]instanceof f)return this.genColor(e[0],e[1])}}};t(E,"RNG");var x=new E(Date.now());function b(e){return null!=e&&(x.seed=e),x.seed}function S(...e){return x.genAny(...e)}function R(...e){return Math.floor(S(...e))}function M(e){return S()<=e}function T(e){return e[R(e.length)]}function F(e,t){return e.pos.x+e.width>t.pos.x&&e.pos.x<t.pos.x+t.width&&e.pos.y+e.height>t.pos.y&&e.pos.y<t.pos.y+t.height}function B(e,t){if(e.p1.x===e.p2.x&&e.p1.y===e.p2.y||t.p1.x===t.p2.x&&t.p1.y===t.p2.y)return null;let n=(t.p2.y-t.p1.y)*(e.p2.x-e.p1.x)-(t.p2.x-t.p1.x)*(e.p2.y-e.p1.y);if(0===n)return null;let r=((t.p2.x-t.p1.x)*(e.p1.y-t.p1.y)-(t.p2.y-t.p1.y)*(e.p1.x-t.p1.x))/n,i=((e.p2.x-e.p1.x)*(e.p1.y-t.p1.y)-(e.p2.y-e.p1.y)*(e.p1.x-t.p1.x))/n;return r<0||r>1||i<0||i>1?null:r}function P(e,t){let n=B(e,t);return n?c(e.p1.x+n*(e.p2.x-e.p1.x),e.p1.y+n*(e.p2.y-e.p1.y)):null}function I(e,t){if(C(e,t.p1)||C(e,t.p2))return!0;let n=e.points();return!!(P(t,new G(n[0],n[1]))||P(t,new G(n[1],n[2]))||P(t,new G(n[2],n[3]))||P(t,new G(n[3],n[0])))}function C(e,t){return t.x>e.pos.x&&t.x<e.pos.x+e.width&&t.y>e.pos.y&&t.y<e.pos.y+e.height}function k(e,t){let n=t.sub(e.p1),r=e.p2.sub(e.p1);if(Math.abs(n.cross(r))>Number.EPSILON)return!1;let i=n.dot(r)/r.dot(r);return i>=0&&i<=1}function U(e,t){let n=e.p2.sub(e.p1),r=n.dot(n),i=e.p1.sub(t.center),s=2*n.dot(i),o=s*s-4*r*(i.dot(i)-t.radius*t.radius);if(r<=Number.EPSILON||o<0)return!1;if(0==o){let e=-s/(2*r);if(e>=0&&e<=1)return!0}else{let e=(-s+Math.sqrt(o))/(2*r),t=(-s-Math.sqrt(o))/(2*r);if(e>=0&&e<=1||t>=0&&t<=1)return!0}return D(t,e.p1)}function D(e,t){return e.center.sdist(t)<e.radius*e.radius}function L(e,t){let n=t.pts[t.pts.length-1];for(let r of t.pts){if(U(new G(n,r),e))return!0;n=r}return!!D(e,t.pts[0])||N(t,e.center)}function N(e,t){let n=!1,r=e.pts;for(let e=0,i=r.length-1;e<r.length;i=e++)r[e].y>t.y!=r[i].y>t.y&&t.x<(r[i].x-r[e].x)*(t.y-r[e].y)/(r[i].y-r[e].y)+r[e].x&&(n=!n);return n}t(b,"randSeed"),t(S,"rand"),t(R,"randi"),t(M,"chance"),t(T,"choose"),t(F,"testRectRect"),t(B,"testLineLineT"),t(P,"testLineLine"),t(I,"testRectLine"),t(C,"testRectPoint"),t(k,"testLinePoint"),t(U,"testLineCircle"),t(D,"testCirclePoint"),t(L,"testCirclePolygon"),t(N,"testPolygonPoint");var G=class{p1;p2;constructor(e,t){this.p1=e.clone(),this.p2=t.clone()}transform(e){return new G(e.multVec2(this.p1),e.multVec2(this.p2))}bbox(){return O.fromPoints(this.p1,this.p2)}area(){return this.p1.dist(this.p2)}clone(){return new G(this.p1,this.p2)}};t(G,"Line");var O=class{pos;width;height;constructor(e,t,n){this.pos=e.clone(),this.width=t,this.height=n}static fromPoints(e,t){return new O(e.clone(),t.x-e.x,t.y-e.y)}center(){return new u(this.pos.x+this.width/2,this.pos.y+this.height/2)}points(){return[this.pos,this.pos.add(this.width,0),this.pos.add(this.width,this.height),this.pos.add(0,this.height)]}transform(e){return new K(this.points().map((t=>e.multVec2(t))))}bbox(){return this.clone()}area(){return this.width*this.height}clone(){return new O(this.pos.clone(),this.width,this.height)}distToPoint(e){return Math.sqrt(this.sdistToPoint(e))}sdistToPoint(e){let t=this.pos,n=this.pos.add(this.width,this.height),r=Math.max(t.x-e.x,0,e.x-n.x),i=Math.max(t.y-e.y,0,e.y-n.y);return r*r+i*i}};t(O,"Rect");var q=class{center;radius;constructor(e,t){this.center=e.clone(),this.radius=t}transform(e){return new H(this.center,this.radius,this.radius).transform(e)}bbox(){return O.fromPoints(this.center.sub(c(this.radius)),this.center.add(c(this.radius)))}area(){return this.radius*this.radius*Math.PI}clone(){return new q(this.center,this.radius)}};t(q,"Circle");var H=class{center;radiusX;radiusY;constructor(e,t,n){this.center=e.clone(),this.radiusX=t,this.radiusY=n}transform(e){return new H(e.multVec2(this.center),e.m[0]*this.radiusX,e.m[5]*this.radiusY)}bbox(){return O.fromPoints(this.center.sub(c(this.radiusX,this.radiusY)),this.center.add(c(this.radiusX,this.radiusY)))}area(){return this.radiusX*this.radiusY*Math.PI}clone(){return new H(this.center,this.radiusX,this.radiusY)}};t(H,"Ellipse");var K=class{pts;constructor(e){if(e.length<3)throw new Error("Polygons should have at least 3 vertices");this.pts=e}transform(e){return new K(this.pts.map((t=>e.multVec2(t))))}bbox(){let e=c(Number.MAX_VALUE),t=c(-Number.MAX_VALUE);for(let n of this.pts)e.x=Math.min(e.x,n.x),t.x=Math.max(t.x,n.x),e.y=Math.min(e.y,n.y),t.y=Math.max(t.y,n.y);return O.fromPoints(e,t)}area(){let e=0,t=this.pts.length;for(let n=0;n<t;n++){let r=this.pts[n],i=this.pts[(n+1)%t];e+=r.x*i.y*.5,e-=i.x*r.y*.5}return Math.abs(e)}clone(){return new K(this.pts.map((e=>e.clone())))}};function Y(e,t){let n=Number.MAX_VALUE,r=c(0);for(let i of[e,t])for(let s=0;s<i.pts.length;s++){let o=i.pts[s],a=i.pts[(s+1)%i.pts.length].sub(o).normal().unit(),l=Number.MAX_VALUE,h=-Number.MAX_VALUE;for(let t=0;t<e.pts.length;t++){let n=e.pts[t].dot(a);l=Math.min(l,n),h=Math.max(h,n)}let d=Number.MAX_VALUE,u=-Number.MAX_VALUE;for(let e=0;e<t.pts.length;e++){let n=t.pts[e].dot(a);d=Math.min(d,n),u=Math.max(u,n)}let c=Math.min(h,u)-Math.max(l,d);if(c<0)return null;if(c<Math.abs(n)){let e=u-l,t=d-h;n=Math.abs(e)<Math.abs(t)?e:t,r=a.scale(n)}}return r}t(K,"Polygon"),t(Y,"sat");var j=class extends Map{lastID;constructor(...e){super(...e),this.lastID=0}push(e){let t=this.lastID;return this.set(t,e),this.lastID++,t}pushd(e){let t=this.push(e);return()=>this.delete(t)}};t(j,"IDList");var Q=class{paused=!1;cancel;constructor(e){this.cancel=e}static join(e){let t=new Q((()=>e.forEach((e=>e.cancel()))));return Object.defineProperty(t,"paused",{get:()=>e[0].paused,set:t=>e.forEach((e=>e.paused=t))}),t.paused=!1,t}};t(Q,"EventController");var X=class{handlers=new j;add(e){let t=this.handlers.pushd(((...t)=>{n.paused||e(...t)})),n=new Q(t);return n}addOnce(e){let t=this.add(((...n)=>{t.cancel(),e(...n)}));return t}next(){return new Promise((e=>this.addOnce(e)))}trigger(...e){this.handlers.forEach((t=>t(...e)))}numListeners(){return this.handlers.size}};t(X,"Event");var J=class{handlers={};on(e,t){return this.handlers[e]||(this.handlers[e]=new X),this.handlers[e].add(t)}onOnce(e,t){let n=this.on(e,((...e)=>{n.cancel(),t(...e)}));return n}next(e){return new Promise((t=>{this.onOnce(e,((...e)=>t(e[0])))}))}trigger(e,...t){this.handlers[e]&&this.handlers[e].trigger(...t)}remove(e){delete this.handlers[e]}clear(){this.handlers={}}numListeners(e){return this.handlers[e]?.numListeners()??0}};function W(e,t){let n=typeof e,r=typeof t;if(n!==r)return!1;if("object"===n&&"object"===r&&null!==e&&null!==t){let n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(let r of n){let n=e[r],i=t[r];if(("function"!=typeof n||"function"!=typeof i)&&!W(n,i))return!1}return!0}return e===t}function Z(e){let t=window.atob(e),n=t.length,r=new Uint8Array(n);for(let e=0;e<n;e++)r[e]=t.charCodeAt(e);return r.buffer}function _(e){return Z(e.split(",")[1])}function $(e,t){let n=document.createElement("a");n.href=t,n.download=e,n.click()}function ee(e,t){$(e,"data:text/plain;charset=utf-8,"+t)}function te(e,t){ee(e,JSON.stringify(t))}function ne(e,t){let n=URL.createObjectURL(t);$(e,n),URL.revokeObjectURL(n)}t(J,"EventHandler"),t(W,"deepEq"),t(Z,"base64ToArrayBuffer"),t(_,"dataURLToArrayBuffer"),t($,"download"),t(ee,"downloadText"),t(te,"downloadJSON"),t(ne,"downloadBlob");var re=t((e=>e.match(/^data:\w+\/\w+;base64,.+/)),"isDataURL"),ie=t((e=>e.split(".").pop()),"getExt"),se=(()=>{let e=0;return()=>e++})(),oe=class{_items;_compareFn;constructor(e=((e,t)=>e<t)){this._compareFn=e,this._items=[]}insert(e){this._items.push(e),this.moveUp(this._items.length-1)}remove(){if(0===this._items.length)return null;let e=this._items[0],t=this._items.pop();return 0!==this._items.length&&(this._items[0]=t,this.moveDown(0)),e}clear(){this._items.splice(0,this._items.length)}moveUp(e){for(;e>0;){let t=Math.floor((e-1)/2);if(!this._compareFn(this._items[e],this._items[t])&&this._items[e]>=this._items[t])break;this.swap(e,t),e=t}}moveDown(e){for(;e<Math.floor(this._items.length/2);){let t=2*e+1;if(t<this._items.length-1&&!this._compareFn(this._items[t],this._items[t+1])&&++t,this._compareFn(this._items[e],this._items[t]))break;this.swap(e,t),e=t}}swap(e,t){[this._items[e],this._items[t]]=[this._items[t],this._items[e]]}get length(){return this._items.length}};t(oe,"BinaryHeap");var ae={"Joy-Con L+R (STANDARD GAMEPAD Vendor: 057e Product: 200e)":{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",6:"ltrigger",7:"rtrigger",8:"select",9:"start",10:"lstick",11:"rstick",12:"dpad-up",13:"dpad-down",14:"dpad-left",15:"dpad-right",16:"home",17:"capture"},sticks:{left:{x:0,y:1},right:{x:2,y:3}}},"Joy-Con (L) (STANDARD GAMEPAD Vendor: 057e Product: 2006)":{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",9:"select",10:"lstick",16:"start"},sticks:{left:{x:0,y:1}}},"Joy-Con (R) (STANDARD GAMEPAD Vendor: 057e Product: 2007)":{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",9:"start",10:"lstick",16:"select"},sticks:{left:{x:0,y:1}}},"Pro Controller (STANDARD GAMEPAD Vendor: 057e Product: 2009)":{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",6:"ltrigger",7:"rtrigger",8:"select",9:"start",10:"lstick",11:"rstick",12:"dpad-up",13:"dpad-down",14:"dpad-left",15:"dpad-right",16:"home",17:"capture"},sticks:{left:{x:0,y:1},right:{x:2,y:3}}},default:{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",6:"ltrigger",7:"rtrigger",8:"select",9:"start",10:"lstick",11:"rstick",12:"dpad-up",13:"dpad-down",14:"dpad-left",15:"dpad-right",16:"home"},sticks:{left:{x:0,y:1},right:{x:2,y:3}}}},le=class{pressed=new Set([]);pressedRepeat=new Set([]);released=new Set([]);down=new Set([]);update(){this.pressed.clear(),this.released.clear(),this.pressedRepeat.clear()}press(e){this.pressed.add(e),this.pressedRepeat.add(e),this.down.add(e)}pressRepeat(e){this.pressedRepeat.add(e)}release(e){this.down.delete(e),this.pressed.delete(e),this.released.add(e)}};t(le,"ButtonState");var he=class{buttonState=new le;stickState=new Map};t(he,"GamepadState");var de=class{dts=[];timer=0;fps=0;tick(e){this.dts.push(e),this.timer+=e,this.timer>=1&&(this.timer=0,this.fps=Math.round(1/(this.dts.reduce(((e,t)=>e+t))/this.dts.length)),this.dts=[])}};t(de,"FPSCounter");var ue=t((e=>{if(!e.canvas)throw new Error("Please provide a canvas");let n={canvas:e.canvas,loopID:null,stopped:!1,dt:0,time:0,realTime:0,fpsCounter:new de,timeScale:1,skipTime:!1,numFrames:0,paused:!1,mousePos:new u(0),mouseDeltaPos:new u(0),keyState:new le,mouseState:new le,mergedGamepadState:new he,gamepadStates:new Map,gamepads:[],charInputted:[],isMouseMoved:!1,lastWidth:e.canvas.offsetWidth,lastHeight:e.canvas.offsetHeight,events:new J};function r(){return n.canvas}function i(){return n.dt*n.timeScale}function s(){return n.time}function o(){return n.fpsCounter.fps}function a(){return n.numFrames}function l(){return n.canvas.toDataURL()}function h(e){n.canvas.style.cursor=e}function d(){return n.canvas.style.cursor}function c(e){if(e)try{let e=n.canvas.requestPointerLock();e.catch&&e.catch((e=>console.error(e)))}catch(e){console.error(e)}else document.exitPointerLock()}function p(){return!!document.pointerLockElement}function f(e){e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullscreen&&e.webkitRequestFullscreen()}function m(){document.exitFullscreen?document.exitFullscreen():document.webkitExitFullScreen&&document.webkitExitFullScreen()}function g(){return document.fullscreenElement||document.webkitFullscreenElement}function w(e=!0){e?f(n.canvas):m()}function A(){return!!g()}function y(){n.stopped=!0;for(let e in fe)n.canvas.removeEventListener(e,fe[e]);for(let e in me)document.removeEventListener(e,me[e]);for(let e in ge)window.removeEventListener(e,ge[e]);ve.disconnect()}function v(r){null!==n.loopID&&cancelAnimationFrame(n.loopID);let s=0,o=t((t=>{if(n.stopped)return;if(n.paused||"visible"!==document.visibilityState)return void(n.loopID=requestAnimationFrame(o));let a=t/1e3,l=a-n.realTime,h=e.maxFPS?1/e.maxFPS:0;n.realTime=a,s+=l,s>h&&(n.skipTime||(n.dt=s,n.time+=i(),n.fpsCounter.tick(n.dt)),s=0,n.skipTime=!1,n.numFrames++,se(),r(),oe()),n.loopID=requestAnimationFrame(o)}),"frame");o(0)}function V(){return"ontouchstart"in window||navigator.maxTouchPoints>0}function E(){return n.mousePos.clone()}function x(){return n.mouseDeltaPos.clone()}function b(e="left"){return n.mouseState.pressed.has(e)}function S(e="left"){return n.mouseState.down.has(e)}function R(e="left"){return n.mouseState.released.has(e)}function M(){return n.isMouseMoved}function T(e){return void 0===e?n.keyState.pressed.size>0:n.keyState.pressed.has(e)}function F(e){return void 0===e?n.keyState.pressedRepeat.size>0:n.keyState.pressedRepeat.has(e)}function B(e){return void 0===e?n.keyState.down.size>0:n.keyState.down.has(e)}function P(e){return void 0===e?n.keyState.released.size>0:n.keyState.released.has(e)}function I(e){return void 0===e?n.mergedGamepadState.buttonState.pressed.size>0:n.mergedGamepadState.buttonState.pressed.has(e)}function C(e){return void 0===e?n.mergedGamepadState.buttonState.down.size>0:n.mergedGamepadState.buttonState.down.has(e)}function k(e){return void 0===e?n.mergedGamepadState.buttonState.released.size>0:n.mergedGamepadState.buttonState.released.has(e)}function U(e){return n.events.on("resize",e)}t(r,"canvas"),t(i,"dt"),t(s,"time"),t(o,"fps"),t(a,"numFrames"),t(l,"screenshot"),t(h,"setCursor"),t(d,"getCursor"),t(c,"setCursorLocked"),t(p,"isCursorLocked"),t(f,"enterFullscreen"),t(m,"exitFullscreen"),t(g,"getFullscreenElement"),t(w,"setFullscreen"),t(A,"isFullscreen"),t(y,"quit"),t(v,"run"),t(V,"isTouchscreen"),t(E,"mousePos"),t(x,"mouseDeltaPos"),t(b,"isMousePressed"),t(S,"isMouseDown"),t(R,"isMouseReleased"),t(M,"isMouseMoved"),t(T,"isKeyPressed"),t(F,"isKeyPressedRepeat"),t(B,"isKeyDown"),t(P,"isKeyReleased"),t(I,"isGamepadButtonPressed"),t(C,"isGamepadButtonDown"),t(k,"isGamepadButtonReleased"),t(U,"onResize");let D=t(((e,t)=>"function"==typeof e?n.events.on("keyDown",e):"string"==typeof e&&"function"==typeof t?n.events.on("keyDown",(n=>n===e&&t(e))):void 0),"onKeyDown"),L=t(((e,t)=>"function"==typeof e?n.events.on("keyPress",e):"string"==typeof e&&"function"==typeof t?n.events.on("keyPress",(n=>n===e&&t(e))):void 0),"onKeyPress"),N=t(((e,t)=>"function"==typeof e?n.events.on("keyPressRepeat",e):"string"==typeof e&&"function"==typeof t?n.events.on("keyPressRepeat",(n=>n===e&&t(e))):void 0),"onKeyPressRepeat"),G=t(((e,t)=>"function"==typeof e?n.events.on("keyRelease",e):"string"==typeof e&&"function"==typeof t?n.events.on("keyRelease",(n=>n===e&&t(e))):void 0),"onKeyRelease");function O(e,t){return"function"==typeof e?n.events.on("mouseDown",(t=>e(t))):n.events.on("mouseDown",(n=>n===e&&t(n)))}function q(e,t){return"function"==typeof e?n.events.on("mousePress",(t=>e(t))):n.events.on("mousePress",(n=>n===e&&t(n)))}function H(e,t){return"function"==typeof e?n.events.on("mouseRelease",(t=>e(t))):n.events.on("mouseRelease",(n=>n===e&&t(n)))}function K(e){return n.events.on("mouseMove",(()=>e(E(),x())))}function Y(e){return n.events.on("charInput",e)}function j(e){return n.events.on("touchStart",e)}function Q(e){return n.events.on("touchMove",e)}function X(e){return n.events.on("touchEnd",e)}function z(e){return n.events.on("scroll",e)}function W(e,t){return"function"==typeof e?n.events.on("gamepadButtonDown",e):"string"==typeof e&&"function"==typeof t?n.events.on("gamepadButtonDown",(n=>n===e&&t(e))):void 0}function Z(e,t){return"function"==typeof e?n.events.on("gamepadButtonPress",e):"string"==typeof e&&"function"==typeof t?n.events.on("gamepadButtonPress",(n=>n===e&&t(e))):void 0}function _(e,t){return"function"==typeof e?n.events.on("gamepadButtonRelease",e):"string"==typeof e&&"function"==typeof t?n.events.on("gamepadButtonRelease",(n=>n===e&&t(e))):void 0}function $(e,t){return n.events.on("gamepadStick",((n,r)=>n===e&&t(r)))}function ee(e){n.events.on("gamepadConnect",e)}function te(e){n.events.on("gamepadDisconnect",e)}function ne(e){return n.mergedGamepadState.stickState.get(e)||new u(0)}function re(){return[...n.charInputted]}function ie(){return[...n.gamepads]}function se(){n.events.trigger("input"),n.keyState.down.forEach((e=>n.events.trigger("keyDown",e))),n.mouseState.down.forEach((e=>n.events.trigger("mouseDown",e))),pe()}function oe(){n.keyState.update(),n.mouseState.update(),n.mergedGamepadState.buttonState.update(),n.mergedGamepadState.stickState.forEach(((e,t)=>{n.mergedGamepadState.stickState.set(t,new u(0))})),n.charInputted=[],n.isMouseMoved=!1,n.gamepadStates.forEach((e=>{e.buttonState.update(),e.stickState.forEach(((t,n)=>{e.stickState.set(n,new u(0))}))}))}function ue(e){let t={index:e.index,isPressed:t=>n.gamepadStates.get(e.index).buttonState.pressed.has(t),isDown:t=>n.gamepadStates.get(e.index).buttonState.down.has(t),isReleased:t=>n.gamepadStates.get(e.index).buttonState.released.has(t),getStick:t=>n.gamepadStates.get(e.index).stickState.get(t)};return n.gamepads.push(t),n.gamepadStates.set(e.index,{buttonState:new le,stickState:new Map([["left",new u(0)],["right",new u(0)]])}),t}function ce(e){n.gamepads=n.gamepads.filter((t=>t.index!==e.index)),n.gamepadStates.delete(e.index)}function pe(){for(let e of navigator.getGamepads())e&&!n.gamepadStates.has(e.index)&&ue(e);for(let t of n.gamepads){let r=navigator.getGamepads()[t.index],i=(e.gamepads??{})[r.id]??ae[r.id]??ae.default,s=n.gamepadStates.get(t.index);for(let e=0;e<r.buttons.length;e++)r.buttons[e].pressed?(s.buttonState.down.has(i.buttons[e])||(n.mergedGamepadState.buttonState.press(i.buttons[e]),s.buttonState.press(i.buttons[e]),n.events.trigger("gamepadButtonPress",i.buttons[e])),n.events.trigger("gamepadButtonDown",i.buttons[e])):s.buttonState.down.has(i.buttons[e])&&(n.mergedGamepadState.buttonState.release(i.buttons[e]),s.buttonState.release(i.buttons[e]),n.events.trigger("gamepadButtonRelease",i.buttons[e]));for(let e in i.sticks){let t=i.sticks[e],o=new u(r.axes[t.x],r.axes[t.y]);s.stickState.set(e,o),n.mergedGamepadState.stickState.set(e,o),n.events.trigger("gamepadStick",e,o)}}}t(O,"onMouseDown"),t(q,"onMousePress"),t(H,"onMouseRelease"),t(K,"onMouseMove"),t(Y,"onCharInput"),t(j,"onTouchStart"),t(Q,"onTouchMove"),t(X,"onTouchEnd"),t(z,"onScroll"),t(W,"onGamepadButtonDown"),t(Z,"onGamepadButtonPress"),t(_,"onGamepadButtonRelease"),t($,"onGamepadStick"),t(ee,"onGamepadConnect"),t(te,"onGamepadDisconnect"),t(ne,"getGamepadStick"),t(re,"charInputted"),t(ie,"getGamepads"),t(se,"processInput"),t(oe,"resetInput"),t(ue,"registerGamepad"),t(ce,"removeGamepad"),t(pe,"processGamepad");let fe={},me={},ge={};fe.mousemove=e=>{let t=new u(e.offsetX,e.offsetY),r=new u(e.movementX,e.movementY);n.events.onOnce("input",(()=>{n.isMouseMoved=!0,n.mousePos=t,n.mouseDeltaPos=r,n.events.trigger("mouseMove")}))};let we=["left","middle","right","back","forward"];fe.mousedown=e=>{n.events.onOnce("input",(()=>{let t=we[e.button];t&&(n.mouseState.press(t),n.events.trigger("mousePress",t))}))},fe.mouseup=e=>{n.events.onOnce("input",(()=>{let t=we[e.button];t&&(n.mouseState.release(t),n.events.trigger("mouseRelease",t))}))};let Ae=new Set([" ","ArrowLeft","ArrowRight","ArrowUp","ArrowDown","Tab"]),ye={ArrowLeft:"left",ArrowRight:"right",ArrowUp:"up",ArrowDown:"down"," ":"space"};fe.keydown=e=>{Ae.has(e.key)&&e.preventDefault(),n.events.onOnce("input",(()=>{let t=ye[e.key]||e.key.toLowerCase();1===t.length?(n.events.trigger("charInput",t),n.charInputted.push(t)):"space"===t&&(n.events.trigger("charInput"," "),n.charInputted.push(" ")),e.repeat?(n.keyState.pressRepeat(t),n.events.trigger("keyPressRepeat",t)):(n.keyState.press(t),n.events.trigger("keyPressRepeat",t),n.events.trigger("keyPress",t))}))},fe.keyup=e=>{n.events.onOnce("input",(()=>{let t=ye[e.key]||e.key.toLowerCase();n.keyState.release(t),n.events.trigger("keyRelease",t)}))},fe.touchstart=t=>{t.preventDefault(),n.events.onOnce("input",(()=>{let r=[...t.changedTouches];r.forEach((e=>{n.events.trigger("touchStart",new u(e.clientX,e.clientY),e)})),!1!==e.touchToMouse&&(n.mousePos=new u(r[0].clientX,r[0].clientY),n.mouseState.press("left"),n.events.trigger("mousePress","left"))}))},fe.touchmove=t=>{t.preventDefault(),n.events.onOnce("input",(()=>{let r=[...t.changedTouches];r.forEach((e=>{n.events.trigger("touchMove",new u(e.clientX,e.clientY),e)})),!1!==e.touchToMouse&&(n.mousePos=new u(r[0].clientX,r[0].clientY),n.events.trigger("mouseMove"))}))},fe.touchend=t=>{n.events.onOnce("input",(()=>{let r=[...t.changedTouches];r.forEach((e=>{n.events.trigger("touchEnd",new u(e.clientX,e.clientY),e)})),!1!==e.touchToMouse&&(n.mousePos=new u(r[0].clientX,r[0].clientY),n.mouseState.release("left"),n.events.trigger("mouseRelease","left"))}))},fe.touchcancel=t=>{n.events.onOnce("input",(()=>{let r=[...t.changedTouches];r.forEach((e=>{n.events.trigger("touchEnd",new u(e.clientX,e.clientY),e)})),!1!==e.touchToMouse&&(n.mousePos=new u(r[0].clientX,r[0].clientY),n.mouseState.release("left"),n.events.trigger("mouseRelease","left"))}))},fe.wheel=e=>{e.preventDefault(),n.events.onOnce("input",(()=>{n.events.trigger("scroll",new u(e.deltaX,e.deltaY))}))},fe.contextmenu=e=>e.preventDefault(),me.visibilitychange=()=>{"visible"===document.visibilityState&&(n.skipTime=!0)},ge.gamepadconnected=e=>{let t=ue(e.gamepad);n.events.onOnce("input",(()=>{n.events.trigger("gamepadConnect",t)}))},ge.gamepaddisconnected=e=>{let t=ie().filter((t=>t.index===e.gamepad.index))[0];ce(e.gamepad),n.events.onOnce("input",(()=>{n.events.trigger("gamepadDisconnect",t)}))};for(let e in fe)n.canvas.addEventListener(e,fe[e]);for(let e in me)document.addEventListener(e,me[e]);for(let e in ge)window.addEventListener(e,ge[e]);let ve=new ResizeObserver((e=>{for(let t of e)if(t.target===n.canvas){if(n.lastWidth===n.canvas.offsetWidth&&n.lastHeight===n.canvas.offsetHeight)return;n.lastWidth=n.canvas.offsetWidth,n.lastHeight=n.canvas.offsetHeight,n.events.onOnce("input",(()=>{n.events.trigger("resize")}))}}));return ve.observe(n.canvas),{dt:i,time:s,run:v,canvas:r,fps:o,numFrames:a,quit:y,setFullscreen:w,isFullscreen:A,setCursor:h,screenshot:l,getGamepads:ie,getCursor:d,setCursorLocked:c,isCursorLocked:p,isTouchscreen:V,mousePos:E,mouseDeltaPos:x,isKeyDown:B,isKeyPressed:T,isKeyPressedRepeat:F,isKeyReleased:P,isMouseDown:S,isMousePressed:b,isMouseReleased:R,isMouseMoved:M,isGamepadButtonPressed:I,isGamepadButtonDown:C,isGamepadButtonReleased:k,getGamepadStick:ne,charInputted:re,onResize:U,onKeyDown:D,onKeyPress:L,onKeyPressRepeat:N,onKeyRelease:G,onMouseDown:O,onMousePress:q,onMouseRelease:H,onMouseMove:K,onCharInput:Y,onTouchStart:j,onTouchMove:Q,onTouchEnd:X,onScroll:z,onGamepadButtonDown:W,onGamepadButtonPress:Z,onGamepadButtonRelease:_,onGamepadStick:$,onGamepadConnect:ee,onGamepadDisconnect:te,events:n.events,get paused(){return n.paused},set paused(e){n.paused=e}}}),"default"),ce=2.5949095,pe=2.70158,fe=2*Math.PI/3,me=2*Math.PI/4.5,ge={linear:e=>e,easeInSine:e=>1-Math.cos(e*Math.PI/2),easeOutSine:e=>Math.sin(e*Math.PI/2),easeInOutSine:e=>-(Math.cos(Math.PI*e)-1)/2,easeInQuad:e=>e*e,easeOutQuad:e=>1-(1-e)*(1-e),easeInOutQuad:e=>e<.5?2*e*e:1-Math.pow(-2*e+2,2)/2,easeInCubic:e=>e*e*e,easeOutCubic:e=>1-Math.pow(1-e,3),easeInOutCubic:e=>e<.5?4*e*e*e:1-Math.pow(-2*e+2,3)/2,easeInQuart:e=>e*e*e*e,easeOutQuart:e=>1-Math.pow(1-e,4),easeInOutQuart:e=>e<.5?8*e*e*e*e:1-Math.pow(-2*e+2,4)/2,easeInQuint:e=>e*e*e*e*e,easeOutQuint:e=>1-Math.pow(1-e,5),easeInOutQuint:e=>e<.5?16*e*e*e*e*e:1-Math.pow(-2*e+2,5)/2,easeInExpo:e=>0===e?0:Math.pow(2,10*e-10),easeOutExpo:e=>1===e?1:1-Math.pow(2,-10*e),easeInOutExpo:e=>0===e?0:1===e?1:e<.5?Math.pow(2,20*e-10)/2:(2-Math.pow(2,-20*e+10))/2,easeInCirc:e=>1-Math.sqrt(1-Math.pow(e,2)),easeOutCirc:e=>Math.sqrt(1-Math.pow(e-1,2)),easeInOutCirc:e=>e<.5?(1-Math.sqrt(1-Math.pow(2*e,2)))/2:(Math.sqrt(1-Math.pow(-2*e+2,2))+1)/2,easeInBack:e=>pe*e*e*e-1.70158*e*e,easeOutBack:e=>1+pe*Math.pow(e-1,3)+1.70158*Math.pow(e-1,2),easeInOutBack:e=>e<.5?Math.pow(2*e,2)*(7.189819*e-ce)/2:(Math.pow(2*e-2,2)*((ce+1)*(2*e-2)+ce)+2)/2,easeInElastic:e=>0===e?0:1===e?1:-Math.pow(2,10*e-10)*Math.sin((10*e-10.75)*fe),easeOutElastic:e=>0===e?0:1===e?1:Math.pow(2,-10*e)*Math.sin((10*e-.75)*fe)+1,easeInOutElastic:e=>0===e?0:1===e?1:e<.5?-Math.pow(2,20*e-10)*Math.sin((20*e-11.125)*me)/2:Math.pow(2,-20*e+10)*Math.sin((20*e-11.125)*me)/2+1,easeInBounce:e=>1-ge.easeOutBounce(1-e),easeOutBounce:e=>e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375,easeInOutBounce:e=>e<.5?(1-ge.easeOutBounce(1-2*e))/2:(1+ge.easeOutBounce(2*e-1))/2},we=ge,Ae=class{time;action;finished=!1;paused=!1;constructor(e,t){this.time=e,this.action=t}tick(e){return!this.finished&&!this.paused&&(this.time-=e,this.time<=0&&(this.action(),this.finished=!0,this.time=0,!0))}reset(e){this.time=e,this.finished=!1}};t(Ae,"Timer"),((t,n)=>{for(var r in n)e(t,r,{get:n[r],enumerable:!0})})({},{default:()=>ye});var ye=r("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L5QNSqT5iiySS9Ja2SV//5ME0ak//+4KgAAABgQBAADAMDgYCAEgCteQ0fZH6+ICXA357+MPfhR/+ywRf/U///LVTEFNRTMuMTAwVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+5JknQAFoWhGLm5gBClBmT3GiAAAAAGkHAAAIAAANIOAAARVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV"),ve=" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~",Ve="topleft",Ee="monospace",xe="nearest",be=[{name:"a_pos",size:2},{name:"a_uv",size:2},{name:"a_color",size:4}],Se=be.reduce(((e,t)=>e+t.size),0),Re=8192*Se,Me="\nvec4 vert(vec2 pos, vec2 uv, vec4 color) {\n\treturn def_vert();\n}\n",Te="\nvec4 frag(vec2 pos, vec2 uv, vec4 color, sampler2D tex) {\n\treturn def_frag();\n}\n",Fe=new Set(["id","require"]),Be=new Set(["add","update","draw","destroy","inspect","drawInspect"]);function Pe(e){switch(e){case"topleft":return new u(-1,-1);case"top":return new u(0,-1);case"topright":return new u(1,-1);case"left":return new u(-1,0);case"center":return new u(0,0);case"right":return new u(1,0);case"botleft":return new u(-1,1);case"bot":return new u(0,1);case"botright":return new u(1,1);default:return e}}function Ie(e){switch(e){case"left":default:return 0;case"center":return.5;case"right":return 1}}function Ce(e){return e.createBuffer(1,1,44100)}t(Pe,"anchorPt"),t(Ie,"alignPt"),t(Ce,"createEmptyAudioBuffer");var ke=t(((e={})=>{let n=e.root??document.body;n===document.body&&(document.body.style.width="100%",document.body.style.height="100%",document.body.style.margin="0px",document.documentElement.style.width="100%",document.documentElement.style.height="100%");let r=e.canvas??(()=>{let e=document.createElement("canvas");return n.appendChild(e),e})(),d=e.scale??1,p=e.width&&e.height&&!e.stretch&&!e.letterbox;p?(r.width=e.width*d,r.height=e.height*d):(r.width=r.parentElement.offsetWidth,r.height=r.parentElement.offsetHeight);let V=r.width,x=r.height,B=e.pixelDensity||window.devicePixelRatio;r.width*=B,r.height*=B;let D=["outline: none","cursor: default"];p?(D.push(`width: ${V}px`),D.push(`height: ${x}px`)):(D.push("width: 100%"),D.push("height: 100%")),e.crisp&&(D.push("image-rendering: pixelated"),D.push("image-rendering: crisp-edges")),r.style.cssText=D.join(";"),r.tabIndex=0;let H=document.createElement("canvas");H.width=256,H.height=256;let z=H.getContext("2d",{willReadFrequently:!0}),Z=ue({canvas:r,touchToMouse:e.touchToMouse,gamepads:e.gamepads,pixelDensity:e.pixelDensity,maxFPS:e.maxFPS}),ae=[],le=Z.canvas().getContext("webgl",{antialias:!0,depth:!0,stencil:!0,alpha:!0,preserveDrawingBuffer:!0});class he{src=null;glTex;width;height;constructor(t,n,r={}){this.glTex=le.createTexture(),ae.push((()=>this.free())),this.bind(),t&&n&&le.texImage2D(le.TEXTURE_2D,0,le.RGBA,t,n,0,le.RGBA,le.UNSIGNED_BYTE,null),this.width=t,this.height=n;let i="linear"===(r.filter??e.texFilter)?le.LINEAR:le.NEAREST,s="repeat"===r.wrap?le.REPEAT:le.CLAMP_TO_EDGE;le.texParameteri(le.TEXTURE_2D,le.TEXTURE_MIN_FILTER,i),le.texParameteri(le.TEXTURE_2D,le.TEXTURE_MAG_FILTER,i),le.texParameteri(le.TEXTURE_2D,le.TEXTURE_WRAP_S,s),le.texParameteri(le.TEXTURE_2D,le.TEXTURE_WRAP_T,s),this.unbind()}static fromImage(e,t={}){let n=new he(0,0,t);return n.bind(),le.texImage2D(le.TEXTURE_2D,0,le.RGBA,le.RGBA,le.UNSIGNED_BYTE,e),n.width=e.width,n.height=e.height,n.unbind(),n.src=e,n}update(e,t=0,n=0){this.bind(),le.texSubImage2D(le.TEXTURE_2D,0,t,n,le.RGBA,le.UNSIGNED_BYTE,e),this.unbind()}bind(){le.bindTexture(le.TEXTURE_2D,this.glTex)}unbind(){le.bindTexture(le.TEXTURE_2D,null)}free(){le.deleteTexture(this.glTex)}}t(he,"Texture");class de{tex;canvas;ctx;x=0;y=0;curHeight=0;constructor(e,t){this.canvas=document.createElement("canvas"),this.canvas.width=e,this.canvas.height=t,this.tex=he.fromImage(this.canvas),this.ctx=this.canvas.getContext("2d")}add(e){if(e.width>this.canvas.width||e.height>this.canvas.height)throw new Error(`Texture size (${e.width} x ${e.height}) exceeds limit (${this.canvas.width} x ${this.canvas.height})`);this.x+e.width>this.canvas.width&&(this.x=0,this.y+=this.curHeight,this.curHeight=0),this.y+e.height>this.canvas.height&&(this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.tex=he.fromImage(this.canvas),this.x=0,this.y=0,this.curHeight=0);let t=new u(this.x,this.y);return this.x+=e.width,e.height>this.curHeight&&(this.curHeight=e.height),e instanceof ImageData?this.ctx.putImageData(e,t.x,t.y):this.ctx.drawImage(e,t.x,t.y),this.tex.update(this.canvas),[this.tex,new w(t.x/this.canvas.width,t.y/this.canvas.height,e.width/this.canvas.width,e.height/this.canvas.height)]}}t(de,"TexPacker");class ce{tex;glFrameBuffer;glRenderBuffer;constructor(e,t,n={}){this.tex=new he(e,t,n),this.glFrameBuffer=le.createFramebuffer(),this.glRenderBuffer=le.createRenderbuffer(),ae.push((()=>this.free())),this.bind(),le.renderbufferStorage(le.RENDERBUFFER,le.DEPTH_STENCIL,e,t),le.framebufferTexture2D(le.FRAMEBUFFER,le.COLOR_ATTACHMENT0,le.TEXTURE_2D,this.tex.glTex,0),le.framebufferRenderbuffer(le.FRAMEBUFFER,le.DEPTH_STENCIL_ATTACHMENT,le.RENDERBUFFER,this.glRenderBuffer),this.unbind()}get width(){return this.tex.width}get height(){return this.tex.height}bind(){le.bindFramebuffer(le.FRAMEBUFFER,this.glFrameBuffer),le.bindRenderbuffer(le.RENDERBUFFER,this.glRenderBuffer)}unbind(){le.bindFramebuffer(le.FRAMEBUFFER,null),le.bindRenderbuffer(le.RENDERBUFFER,null)}free(){le.deleteFramebuffer(this.glFrameBuffer),le.deleteRenderbuffer(this.glRenderBuffer),this.tex.free()}}t(ce,"FrameBuffer");let pe=(()=>{let t=yt(Me,Te),n=he.fromImage(new ImageData(new Uint8ClampedArray([255,255,255,255]),1,1)),r=e.width&&e.height?new ce(e.width*B,e.height*B):new ce(le.drawingBufferWidth/d,le.drawingBufferHeight/d),i=null,s=1;e.background&&(i=f.fromArray(e.background),s=e.background[3]??1,le.clearColor(i.r/255,i.g/255,i.b/255,s)),le.enable(le.BLEND),le.enable(le.SCISSOR_TEST),le.blendFuncSeparate(le.SRC_ALPHA,le.ONE_MINUS_SRC_ALPHA,le.ONE,le.ONE_MINUS_SRC_ALPHA);let o=le.createBuffer();le.bindBuffer(le.ARRAY_BUFFER,o),le.bufferData(le.ARRAY_BUFFER,4*Re,le.DYNAMIC_DRAW),be.reduce(((e,t,n)=>(le.vertexAttribPointer(n,t.size,le.FLOAT,!1,4*Se,e),le.enableVertexAttribArray(n),e+4*t.size)),0),le.bindBuffer(le.ARRAY_BUFFER,null);let a=le.createBuffer();le.bindBuffer(le.ELEMENT_ARRAY_BUFFER,a),le.bufferData(le.ELEMENT_ARRAY_BUFFER,49152,le.DYNAMIC_DRAW),le.bindBuffer(le.ELEMENT_ARRAY_BUFFER,null);let l=he.fromImage(new ImageData(new Uint8ClampedArray([128,128,128,255,190,190,190,255,190,190,190,255,128,128,128,255]),2,2),{wrap:"repeat",filter:"nearest"});return{drawCalls:0,lastDrawCalls:0,defShader:t,curShader:t,frameBuffer:r,postShader:null,postShaderUniform:null,defTex:n,curTex:n,curUniform:{},vbuf:o,ibuf:a,vqueue:[],iqueue:[],transform:new y,transformStack:[],bgTex:l,bgColor:i,bgAlpha:s,width:e.width??le.drawingBufferWidth/B/d,height:e.height??le.drawingBufferHeight/B/d,viewport:{x:0,y:0,width:le.drawingBufferWidth,height:le.drawingBufferHeight}}})();class fe{tex;frames=[new w(0,0,1,1)];anims={};slice9=null;constructor(e,t,n={},r=null){this.tex=e,t&&(this.frames=t),this.anims=n,this.slice9=r}static from(e,t={}){return"string"==typeof e?fe.fromURL(e,t):Promise.resolve(fe.fromImage(e,t))}static fromImage(e,t={}){let[n,r]=De.packer.add(e),i=t.frames?t.frames.map((e=>new w(r.x+e.x*r.w,r.y+e.y*r.h,e.w*r.w,e.h*r.h))):We(t.sliceX||1,t.sliceY||1,r.x,r.y,r.w,r.h);return new fe(n,i,t.anims,t.slice9)}static fromURL(e,t={}){return je(e).then((e=>fe.fromImage(e,t)))}}t(fe,"SpriteData");class me{buf;constructor(e){this.buf=e}static fromArrayBuffer(e){return new Promise(((t,n)=>ge.ctx.decodeAudioData(e,t,n))).then((e=>new me(e)))}static fromURL(e){return re(e)?me.fromArrayBuffer(_(e)):Ye(e).then((e=>me.fromArrayBuffer(e)))}}t(me,"SoundData");let ge=(()=>{let e=new(window.AudioContext||window.webkitAudioContext),t=e.createGain();t.connect(e.destination);let n=new me(Ce(e));return e.decodeAudioData(ye.buffer.slice(0)).then((e=>{n.buf=e})).catch((e=>{console.error("Failed to load burp: ",e)})),{ctx:e,masterNode:t,burpSnd:n}})();class ke{loaded=!1;data=null;error=null;onLoadEvents=new X;onErrorEvents=new X;onFinishEvents=new X;constructor(e){e.then((e=>{this.data=e,this.onLoadEvents.trigger(e)})).catch((e=>{if(this.error=e,!(this.onErrorEvents.numListeners()>0))throw e;this.onErrorEvents.trigger(e)})).finally((()=>{this.onFinishEvents.trigger(),this.loaded=!0}))}static loaded(e){let t=new ke(Promise.resolve(e));return t.data=e,t.loaded=!0,t}onLoad(e){return this.loaded&&this.data?e(this.data):this.onLoadEvents.add(e),this}onError(e){return this.loaded&&this.error?e(this.error):this.onErrorEvents.add(e),this}onFinish(e){return this.loaded?e():this.onFinishEvents.add(e),this}then(e){return this.onLoad(e)}catch(e){return this.onError(e)}finally(e){return this.onFinish(e)}}t(ke,"Asset");class Ue{assets=new Map;lastUID=0;add(e,t){let n=e??this.lastUID+++"",r=new ke(t);return this.assets.set(n,r),r}addLoaded(e,t){let n=e??this.lastUID+++"",r=ke.loaded(t);return this.assets.set(n,r),r}get(e){return this.assets.get(e)}progress(){if(0===this.assets.size)return 1;let e=0;return this.assets.forEach((t=>{t.loaded&&e++})),e/this.assets.size}}t(Ue,"AssetBucket");let De={urlPrefix:"",sprites:new Ue,fonts:new Ue,bitmapFonts:new Ue,sounds:new Ue,shaders:new Ue,custom:new Ue,packer:new de(2048,2048),loaded:!1},Le={events:new J,objEvents:new J,root:An([]),gravity:0,scenes:{},logs:[],cam:{pos:null,scale:new u(1),angle:0,shake:0,transform:new y}};function Ne(e){return De.custom.add(null,e)}function Ge(){let e=[De.sprites,De.sounds,De.shaders,De.fonts,De.bitmapFonts,De.custom];return e.reduce(((e,t)=>e+t.progress()),0)/e.length}function Oe(e){return void 0!==e&&(De.urlPrefix=e),De.urlPrefix}function qe(e){let t=De.urlPrefix+e;return fetch(t).then((e=>{if(!e.ok)throw new Error(`Failed to fetch ${t}`);return e}))}function He(e){return qe(e).then((e=>e.json()))}function Ke(e){return qe(e).then((e=>e.text()))}function Ye(e){return qe(e).then((e=>e.arrayBuffer()))}function je(e){let t=new Image;return t.crossOrigin="anonymous",t.src=re(e)?e:De.urlPrefix+e,new Promise(((n,r)=>{t.onload=()=>n(t),t.onerror=()=>r(new Error(`Failed to load image from "${e}"`))}))}function Qe(e,t){return De.custom.add(e,He(t))}t(Ne,"load"),t(Ge,"loadProgress"),t(Oe,"loadRoot"),t(qe,"fetchURL"),t(He,"fetchJSON"),t(Ke,"fetchText"),t(Ye,"fetchArrayBuffer"),t(je,"loadImg"),t(Qe,"loadJSON");class Xe{fontface;outline;filter;constructor(e,t={}){this.fontface=e,this.outline=t.outline??0,this.filter=t.filter??xe}}function ze(e,t,n={}){let r=new FontFace(e,"string"==typeof t?`url(${t})`:t);return document.fonts.add(r),De.fonts.add(e,r.load().catch((e=>{throw new Error(`Failed to load font from "${t}": ${e}`)})).then((e=>new Xe(e,n))))}function Je(e,t,n,r,i={}){return De.bitmapFonts.add(e,je(t).then((e=>vt(he.fromImage(e,i),n,r,i.chars??ve))))}function We(e=1,t=1,n=0,r=0,i=1,s=1){let o=[],a=i/e,l=s/t;for(let i=0;i<t;i++)for(let t=0;t<e;t++)o.push(new w(n+t*a,r+i*l,a,l));return o}function Ze(e,t){return Ne("string"==typeof t?new Promise(((n,r)=>{He(t).then((t=>{Ze(e,t).then(n).catch(r)}))})):fe.from(e).then((e=>{let n={};for(let r in t){let i=t[r],s=e.frames[0],o=2048*s.w,a=2048*s.h,l=i.frames?i.frames.map((e=>new w(s.x+(i.x+e.x)/o*s.w,s.y+(i.y+e.y)/a*s.h,e.w/o*s.w,e.h/a*s.h))):We(i.sliceX||1,i.sliceY||1,s.x+i.x/o*s.w,s.y+i.y/a*s.h,i.width/o*s.w,i.height/a*s.h),h=new fe(e.tex,l,i.anims);De.sprites.addLoaded(r,h),n[r]=h}return n})))}function _e(e,t={}){let n=document.createElement("canvas"),r=e[0].width,i=e[0].height;n.width=r*e.length,n.height=i;let s=n.getContext("2d");e.forEach(((e,t)=>{e instanceof ImageData?s.putImageData(e,t*r,0):s.drawImage(e,t*r,0)}));let o=s.getImageData(0,0,e.length*r,i);return fe.fromImage(o,{...t,sliceX:e.length,sliceY:1})}function $e(e,t,n={sliceX:1,sliceY:1,anims:{}}){return Array.isArray(t)?t.some((e=>"string"==typeof e))?De.sprites.add(e,Promise.all(t.map((e=>"string"==typeof e?je(e):Promise.resolve(e)))).then((e=>_e(e,n)))):De.sprites.addLoaded(e,_e(t,n)):"string"==typeof t?De.sprites.add(e,fe.from(t,n)):De.sprites.addLoaded(e,fe.fromImage(t,n))}function et(e,t){return De.sprites.add(e,new Promise((async e=>{let n="string"==typeof t?await He(t):t,r=await Promise.all(n.frames.map(je)),i=document.createElement("canvas");i.width=n.width,i.height=n.height*n.frames.length;let s=i.getContext("2d");r.forEach(((e,t)=>{s.drawImage(e,0,t*n.height)})),e(await $e(null,i,{sliceY:n.frames.length,anims:n.anims}))})))}function tt(e,t,n){"string"==typeof t&&!n&&(n=t.replace(new RegExp(`${ie(t)}$`),"json"));let r="string"==typeof n?He(n):Promise.resolve(n);return De.sprites.add(e,r.then((e=>{let n=e.meta.size,r=e.frames.map((e=>new w(e.frame.x/n.w,e.frame.y/n.h,e.frame.w/n.w,e.frame.h/n.h))),i={};for(let t of e.meta.frameTags)t.from===t.to?i[t.name]=t.from:i[t.name]={from:t.from,to:t.to,speed:10,loop:!0,pingpong:"pingpong"===t.direction};return fe.from(t,{frames:r,anims:i})})))}function nt(e,t,n){return De.shaders.addLoaded(e,yt(t,n))}function rt(e,n,r){let i=t((e=>e?Ke(e):Promise.resolve(null)),"resolveUrl"),s=Promise.all([i(n),i(r)]).then((([e,t])=>yt(e,t)));return De.shaders.add(e,s)}function it(e,t,n={}){return De.sounds.add(e,"string"==typeof t?me.fromURL(t):me.fromArrayBuffer(t))}function st(e="bean"){return $e(e,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAD0AAAA1CAYAAADyMeOEAAAAAXNSR0IArs4c6QAAAoVJREFUaIHdm7txwkAQhheGAqACiCHzOKQDQrqgILpwSAeEDBnEUAF0gCMxZ7G72qce/mec2Lpf9+3unaS78wgSNZ8uX5729+d1FNWXUuGmXlBOUUEIMckEpeQJgBu6C+BSFngztBR2vd+ovY+7g+p6LbgaWgJrAeUkDYIUXgXdBBwNi6kpABJwMTQH3AZsXRR8GHTfgEth8E3gjdAUcNewpbTgY85sCMCUuOokozE0YM0YRzM9NGAAXd8+omAF5h4lnmBRvpSnZHyLoLEbaN+aKB9KWv/KWw0tAbbANnlG+UvB2dm77NxxdwgBpjrF/d7rW9cbmpvio2A5z8iAYpVU8pGZlo6/2+MSco2lHfd3rv9jAP038e1xef9o2mjvYb2OqpqKE81028/jeietlSEVO5FRWsxWsJit1G3aFpW8iWe5RwpiCZAk25QvV6nz6fIlynRGuTd5WqpJ4guAlDfVKBK87hXljflgv1ON6fV+4+5gVlA17SfeG0heKqQd4l4jI/wrmaA9N9R4ar+wpHJDZyrrfcH0nB66PqAzPi76pn+faSyJk/vzOorYhGurQrzj/P68jtBMawHaHBIR9xoD5O34dy0qQOSYHvqExq2TpT2nf76+w7y251OYF0CRaU+J920TwLUa6inx6OxE6g80lu2ux7Y2eJLF/rCXE6zEPdnenk9o+4ih9AEdnW2q81HXl5LuU6OTl2fXUhqganbXAGq3g6jJOWV/OnoesO6YqqEB/GdNsjf7uHtwj2DzmRNpp7iOZfm6D9oAxB6Yi1gC4oIYeo4MIPdopEQRB+cAko5J1tW386HpB2Kz1eop4Epdwls/kgZ1sh8gZsEjdcWkr//D8Qu3Z3l5Nl1NtAAAAABJRU5ErkJggg==")}function ot(e){return De.sprites.get(e)}function at(e){return De.sounds.get(e)}function lt(e){return De.fonts.get(e)}function ht(e){return De.bitmapFonts.get(e)}function dt(e){return De.shaders.get(e)}function ut(e){return De.custom.get(e)}function ct(e){if("string"==typeof e){let t=ot(e);if(t)return t;if(Ge()<1)return null;throw new Error(`Sprite not found: ${e}`)}if(e instanceof fe)return ke.loaded(e);if(e instanceof ke)return e;throw new Error(`Invalid sprite: ${e}`)}function pt(e){if("string"==typeof e){let t=at(e);if(t)return t;if(Ge()<1)return null;throw new Error(`Sound not found: ${e}`)}if(e instanceof me)return ke.loaded(e);if(e instanceof ke)return e;throw new Error(`Invalid sound: ${e}`)}function ft(e){if(!e)return pe.defShader;if("string"==typeof e){let t=dt(e);if(t)return t.data??t;if(Ge()<1)return null;throw new Error(`Shader not found: ${e}`)}return e instanceof ke&&e.data?e.data:e}function mt(t){if(!t)return mt(e.font??"monospace");if("string"==typeof t){let e=ht(t),n=lt(t);if(e)return e.data??e;if(n)return n.data??n;if(document.fonts.check(`64px ${t}`))return t;if(Ge()<1)return null;throw new Error(`Font not found: ${t}`)}return t instanceof ke&&t.data?t.data:t}function gt(e){return void 0!==e&&(ge.masterNode.gain.value=e),ge.masterNode.gain.value}function wt(e,n={}){let r=ge.ctx,i=n.paused??!1,s=r.createBufferSource(),o=new X,a=r.createGain(),l=n.seek??0,h=0,d=0,u=!1;s.loop=!!n.loop,s.detune.value=n.detune??0,s.playbackRate.value=n.speed??1,s.connect(a),s.onended=()=>{f()>=s.buffer?.duration&&o.trigger()},a.connect(ge.masterNode),a.gain.value=n.volume??1;let c=t((e=>{s.buffer=e.buf,i||(h=r.currentTime,s.start(0,l),u=!0)}),"start"),p=pt(e);p instanceof ke&&p.onLoad(c);let f=t((()=>{if(!s.buffer)return 0;let e=i?d-h:r.currentTime-h,t=s.buffer.duration;return s.loop?e%t:Math.min(e,t)}),"getTime"),m=t((e=>{let t=r.createBufferSource();return t.buffer=e.buffer,t.loop=e.loop,t.playbackRate.value=e.playbackRate.value,t.detune.value=e.detune.value,t.onended=e.onended,t.connect(a),t}),"cloneNode");return{set paused(e){if(i!==e)if(i=e,e)u&&(s.stop(),u=!1),d=r.currentTime;else{s=m(s);let e=d-h;s.start(0,e),u=!0,h=r.currentTime-e,d=0}},get paused(){return i},play(e=0){this.seek(e),this.paused=!1},seek(e){s.buffer?.duration&&(e>s.buffer.duration||(i?(s=m(s),h=d-e):(s.stop(),s=m(s),h=r.currentTime-e,s.start(0,e),u=!0,d=0)))},set speed(e){s.playbackRate.value=e},get speed(){return s.playbackRate.value},set detune(e){s.detune.value=e},get detune(){return s.detune.value},set volume(e){a.gain.value=Math.max(e,0)},get volume(){return a.gain.value},set loop(e){s.loop=e},get loop(){return s.loop},duration:()=>s.buffer?.duration??0,time(){return f()%this.duration()},onEnd:e=>o.add(e),then(e){return this.onEnd(e)}}}function At(e){return wt(ge.burpSnd,e)}function yt(e=Me,n=Te){let r="\nattribute vec2 a_pos;\nattribute vec2 a_uv;\nattribute vec4 a_color;\n\nvarying vec2 v_pos;\nvarying vec2 v_uv;\nvarying vec4 v_color;\n\nvec4 def_vert() {\n\treturn vec4(a_pos, 0.0, 1.0);\n}\n\n{{user}}\n\nvoid main() {\n\tvec4 pos = vert(a_pos, a_uv, a_color);\n\tv_pos = a_pos;\n\tv_uv = a_uv;\n\tv_color = a_color;\n\tgl_Position = pos;\n}\n".replace("{{user}}",e??Me),i="\nprecision mediump float;\n\nvarying vec2 v_pos;\nvarying vec2 v_uv;\nvarying vec4 v_color;\n\nuniform sampler2D u_tex;\n\nvec4 def_frag() {\n\treturn v_color * texture2D(u_tex, v_uv);\n}\n\n{{user}}\n\nvoid main() {\n\tgl_FragColor = frag(v_pos, v_uv, v_color, u_tex);\n\tif (gl_FragColor.a == 0.0) {\n\t\tdiscard;\n\t}\n}\n".replace("{{user}}",n??Te),s=le.createShader(le.VERTEX_SHADER),o=le.createShader(le.FRAGMENT_SHADER);le.shaderSource(s,r),le.shaderSource(o,i),le.compileShader(s),le.compileShader(o);let a=le.createProgram();if(ae.push((()=>le.deleteProgram(a))),le.attachShader(a,s),le.attachShader(a,o),le.bindAttribLocation(a,0,"a_pos"),le.bindAttribLocation(a,1,"a_uv"),le.bindAttribLocation(a,2,"a_color"),le.linkProgram(a),!le.getProgramParameter(a,le.LINK_STATUS)){let e=t((e=>{let t=e.match(/^ERROR:\s0:(?<line>\d+):\s(?<msg>.+)/);return{line:Number(t.groups.line),msg:t.groups.msg.replace(/\n\0$/,"")}}),"formatShaderError"),n=le.getShaderInfoLog(s),r=le.getShaderInfoLog(o),i="";if(n){let t=e(n);i+=`Vertex shader line ${t.line-14}: ${t.msg}`}if(r){let t=e(r);i+=`Fragment shader line ${t.line-14}: ${t.msg}`}throw new Error(i)}return le.deleteShader(s),le.deleteShader(o),{bind(){le.useProgram(a)},unbind(){le.useProgram(null)},free(){le.deleteProgram(a)},send(e){for(let t in e){let n=e[t],r=le.getUniformLocation(a,t);"number"==typeof n?le.uniform1f(r,n):n instanceof y?le.uniformMatrix4fv(r,!1,new Float32Array(n.m)):n instanceof f?le.uniform3f(r,n.r,n.g,n.b):n instanceof u&&le.uniform2f(r,n.x,n.y)}}}}function vt(e,t,n,r){let i=e.width/t,s={},o=r.split("").entries();for(let[e,r]of o)s[r]=new w(e%i*t,Math.floor(e/i)*n,t,n);return{tex:e,map:s,size:n}}function Vt(e,t,n,r=pe.defTex,i=pe.defShader,s={}){let o=ft(i);if(!o||o instanceof ke)return;(r!==pe.curTex||o!==pe.curShader||!W(pe.curUniform,s)||pe.vqueue.length+e.length*Se>Re||pe.iqueue.length+t.length>12288)&&Et();let a=n?pe.transform:Le.cam.transform.mult(pe.transform);for(let t of e){let e=Rt(a.multVec2(t.pos));pe.vqueue.push(e.x,e.y,t.uv.x,t.uv.y,t.color.r/255,t.color.g/255,t.color.b/255,t.opacity)}for(let n of t)pe.iqueue.push(n+pe.vqueue.length/Se-e.length);pe.curTex=r,pe.curShader=o,pe.curUniform=s}function Et(){!pe.curTex||!pe.curShader||0===pe.vqueue.length||0===pe.iqueue.length||(le.bindBuffer(le.ARRAY_BUFFER,pe.vbuf),le.bufferSubData(le.ARRAY_BUFFER,0,new Float32Array(pe.vqueue)),le.bindBuffer(le.ELEMENT_ARRAY_BUFFER,pe.ibuf),le.bufferSubData(le.ELEMENT_ARRAY_BUFFER,0,new Uint16Array(pe.iqueue)),pe.curShader.bind(),pe.curShader.send(pe.curUniform),pe.curTex.bind(),le.drawElements(le.TRIANGLES,pe.iqueue.length,le.UNSIGNED_SHORT,0),pe.curTex.unbind(),pe.curShader.unbind(),le.bindBuffer(le.ARRAY_BUFFER,null),le.bindBuffer(le.ELEMENT_ARRAY_BUFFER,null),pe.vqueue.length=0,pe.iqueue.length=0,pe.drawCalls++)}function xt(){le.clear(le.COLOR_BUFFER_BIT),pe.frameBuffer.bind(),le.viewport(0,0,pe.frameBuffer.width,pe.frameBuffer.height),le.clear(le.COLOR_BUFFER_BIT),pe.bgColor||zt((()=>{Ct({width:nn(),height:rn(),quad:new w(0,0,nn()/64,rn()/64),tex:pe.bgTex,fixed:!0})})),pe.drawCalls=0,pe.transformStack.length=0,pe.transform=new y}function bt(e,t){pe.postShader=e,pe.postShaderUniform=t??null}function St(){Et(),pe.frameBuffer.unbind(),le.viewport(0,0,le.drawingBufferWidth,le.drawingBufferHeight),Et();let e=pe.width,t=pe.height;pe.width=le.drawingBufferWidth/B,pe.height=le.drawingBufferHeight/B,kt({flipY:!0,tex:pe.frameBuffer.tex,pos:new u(pe.viewport.x,pe.viewport.y),width:pe.viewport.width,height:pe.viewport.height,shader:pe.postShader,uniform:"function"==typeof pe.postShaderUniform?pe.postShaderUniform():pe.postShaderUniform,fixed:!0}),Et(),pe.width=e,pe.height=t,pe.lastDrawCalls=pe.drawCalls}function Rt(e){return new u(e.x/nn()*2-1,-e.y/rn()*2+1)}function Mt(e){pe.transform=e.clone()}function Tt(...e){if(void 0===e[0])return;let t=c(...e);0===t.x&&0===t.y||pe.transform.translate(t)}function Ft(...e){if(void 0===e[0])return;let t=c(...e);1===t.x&&1===t.y||pe.transform.scale(t)}function Bt(e){e&&pe.transform.rotate(e)}function Pt(){pe.transformStack.push(pe.transform.clone())}function It(){pe.transformStack.length>0&&(pe.transform=pe.transformStack.pop())}function Ct(e){if(void 0===e.width||void 0===e.height)throw new Error('drawUVQuad() requires property "width" and "height".');if(e.width<=0||e.height<=0)return;let t=e.width,n=e.height,r=Pe(e.anchor||Ve).scale(new u(t,n).scale(-.5)),i=e.quad||new w(0,0,1,1),s=e.color||m(255,255,255),o=e.opacity??1,a=e.tex?.1/e.tex.width:0,l=e.tex?.1/e.tex.height:0,h=i.x+a,d=i.y+l,c=i.w-2*a,p=i.h-2*l;Pt(),Tt(e.pos),Bt(e.angle),Ft(e.scale),Tt(r),Vt([{pos:new u(-t/2,n/2),uv:new u(e.flipX?h+c:h,e.flipY?d:d+p),color:s,opacity:o},{pos:new u(-t/2,-n/2),uv:new u(e.flipX?h+c:h,e.flipY?d+p:d),color:s,opacity:o},{pos:new u(t/2,-n/2),uv:new u(e.flipX?h:h+c,e.flipY?d+p:d),color:s,opacity:o},{pos:new u(t/2,n/2),uv:new u(e.flipX?h:h+c,e.flipY?d:d+p),color:s,opacity:o}],[0,1,3,1,2,3],e.fixed,e.tex,e.shader,e.uniform),It()}function kt(e){if(!e.tex)throw new Error('drawTexture() requires property "tex".');let t=e.quad??new w(0,0,1,1),n=e.tex.width*t.w,r=e.tex.height*t.h,i=new u(1);if(e.tiled){let s=Math.ceil((e.width||n)/n),o=Math.ceil((e.height||r)/r),a=Pe(e.anchor||Ve).add(new u(1,1)).scale(.5).scale(s*n,o*r);for(let l=0;l<s;l++)for(let s=0;s<o;s++)Ct(Object.assign({},e,{pos:(e.pos||new u(0)).add(new u(n*l,r*s)).sub(a),scale:i.scale(e.scale||new u(1)),tex:e.tex,quad:t,width:n,height:r,anchor:"topleft"}))}else e.width&&e.height?(i.x=e.width/n,i.y=e.height/r):e.width?(i.x=e.width/n,i.y=i.x):e.height&&(i.y=e.height/r,i.x=i.y),Ct(Object.assign({},e,{scale:i.scale(e.scale||new u(1)),tex:e.tex,quad:t,width:n,height:r}))}function Ut(e){if(!e.sprite)throw new Error('drawSprite() requires property "sprite"');let t=ct(e.sprite);if(!t||!t.data)return;let n=t.data.frames[e.frame??0];if(!n)throw new Error(`Frame not found: ${e.frame??0}`);kt(Object.assign({},e,{tex:t.data.tex,quad:n.scale(e.quad??new w(0,0,1,1))}))}function Dt(e,t,n,r,s,o=1){r=i(r%360),(s=i(s%360))<=r&&(s+=2*Math.PI);let a=[],l=(s-r)/Math.ceil((s-r)/i(8)*o);for(let i=r;i<s;i+=l)a.push(e.add(t*Math.cos(i),n*Math.sin(i)));return a.push(e.add(t*Math.cos(s),n*Math.sin(s))),a}function Lt(e){if(void 0===e.width||void 0===e.height)throw new Error('drawRect() requires property "width" and "height".');if(e.width<=0||e.height<=0)return;let t=e.width,n=e.height,r=Pe(e.anchor||Ve).add(1,1).scale(new u(t,n).scale(-.5)),i=[new u(0,0),new u(t,0),new u(t,n),new u(0,n)];if(e.radius){let r=Math.min(Math.min(t,n)/2,e.radius);i=[new u(r,0),new u(t-r,0),...Dt(new u(t-r,r),r,r,270,360),new u(t,r),new u(t,n-r),...Dt(new u(t-r,n-r),r,r,0,90),new u(t-r,n),new u(r,n),...Dt(new u(r,n-r),r,r,90,180),new u(0,n-r),new u(0,r),...Dt(new u(r,r),r,r,180,270)]}Kt(Object.assign({},e,{offset:r,pts:i,...e.gradient?{colors:e.horizontal?[e.gradient[0],e.gradient[1],e.gradient[1],e.gradient[0]]:[e.gradient[0],e.gradient[0],e.gradient[1],e.gradient[1]]}:{}}))}function Nt(e){let{p1:t,p2:n}=e;if(!t||!n)throw new Error('drawLine() requires properties "p1" and "p2".');let r=e.width||1,i=n.sub(t).unit().normal().scale(.5*r);Vt([t.sub(i),t.add(i),n.add(i),n.sub(i)].map((t=>({pos:new u(t.x,t.y),uv:new u(0),color:e.color??f.WHITE,opacity:e.opacity??1}))),[0,1,3,1,2,3],e.fixed,pe.defTex,e.shader,e.uniform)}function Gt(e){let t=e.pts;if(!t)throw new Error('drawLines() requires property "pts".');if(!(t.length<2))if(e.radius&&t.length>=3){let n=t[0].sdist(t[1]);for(let e=1;e<t.length-1;e++)n=Math.min(t[e].sdist(t[e+1]),n);Math.min(e.radius,Math.sqrt(n)/2),Nt(Object.assign({},e,{p1:t[0],p2:t[1]}));for(let n=1;n<t.length-2;n++){let r=t[n],i=t[n+1];Nt(Object.assign({},e,{p1:r,p2:i}))}Nt(Object.assign({},e,{p1:t[t.length-2],p2:t[t.length-1]}))}else for(let n=0;n<t.length-1;n++)Nt(Object.assign({},e,{p1:t[n],p2:t[n+1]})),"none"!==e.join&&qt(Object.assign({},e,{pos:t[n],radius:e.width/2}))}function Ot(e){if(!e.p1||!e.p2||!e.p3)throw new Error('drawPolygon() requires properties "p1", "p2" and "p3".');return Kt(Object.assign({},e,{pts:[e.p1,e.p2,e.p3]}))}function qt(e){if(!e.radius)throw new Error('drawCircle() requires property "radius".');0!==e.radius&&Ht(Object.assign({},e,{radiusX:e.radius,radiusY:e.radius,angle:0}))}function Ht(e){if(void 0===e.radiusX||void 0===e.radiusY)throw new Error('drawEllipse() requires properties "radiusX" and "radiusY".');if(0===e.radiusX||0===e.radiusY)return;let t=e.start??0,n=e.end??360,r=Pe(e.anchor??"center").scale(new u(-e.radiusX,-e.radiusY)),i=Dt(r,e.radiusX,e.radiusY,t,n,e.resolution);i.unshift(r);let s=Object.assign({},e,{pts:i,radius:0,...e.gradient?{colors:[e.gradient[0],...Array(i.length-1).fill(e.gradient[1])]}:{}});if(n-t>=360&&e.outline)return!1!==e.fill&&Kt(Object.assign(s,{outline:null})),void Kt(Object.assign(s,{pts:i.slice(1),fill:!1}));Kt(s)}function Kt(e){if(!e.pts)throw new Error('drawPolygon() requires property "pts".');let t=e.pts.length;if(!(t<3)){if(Pt(),Tt(e.pos),Ft(e.scale),Bt(e.angle),Tt(e.offset),!1!==e.fill){let n=e.color??f.WHITE,r=e.pts.map(((t,r)=>({pos:new u(t.x,t.y),uv:new u(0,0),color:e.colors?e.colors[r]??n:n,opacity:e.opacity??1}))),i=[...Array(t-2).keys()].map((e=>[0,e+1,e+2])).flat();Vt(r,e.indices??i,e.fixed,pe.defTex,e.shader,e.uniform)}e.outline&&Gt({pts:[...e.pts,e.pts[0]],radius:e.radius,width:e.outline.width,color:e.outline.color,join:e.outline.join,uniform:e.uniform,fixed:e.fixed,opacity:e.opacity}),It()}}function Yt(e,t,n){Et(),le.clear(le.STENCIL_BUFFER_BIT),le.enable(le.STENCIL_TEST),le.stencilFunc(le.NEVER,1,255),le.stencilOp(le.REPLACE,le.REPLACE,le.REPLACE),t(),Et(),le.stencilFunc(n,1,255),le.stencilOp(le.KEEP,le.KEEP,le.KEEP),e(),Et(),le.disable(le.STENCIL_TEST)}function jt(e,t){Yt(e,t,le.EQUAL)}function Qt(e,t){Yt(e,t,le.NOTEQUAL)}function Xt(){return(pe.viewport.width+pe.viewport.height)/(pe.width+pe.height)}function zt(e){Et();let t=pe.width,n=pe.height;pe.width=pe.viewport.width,pe.height=pe.viewport.height,e(),Et(),pe.width=t,pe.height=n}function Jt(e,t){t.pos&&(e.pos=e.pos.add(t.pos)),t.scale&&(e.scale=e.scale.scale(c(t.scale))),t.angle&&(e.angle+=t.angle),t.color&&(e.color=e.color.mult(t.color)),t.opacity&&(e.opacity*=t.opacity)}t(Xe,"FontData"),t(ze,"loadFont"),t(Je,"loadBitmapFont"),t(We,"slice"),t(Ze,"loadSpriteAtlas"),t(_e,"createSpriteSheet"),t($e,"loadSprite"),t(et,"loadPedit"),t(tt,"loadAseprite"),t(nt,"loadShader"),t(rt,"loadShaderURL"),t(it,"loadSound"),t(st,"loadBean"),t(ot,"getSprite"),t(at,"getSound"),t(lt,"getFont"),t(ht,"getBitmapFont"),t(dt,"getShader"),t(ut,"getAsset"),t(ct,"resolveSprite"),t(pt,"resolveSound"),t(ft,"resolveShader"),t(mt,"resolveFont"),t(gt,"volume"),t(wt,"play"),t(At,"burp"),t(yt,"makeShader"),t(vt,"makeFont"),t(Vt,"drawRaw"),t(Et,"flush"),t(xt,"frameStart"),t(bt,"usePostEffect"),t(St,"frameEnd"),t(Rt,"screen2ndc"),t(Mt,"pushMatrix"),t(Tt,"pushTranslate"),t(Ft,"pushScale"),t(Bt,"pushRotate"),t(Pt,"pushTransform"),t(It,"popTransform"),t(Ct,"drawUVQuad"),t(kt,"drawTexture"),t(Ut,"drawSprite"),t(Dt,"getArcPts"),t(Lt,"drawRect"),t(Nt,"drawLine"),t(Gt,"drawLines"),t(Ot,"drawTriangle"),t(qt,"drawCircle"),t(Ht,"drawEllipse"),t(Kt,"drawPolygon"),t(Yt,"drawStenciled"),t(jt,"drawMasked"),t(Qt,"drawSubtracted"),t(Xt,"getViewportScale"),t(zt,"drawUnscaled"),t(Jt,"applyCharTransform");let Wt=/\[(?<style>\w+)\](?<text>.*?)\[\/\k<style>\]/g;function Zt(e){let t={},n=e.replace(Wt,"$2"),r=0;for(let n of e.matchAll(Wt)){let e=n.index-r;for(let r=0;r<n.groups.text.length;r++)t[r+e]=[n.groups.style];r+=n[0].length-n.groups.text.length}return{charStyleMap:t,text:n}}t(Zt,"compileStyledText");let _t={};function $t(e){if(void 0===e.text)throw new Error('formatText() requires property "text".');let t=mt(e.font);if(""===e.text||t instanceof ke||!t)return{width:0,height:0,chars:[],opt:e};let{charStyleMap:n,text:r}=Zt(e.text+""),i=r.split("");if(t instanceof Xe||"string"==typeof t){let e=t instanceof Xe?t.fontface.family:t,n=t instanceof Xe?{outline:t.outline,filter:t.filter}:{outline:0,filter:xe},r=_t[e]??{font:{tex:new he(2048,2048,{filter:n.filter}),map:{},size:64},cursor:new u(0),outline:n.outline};_t[e]||(_t[e]=r),t=r.font;for(let n of i)if(!r.font.map[n]){let i=z;i.clearRect(0,0,H.width,H.height),i.font=`${t.size}px ${e}`,i.textBaseline="top",i.textAlign="left",i.fillStyle="#ffffff";let s=i.measureText(n),o=Math.ceil(s.width),a=t.size;r.outline&&(i.lineJoin="round",i.lineWidth=2*r.outline,i.strokeStyle="#000000",i.strokeText(n,r.outline,r.outline),o+=2*r.outline,a+=3*r.outline),i.fillText(n,r.outline,r.outline);let l=i.getImageData(0,0,o,a);if(r.cursor.x+o>2048&&(r.cursor.x=0,r.cursor.y+=a,r.cursor.y>2048))throw new Error("Font atlas exceeds character limit");t.tex.update(l,r.cursor.x,r.cursor.y),t.map[n]=new w(r.cursor.x,r.cursor.y,o,a),r.cursor.x+=o}}let s=e.size||t.size,o=c(e.scale??1).scale(s/t.size),a=e.lineSpacing??0,l=e.letterSpacing??0,h=0,d=0,p=0,m=[],g=[],A=0,y=null,v=null;for(;A<i.length;){let n=i[A];if("\n"===n)p+=s+a,m.push({width:h-l,chars:g}),y=null,v=null,h=0,g=[];else{let r=t.map[n];if(r){let V=r.w*o.x;e.width&&h+V>e.width&&(p+=s+a,null!=y&&(A-=g.length-y,n=i[A],r=t.map[n],V=r.w*o.x,g=g.slice(0,y-1),h=v),y=null,v=null,m.push({width:h-l,chars:g}),h=0,g=[]),g.push({tex:t.tex,width:r.w,height:r.h,quad:new w(r.x/t.tex.width,r.y/t.tex.height,r.w/t.tex.width,r.h/t.tex.height),ch:n,pos:new u(h,p),opacity:e.opacity??1,color:e.color??f.WHITE,scale:c(o),angle:0})," "===n&&(y=g.length,v=h),h+=V,d=Math.max(d,h),h+=l}}A++}m.push({width:h-l,chars:g}),p+=s,e.width&&(d=e.width);let V=[];for(let r of m){let i=(d-r.width)*Ie(e.align??"left");for(let s of r.chars){let r=t.map[s.ch],a=V.length;if(s.pos=s.pos.add(i,0).add(r.w*o.x*.5,r.h*o.y*.5),e.transform){let t="function"==typeof e.transform?e.transform(a,s.ch):e.transform;t&&Jt(s,t)}if(n[a]){let t=n[a];for(let n of t){let t=e.styles[n],r="function"==typeof t?t(a,s.ch):t;r&&Jt(s,r)}}V.push(s)}}return{width:d,height:p,chars:V,opt:e}}function en(e){tn($t(e))}function tn(e){Pt(),Tt(e.opt.pos),Bt(e.opt.angle),Tt(Pe(e.opt.anchor??"topleft").add(1,1).scale(e.width,e.height).scale(-.5)),e.chars.forEach((t=>{Ct({tex:t.tex,width:t.width,height:t.height,pos:t.pos,scale:t.scale,angle:t.angle,color:t.color,opacity:t.opacity,quad:t.quad,anchor:"center",uniform:e.opt.uniform,shader:e.opt.shader,fixed:e.opt.fixed})})),It()}function nn(){return pe.width}function rn(){return pe.height}t($t,"formatText"),t(en,"drawText"),t(tn,"drawFormattedText"),t(nn,"width"),t(rn,"height");let sn={};function on(e){return new u((e.x-pe.viewport.x)*nn()/pe.viewport.width,(e.y-pe.viewport.y)*rn()/pe.viewport.height)}function an(e){return new u(e.x*pe.viewport.width/pe.width,e.y*pe.viewport.height/pe.height)}function ln(){return on(Z.mousePos())}t(on,"windowToContent"),t(an,"contentToView"),t(ln,"mousePos"),sn.error=e=>{e.error?Jr(e.error):Jr(new Error(e.message))},sn.unhandledrejection=e=>Jr(e.reason);for(let e in sn)window.addEventListener(e,sn[e]);let hn={inspect:!1,timeScale:1,showLog:!0,fps:()=>Z.fps(),numFrames:()=>Z.numFrames(),stepFrame:Gr,drawCalls:()=>pe.drawCalls,clearLog:()=>Le.logs=[],log:t=>{let n=e.logMax??1,r=t instanceof Error?"error":"info";Le.logs.unshift(`[time]${Z.time().toFixed(2)}[/time] [${r}]${t?.toString?t.toString():t}[/${r}]`),Le.logs.length>n&&(Le.logs=Le.logs.slice(0,n))},error:e=>hn.log(new Error(e.toString?e.toString():e)),curRecording:null,get paused(){return Z.paused},set paused(e){Z.paused=e,e?ge.ctx.suspend():ge.ctx.resume()}};function dn(){return Z.dt()}function un(...e){return e.length>0&&(Le.cam.pos=c(...e)),Le.cam.pos?Le.cam.pos.clone():xr()}function cn(...e){return e.length>0&&(Le.cam.scale=c(...e)),Le.cam.scale.clone()}function pn(e){return void 0!==e&&(Le.cam.angle=e),Le.cam.angle}function fn(e=12){Le.cam.shake=e}function mn(e){return Le.cam.transform.multVec2(e)}function gn(e){return Le.cam.transform.invert().multVec2(e)}function wn(e){let t=new y;return e.pos&&t.translate(e.pos),e.scale&&t.scale(e.scale),e.angle&&t.rotate(e.angle),e.parent?t.mult(e.parent.transform):t}function An(e){let n=new Map,r={},i=new J,s=null,o={id:se(),hidden:!1,paused:!1,transform:new y,children:[],parent:null,add(e){let t=(()=>{if(Array.isArray(e))return An(e);if(e.parent)throw new Error("Cannot add a game obj that already has a parent.");return e})();return t.parent=this,t.transform=wn(t),this.children.push(t),t.trigger("add",t),Le.events.trigger("add",t),t},readd(e){let t=this.children.indexOf(e);return-1!==t&&(this.children.splice(t,1),this.children.push(e)),e},remove(e){let t=this.children.indexOf(e);-1!==t&&(e.trigger("destroy"),Le.events.trigger("destroy",e),e.parent=null,this.children.splice(t,1))},removeAll(e){this.get(e).forEach((e=>this.remove(e)))},update(){this.paused||(this.children.sort(((e,t)=>(e.z??0)-(t.z??0))).forEach((e=>e.update())),this.trigger("update"))},draw(){this.hidden||(Pt(),Tt(this.pos),Ft(this.scale),Bt(this.angle),this.trigger("draw"),this.children.sort(((e,t)=>(e.z??0)-(t.z??0))).forEach((e=>e.draw())),It())},drawInspect(){this.hidden||(Pt(),Tt(this.pos),Ft(this.scale),Bt(this.angle),this.children.sort(((e,t)=>(e.z??0)-(t.z??0))).forEach((e=>e.drawInspect())),this.trigger("drawInspect"),It())},use(e){if(!e)return;if("string"==typeof e)return this.use({id:e});let i=[];e.id&&(this.unuse(e.id),r[e.id]=[],i=r[e.id],n.set(e.id,e));for(let n in e){if(Fe.has(n))continue;let r=Object.getOwnPropertyDescriptor(e,n);if("function"==typeof r.value&&(e[n]=e[n].bind(this)),r.set&&Object.defineProperty(e,n,{set:r.set.bind(this)}),r.get&&Object.defineProperty(e,n,{get:r.get.bind(this)}),Be.has(n)){let r="add"===n?()=>{s=t((e=>i.push(e)),"onCurCompCleanup"),e[n](),s=null}:e[n];i.push(this.on(n,r).cancel)}else{if(void 0!==this[n])throw new Error(`Duplicate component property: "${n}"`);Object.defineProperty(this,n,{get:()=>e[n],set:t=>e[n]=t,configurable:!0,enumerable:!0}),i.push((()=>delete this[n]))}}let o=t((()=>{if(e.require)for(let t of e.require)if(!this.c(t))throw new Error(`Component "${e.id}" requires component "${t}"`)}),"checkDeps");e.destroy&&i.push(e.destroy.bind(this)),this.exists()?(o(),e.add&&(s=t((e=>i.push(e)),"onCurCompCleanup"),e.add.call(this),s=null)):e.require&&i.push(this.on("add",o).cancel)},unuse(e){r[e]&&(r[e].forEach((e=>e())),delete r[e]),n.has(e)&&n.delete(e)},c:e=>n.get(e),get(e,n={}){let r=n.recursive?this.children.flatMap(t((function e(t){return[t,...t.children.flatMap(e)]}),"recurse")):this.children;if(r=r.filter((t=>!e||t.is(e))),n.liveUpdate){let i=t((e=>n.recursive?this.isAncestorOf(e):e.parent===this),"isChild");xn((t=>{i(t)&&t.is(e)&&r.push(t)})),bn((t=>{if(i(t)&&t.is(e)){let e=r.findIndex((e=>e.id===t.id));-1!==e&&r.splice(e,1)}}))}return r},isAncestorOf(e){return!!e.parent&&(e.parent===this||this.isAncestorOf(e.parent))},exists(){return Le.root.isAncestorOf(this)},is(e){if("*"===e)return!0;if(Array.isArray(e)){for(let t of e)if(!this.c(t))return!1;return!0}return null!=this.c(e)},on(e,t){let n=i.on(e,t.bind(this));return s&&s((()=>n.cancel())),n},trigger(e,...t){i.trigger(e,...t),Le.objEvents.trigger(e,this,...t)},destroy(){this.parent&&this.parent.remove(this)},inspect(){let e={};for(let[t,r]of n)e[t]=r.inspect?r.inspect():null;return e},onAdd(e){return this.on("add",e)},onUpdate(e){return this.on("update",e)},onDraw(e){return this.on("draw",e)},onDestroy(e){return this.on("destroy",e)},clearEvents(){i.clear()}};for(let t of e)o.use(t);return o}function yn(e,t,n){return Le.objEvents[e]||(Le.objEvents[e]=new j),Le.objEvents.on(e,((e,...r)=>{e.is(t)&&n(e,...r)}))}t(dn,"dt"),t(un,"camPos"),t(cn,"camScale"),t(pn,"camRot"),t(fn,"shake"),t(mn,"toScreen"),t(gn,"toWorld"),t(wn,"calcTransform"),t(An,"make"),t(yn,"on");let vn,Vn=t(((e,t)=>{if("function"==typeof e&&void 0===t){let t=Pr([{update:e}]);return{get paused(){return t.paused},set paused(e){t.paused=e},cancel:()=>t.destroy()}}if("string"==typeof e)return yn("update",e,t)}),"onUpdate"),En=t(((e,t)=>{if("function"==typeof e&&void 0===t){let t=Pr([{draw:e}]);return{get paused(){return t.hidden},set paused(e){t.hidden=e},cancel:()=>t.destroy()}}if("string"==typeof e)return yn("draw",e,t)}),"onDraw");function xn(e,t){return"function"==typeof e&&void 0===t?Le.events.on("add",e):"string"==typeof e?yn("add",e,t):void 0}function bn(e,t){return"function"==typeof e&&void 0===t?Le.events.on("destroy",e):"string"==typeof e?yn("destroy",e,t):void 0}function Sn(e,t,n){return yn("collide",e,((e,r,i)=>r.is(t)&&n(e,r,i)))}function Rn(e,t,n){return yn("collideUpdate",e,((e,r,i)=>r.is(t)&&n(e,r,i)))}function Mn(e,t,n){return yn("collideEnd",e,((e,r,i)=>r.is(t)&&n(e,r,i)))}function Tn(e,t){kr(e,{recursive:!0}).forEach(t),xn(e,t)}function Fn(e,t){if("function"==typeof e)return Z.onMousePress(e);{let n=[];return Tn(e,(e=>{if(!e.area)throw new Error("onClick() requires the object to have area() component");n.push(e.onClick((()=>t(e))))})),Q.join(n)}}function Bn(e,t){let n=[];return Tn(e,(e=>{if(!e.area)throw new Error("onHover() requires the object to have area() component");n.push(e.onHover((()=>t(e))))})),Q.join(n)}function Pn(e,t){let n=[];return Tn(e,(e=>{if(!e.area)throw new Error("onHoverUpdate() requires the object to have area() component");n.push(e.onHoverUpdate((()=>t(e))))})),Q.join(n)}function In(e,t){let n=[];return Tn(e,(e=>{if(!e.area)throw new Error("onHoverEnd() requires the object to have area() component");n.push(e.onHoverEnd((()=>t(e))))})),Q.join(n)}function Cn(e,t){let n=0,r=[];t&&r.push(t);let i=Vn((()=>{n+=dn(),n>=e&&(i.cancel(),r.forEach((e=>e())))}));return{paused:i.paused,cancel:i.cancel,onEnd(e){r.push(e)},then(e){return this.onEnd(e),this}}}function kn(e,n){let r=null,i=t((()=>{r=Cn(e,i),n()}),"newAction");return r=Cn(0,i),{get paused(){return r.paused},set paused(e){r.paused=e},cancel:()=>r.cancel()}}function Un(){Z.onKeyPress("f1",(()=>{hn.inspect=!hn.inspect})),Z.onKeyPress("f2",(()=>{hn.clearLog()})),Z.onKeyPress("f8",(()=>{hn.paused=!hn.paused})),Z.onKeyPress("f7",(()=>{hn.timeScale=jn(o(hn.timeScale-.2,0,2),1)})),Z.onKeyPress("f9",(()=>{hn.timeScale=jn(o(hn.timeScale+.2,0,2),1)})),Z.onKeyPress("f10",(()=>{hn.stepFrame()}))}function Dn(){Z.onKeyPress("b",(()=>At()))}function Ln(e){Le.gravity=e}function Nn(){return Le.gravity}function Gn(...e){1===e.length||2===e.length?(pe.bgColor=m(e[0]),e[1]&&(pe.bgAlpha=e[1])):(3===e.length||4===e.length)&&(pe.bgColor=m(e[0],e[1],e[2]),e[3]&&(pe.bgAlpha=e[3])),le.clearColor(pe.bgColor.r/255,pe.bgColor.g/255,pe.bgColor.b/255,pe.bgAlpha)}function On(){return pe.bgColor.clone()}function qn(...e){return{id:"pos",pos:c(...e),moveBy(...e){this.pos=this.pos.add(c(...e))},move(...e){this.moveBy(c(...e).scale(dn()))},moveTo(...e){if("number"==typeof e[0]&&"number"==typeof e[1])return this.moveTo(c(e[0],e[1]),e[2]);let t=e[0],n=e[1];if(void 0===n)return void(this.pos=c(t));let r=t.sub(this.pos);r.len()<=n*dn()?this.pos=c(t):this.move(r.unit().scale(n))},worldPos(){return this.parent?this.parent.transform.multVec2(this.pos):this.pos},screenPos(){return this.fixed?this.pos:mn(this.pos)},inspect(){return`(${Math.round(this.pos.x)}, ${Math.round(this.pos.y)})`},drawInspect(){qt({color:m(255,0,0),radius:4/Xt()})}}}function Hn(...e){return 0===e.length?Hn(1):{id:"scale",scale:c(...e),scaleTo(...e){this.scale=c(...e)},scaleBy(...e){this.scale.scale(c(...e))},inspect(){return`(${jn(this.scale.x,2)}, ${jn(this.scale.y,2)})`}}}function Kn(e){return{id:"rotate",angle:e??0,rotateBy(e){this.angle+=e},rotateTo(e){this.angle=e},inspect(){return`${Math.round(this.angle)}`}}}function Yn(...e){return{id:"color",color:m(...e),inspect(){return this.color.toString()}}}function jn(e,t){return Number(e.toFixed(t))}function Qn(e){return{id:"opacity",opacity:e??1,inspect(){return`${jn(this.opacity,1)}`},fadeOut(e=1,t=we.linear){return _r(this.opacity,0,e,(e=>this.opacity=e),t)}}}function Xn(e){if(!e)throw new Error("Please define an anchor");return{id:"anchor",anchor:e,inspect(){return"string"==typeof this.anchor?this.anchor:this.anchor.toString()}}}function zn(e){return{id:"z",z:e,inspect(){return`${this.z}`}}}function Jn(e,t){return{id:"follow",require:["pos"],follow:{obj:e,offset:t??c(0)},add(){e.exists()&&(this.pos=this.follow.obj.pos.add(this.follow.offset))},update(){e.exists()&&(this.pos=this.follow.obj.pos.add(this.follow.offset))}}}function Wn(e,t){let n="number"==typeof e?u.fromAngle(e):e.unit();return{id:"move",require:["pos"],update(){this.move(n.scale(t))}}}function Zn(e={}){let t=e.distance??200,n=!1;return{id:"offscreen",require:["pos"],isOffScreen(){let e=mn(this.pos),n=new O(c(0),nn(),rn());return!C(n,e)&&n.sdistToPoint(e)>t*t},onExitScreen(e){return this.on("exitView",e)},onEnterScreen(e){return this.on("enterView",e)},update(){this.isOffScreen()?(n||(this.trigger("exitView"),n=!0),e.hide&&(this.hidden=!0),e.pause&&(this.paused=!0),e.destroy&&this.destroy()):(n&&(this.trigger("enterView"),n=!1),e.hide&&(this.hidden=!1),e.pause&&(this.paused=!1))}}}function _n(e={}){let t={},n=new Set;return{id:"area",collisionIgnore:e.collisionIgnore??[],add(){this.area.cursor&&this.onHover((()=>Z.setCursor(this.area.cursor))),this.onCollideUpdate(((e,r)=>{t[e.id]||this.trigger("collide",e,r),t[e.id]=r,n.add(e.id)}))},update(){for(let e in t)n.has(Number(e))||(this.trigger("collideEnd",t[e].target),delete t[e]);n.clear()},drawInspect(){let e=this.localArea();Pt(),Ft(this.area.scale),Tt(this.area.offset);let t={outline:{width:4/Xt(),color:m(0,0,255)},anchor:this.anchor,fill:!1,fixed:this.fixed};e instanceof O?Lt({...t,pos:e.pos,width:e.width,height:e.height}):e instanceof K?Kt({...t,pts:e.pts}):e instanceof q&&qt({...t,pos:e.center,radius:e.radius}),It()},area:{shape:e.shape??null,scale:e.scale?c(e.scale):c(1),offset:e.offset??c(0),cursor:e.cursor??null},isClicked(){return Z.isMousePressed()&&this.isHovering()},isHovering(){let e=this.fixed?ln():gn(ln());return this.hasPoint(e)},checkCollision:e=>t[e.id]??null,getCollisions:()=>Object.values(t),isColliding:e=>!!t[e.id],isOverlapping(e){let n=t[e.id];return n&&n.hasOverlap()},onClick(e){let t=Z.onMousePress("left",(()=>{this.isHovering()&&e()}));return this.onDestroy((()=>t.cancel())),t},onHover(e){let t=!1;return this.onUpdate((()=>{t?t=this.isHovering():this.isHovering()&&(t=!0,e())}))},onHoverUpdate(e){return this.onUpdate((()=>{this.isHovering()&&e()}))},onHoverEnd(e){let t=!1;return this.onUpdate((()=>{t?this.isHovering()||(t=!1,e()):t=this.isHovering()}))},onCollide(e,t){return"function"==typeof e&&void 0===t?this.on("collide",e):"string"==typeof e?this.onCollide(((n,r)=>{n.is(e)&&t(n,r)})):void 0},onCollideUpdate(e,t){return"function"==typeof e&&void 0===t?this.on("collideUpdate",e):"string"==typeof e?this.on("collideUpdate",((n,r)=>n.is(e)&&t(n,r))):void 0},onCollideEnd(e,t){return"function"==typeof e&&void 0===t?this.on("collideEnd",e):"string"==typeof e?this.on("collideEnd",(n=>n.is(e)&&t(n))):void 0},hasPoint(e){return N(this.worldArea(),e)},resolveCollision(e){let t=this.checkCollision(e);t&&!t.resolved&&(this.pos=this.pos.add(t.displacement),t.resolved=!0)},localArea(){return this.area.shape?this.area.shape:this.renderArea()},worldArea(){let e=this.localArea();if(!(e instanceof K||e instanceof O))throw new Error("Only support polygon and rect shapes for now");let t=this.transform.clone().scale(c(this.area.scale??1)).translate(this.area.offset);if(e instanceof O){let n=Pe(this.anchor||Ve).add(1,1).scale(-.5).scale(e.width,e.height);t.translate(n)}return e.transform(t)},screenArea(){let e=this.worldArea();return this.fixed?e:e.transform(Le.cam.transform)}}}function $n(e){return{color:e.color,opacity:e.opacity,anchor:e.anchor,outline:e.outline,fixed:e.fixed,shader:e.shader,uniform:e.uniform}}function er(e,n={}){let r=null,i=null,s=new X;if(!e)throw new Error("Please pass the resource name or data to sprite()");let o=t(((e,t,n,r)=>{let i=c(1,1);return n&&r?(i.x=n/(e.width*t.w),i.y=r/(e.height*t.h)):n?(i.x=n/(e.width*t.w),i.y=i.x):r&&(i.y=r/(e.height*t.h),i.x=i.y),i}),"calcTexScale");return{id:"sprite",width:0,height:0,frame:n.frame||0,quad:n.quad||new w(0,0,1,1),animSpeed:n.animSpeed??1,flipX:n.flipX??!1,flipY:n.flipY??!1,draw(){if(!r)return;let e=r.frames[this.frame??0];if(!e)throw new Error(`Frame not found: ${this.frame??0}`);if(r.slice9){let{left:t,right:i,top:s,bottom:o}=r.slice9,a=r.tex.width*e.w,l=r.tex.height*e.h,h=this.width-t-i,d=this.height-s-o,u=t/a,c=i/a,p=1-u-c,f=s/l,m=o/l,g=1-f-m,w=[A(0,0,u,f),A(u,0,p,f),A(u+p,0,c,f),A(0,f,u,g),A(u,f,p,g),A(u+p,f,c,g),A(0,f+g,u,m),A(u,f+g,p,m),A(u+p,f+g,c,m),A(0,0,t,s),A(t,0,h,s),A(t+h,0,i,s),A(0,s,t,d),A(t,s,h,d),A(t+h,s,i,d),A(0,s+d,t,o),A(t,s+d,h,o),A(t+h,s+d,i,o)];for(let t=0;t<9;t++){let i=w[t],s=w[t+9];kt(Object.assign($n(this),{pos:s.pos(),tex:r.tex,quad:e.scale(i),flipX:this.flipX,flipY:this.flipY,tiled:n.tiled,width:s.w,height:s.h}))}}else kt(Object.assign($n(this),{tex:r.tex,quad:e,flipX:this.flipX,flipY:this.flipY,tiled:n.tiled,width:this.width,height:this.height}))},add(){let i=t((e=>{let t=e.frames[0].clone();n.quad&&(t=t.scale(n.quad));let i=o(e.tex,t,n.width,n.height);this.width=e.tex.width*t.w*i.x,this.height=e.tex.height*t.h*i.y,n.anim&&this.play(n.anim),r=e,s.trigger(r)}),"setSpriteData"),a=ct(e);a?a.onLoad(i):gr((()=>i(ct(e).data)))},update(){if(!i)return;let e=r.anims[i.name];if("number"!=typeof e){if(0===e.speed)throw new Error("Sprite anim speed cannot be 0");i.timer+=dn()*this.animSpeed,i.timer>=1/i.speed&&(i.timer=0,e.from>e.to?(this.frame--,this.frame<e.to&&(i.loop?this.frame=e.from:(this.frame++,i.onEnd(),this.stop()))):(this.frame++,this.frame>e.to&&(i.loop?this.frame=e.from:(this.frame--,i.onEnd(),this.stop()))))}else this.frame=e},play(e,t={}){if(!r)return void s.add((()=>this.play(e,t)));let n=r.anims[e];if(void 0===n)throw new Error(`Anim not found: ${e}`);i&&this.stop(),i="number"==typeof n?{name:e,timer:0,loop:!1,pingpong:!1,speed:0,onEnd:()=>{}}:{name:e,timer:0,loop:t.loop??n.loop??!1,pingpong:t.pingpong??n.pingpong??!1,speed:t.speed??n.speed??10,onEnd:t.onEnd??(()=>{})},this.frame="number"==typeof n?n:n.from,this.trigger("animStart",e)},stop(){if(!i)return;let e=i.name;i=null,this.trigger("animEnd",e)},numFrames:()=>r?.frames.length??0,curAnim:()=>i?.name,onAnimEnd(e){return this.on("animEnd",e)},onAnimStart(e){return this.on("animStart",e)},renderArea(){return new O(c(0),this.width,this.height)},inspect(){if("string"==typeof e)return`"${e}"`}}}function tr(e,n={}){function r(e){let t=$t(Object.assign($n(e),{text:e.text+"",size:e.textSize,font:e.font,width:n.width&&e.width,align:e.align,letterSpacing:e.letterSpacing,lineSpacing:e.lineSpacing,transform:e.textTransform,styles:e.textStyles}));return n.width||(e.width=t.width/(e.scale?.x||1)),e.height=t.height/(e.scale?.y||1),t}return t(r,"update"),{id:"text",text:e,textSize:n.size??36,font:n.font,width:n.width,height:0,align:n.align,lineSpacing:n.lineSpacing,letterSpacing:n.letterSpacing,textTransform:n.transform,textStyles:n.styles,add(){gr((()=>r(this)))},draw(){tn(r(this))},renderArea(){return new O(c(0),this.width,this.height)}}}function nr(e,t,n={}){return{id:"rect",width:e,height:t,radius:n.radius||0,draw(){Lt(Object.assign($n(this),{width:this.width,height:this.height,radius:this.radius}))},renderArea(){return new O(c(0),this.width,this.height)},inspect(){return`${Math.ceil(this.width)}, ${Math.ceil(this.height)}`}}}function rr(e,t){return{id:"rect",width:e,height:t,draw(){Ct(Object.assign($n(this),{width:this.width,height:this.height}))},renderArea(){return new O(c(0),this.width,this.height)},inspect(){return`${Math.ceil(this.width)}, ${Math.ceil(this.height)}`}}}function ir(e){return{id:"circle",radius:e,draw(){qt(Object.assign($n(this),{radius:this.radius}))},renderArea(){return new O(new u(this.anchor?0:-this.radius),2*this.radius,2*this.radius)},inspect(){return`${Math.ceil(this.radius)}`}}}function sr(e=1,t=m(0,0,0)){return{id:"outline",outline:{width:e,color:t}}}function or(){return{id:"timer",wait(e,t){let n=[t],r=0,i=this.onUpdate((()=>{r+=dn(),r>=e&&(n.forEach((e=>e())),i.cancel())}));return{get paused(){return i.paused},set paused(e){i.paused=e},cancel:i.cancel,onEnd(e){n.push(e)},then(e){return this.onEnd(e),this}}},loop(e,n){let r=null,i=t((()=>{r=this.wait(e,i),n()}),"newAction");return r=Cn(0,i),{get paused(){return r.paused},set paused(e){r.paused=e},cancel:()=>r.cancel()}},tween(e,t,n,r,i=we.linear){let s=0,o=[],l=this.onUpdate((()=>{s+=dn();let h=Math.min(s/n,1);r(a(e,t,i(h))),1===h&&(l.cancel(),r(t),o.forEach((e=>e())))}));return{get paused(){return l.paused},set paused(e){l.paused=e},onEnd(e){o.push(e)},then(e){return this.onEnd(e),this},cancel(){l.cancel()},finish(){l.cancel(),r(t),o.forEach((e=>e()))}}}}}function ar(e={}){let t=c(0),n=null,r=null,i=!1;return{id:"body",require:["pos","area"],jumpForce:e.jumpForce??640,gravityScale:e.gravityScale??1,isStatic:e.isStatic??!1,mass:e.mass??1,add(){if(0===this.mass)throw new Error("Can't set body mass to 0");this.onCollideUpdate(((e,t)=>{if(e.is("body")&&!t.resolved&&(this.trigger("beforePhysicsResolve",t),e.trigger("beforePhysicsResolve",t.reverse()),!(t.resolved||this.isStatic&&e.isStatic))){if(this.isStatic||e.isStatic){let n=!this.isStatic&&e.isStatic?t:t.reverse();n.source.pos=n.source.pos.add(n.displacement),n.source.transform=wn(n.source)}else{let n=this.mass+e.mass;this.pos=this.pos.add(t.displacement.scale(e.mass/n)),e.pos=e.pos.add(t.displacement.scale(-this.mass/n)),this.transform=wn(this),e.transform=wn(e)}t.resolved=!0,this.trigger("physicsResolve",t),e.trigger("physicsResolve",t.reverse())}})),this.onPhysicsResolve((e=>{Le.gravity&&(e.isBottom()&&this.isFalling()?(t.y=0,n=e.target,r=e.target.pos,i?i=!1:this.trigger("ground",n)):e.isTop()&&this.isJumping()&&(t.y=0,this.trigger("headbutt",e.target)))}))},update(){if(!Le.gravity||this.isStatic)return;if(i&&(n=null,r=null,this.trigger("fallOff"),i=!1),n){if(this.isOverlapping(n)&&n.exists()&&n.is("body"))return!n.pos.eq(r)&&!1!==e.stickToPlatform&&this.moveBy(n.pos.sub(r)),void(r=n.pos);i=!0}let s=t.y;t.y+=Le.gravity*this.gravityScale*dn(),t.y=Math.min(t.y,e.maxVelocity??65536),s<0&&t.y>=0&&this.trigger("fall"),this.move(t)},onPhysicsResolve(e){return this.on("physicsResolve",e)},onBeforePhysicsResolve(e){return this.on("beforePhysicsResolve",e)},curPlatform:()=>n,isGrounded:()=>null!==n,isFalling:()=>t.y>0,isJumping:()=>t.y<0,jump(e){n=null,r=null,t.y=-e||-this.jumpForce},onGround(e){return this.on("ground",e)},onFall(e){return this.on("fall",e)},onFallOff(e){return this.on("fallOff",e)},onHeadbutt(e){return this.on("headbutt",e)}}}function lr(e=2){let t=e;return{id:"doubleJump",require:["body"],numJumps:e,add(){this.onGround((()=>{t=this.numJumps}))},doubleJump(e){t<=0||(t<this.numJumps&&this.trigger("doubleJump"),t--,this.jump(e))},onDoubleJump(e){return this.on("doubleJump",e)},inspect:()=>`${t}`}}function hr(e,t){return{id:"shader",shader:e,..."function"==typeof t?{uniform:t(),update(){this.uniform=t()}}:{uniform:t}}}function dr(){return{id:"fixed",fixed:!0}}function ur(e){return{id:"stay",stay:!0,scenesToStay:e}}function cr(e){if(null==e)throw new Error("health() requires the initial amount of hp");return{id:"health",hurt(t=1){this.setHP(e-t),this.trigger("hurt",t)},heal(t=1){this.setHP(e+t),this.trigger("heal",t)},hp:()=>e,setHP(t){(e=t)<=0&&this.trigger("death")},onHurt(e){return this.on("hurt",e)},onHeal(e){return this.on("heal",e)},onDeath(e){return this.on("death",e)},inspect:()=>`${e}`}}function pr(e,t={}){if(null==e)throw new Error("lifespan() requires time");let n=t.fade??0;return{id:"lifespan",async add(){await Cn(e),n>0&&this.opacity&&await _r(this.opacity,0,n,(e=>this.opacity=e),we.linear),this.destroy()}}}function fr(e,n,r){if(!e)throw new Error("state() requires an initial state");let i={};function s(e){i[e]||(i[e]={enter:new X,end:new X,update:new X,draw:new X})}function o(e,t,n){return s(t),i[t][e].add(n)}function a(e,t,...n){s(t),i[t][e].trigger(...n)}t(s,"initStateEvents"),t(o,"on"),t(a,"trigger");let l=!1;return{id:"state",state:e,enterState(e,...t){if(l=!0,n&&!n.includes(e))throw new Error(`State not found: ${e}`);let i=this.state;if(r){if(!r?.[i])return;let t="string"==typeof r[i]?[r[i]]:r[i];if(!t.includes(e))throw new Error(`Cannot transition state from "${i}" to "${e}". Available transitions: ${t.map((e=>`"${e}"`)).join(", ")}`)}a("end",i,...t),this.state=e,a("enter",e,...t),a("enter",`${i} -> ${e}`,...t)},onStateTransition:(e,t,n)=>o("enter",`${e} -> ${t}`,n),onStateEnter:(e,t)=>o("enter",e,t),onStateUpdate:(e,t)=>o("update",e,t),onStateDraw:(e,t)=>o("draw",e,t),onStateEnd:(e,t)=>o("end",e,t),update(){l||(a("enter",e),l=!0),a("update",this.state)},draw(){a("draw",this.state)},inspect(){return this.state}}}function mr(e=1){let t=0,n=!1;return{require:["opacity"],add(){this.opacity=0},update(){n||(t+=dn(),this.opacity=l(t,0,e,0,1),t>=e&&(this.opacity=1,n=!0))}}}function gr(e){De.loaded?e():Le.events.on("load",e)}function wr(e,t){Le.scenes[e]=t}function Ar(t,...n){if(!Le.scenes[t])throw new Error(`Scene not found: ${t}`);Le.events.onOnce("frameEnd",(()=>{Le.events.trigger("sceneLeave",t),Z.events.clear(),Le.events.clear(),Le.objEvents.clear(),[...Le.root.children].forEach((e=>{(!e.stay||e.scenesToStay&&!e.scenesToStay.includes(t))&&Le.root.remove(e)})),Le.root.clearEvents(),Le.cam={pos:null,scale:c(1),angle:0,shake:0,transform:new y},Le.scenes[t](...n),!1!==e.debug&&Un(),e.burp&&Dn()}))}function yr(e){return Le.events.on("sceneLeave",e)}function vr(e,t){try{return JSON.parse(window.localStorage[e])}catch{return t?(Vr(e,t),t):null}}function Vr(e,t){window.localStorage[e]=JSON.stringify(t)}function Er(t){let n=t(ti);for(let t in n)ti[t]=n[t],!1!==e.global&&(window[t]=n[t]);return ti}function xr(){return c(nn()/2,rn()/2)}var br;function Sr(e={}){let n=c(0),r=e.isObstacle??!1,i=e.cost??0,s=e.edges??[],o=t((()=>{let e={left:1,top:2,right:4,bottom:8};return s.map((t=>e[t]||0)).reduce(((e,t)=>e|t),0)}),"getEdgeMask"),a=o();return{id:"tile",tilePosOffset:e.offset??c(0),set tilePos(e){let t=this.getLevel();n=e.clone(),this.pos=c(this.tilePos.x*t.tileWidth(),this.tilePos.y*t.tileHeight()).add(this.tilePosOffset)},get tilePos(){return n},set isObstacle(e){r!==e&&(r=e,this.getLevel().invalidateNavigationMap())},get isObstacle(){return r},set cost(e){i!==e&&(i=e,this.getLevel().invalidateNavigationMap())},get cost(){return i},set edges(e){s=e,a=o(),this.getLevel().invalidateNavigationMap()},get edges(){return s},get edgeMask(){return a},getLevel(){return this.parent},moveLeft(){this.tilePos=this.tilePos.add(c(-1,0))},moveRight(){this.tilePos=this.tilePos.add(c(1,0))},moveUp(){this.tilePos=this.tilePos.add(c(0,-1))},moveDown(){this.tilePos=this.tilePos.add(c(0,1))}}}function Rr(e,n){if(!n.tileWidth||!n.tileHeight)throw new Error("Must provide tileWidth and tileHeight.");let r=Pr([qn(n.pos??c(0))]),i=e.length,s=0,o=null,a=null,l=null,h=null,d=t((e=>e.x+e.y*s),"tile2Hash"),u=t((e=>c(Math.floor(e%s),Math.floor(e/s))),"hash2Tile"),p=t((()=>{o=[];for(let e of r.children)f(e)}),"createSpatialMap"),f=t((e=>{let t=d(e.tilePos);o[t]?o[t].push(e):o[t]=[e]}),"insertIntoSpatialMap"),m=t((e=>{let t=d(e.tilePos);if(o[t]){let n=o[t].indexOf(e);n>=0&&o[t].splice(n,1)}}),"removeFromSpatialMap"),g=t((()=>{let e=!1;for(let t of r.children){let n=r.pos2Tile(t.pos);(t.tilePos.x!=n.x||t.tilePos.y!=n.y)&&(e=!0,m(t),t.tilePos.x=n.x,t.tilePos.y=n.y,f(t))}e&&r.trigger("spatial_map_changed")}),"updateSpatialMap"),w=t((()=>{let e=r.getSpatialMap(),t=r.numRows()*r.numColumns();a?a.length=t:a=new Array(t),a.fill(1,0,t);for(let t=0;t<e.length;t++){let n=e[t];if(n){let e=0;for(let t of n){if(t.isObstacle){e=1/0;break}e+=t.cost}a[t]=e||1}}}),"createCostMap"),A=t((()=>{let e=r.getSpatialMap(),t=r.numRows()*r.numColumns();l?l.length=t:l=new Array(t),l.fill(15,0,t);for(let t=0;t<e.length;t++){let n=e[t];if(n){let e=n.length,r=15;for(let t=0;t<e;t++)r|=n[t].edgeMask;l[t]=r}}}),"createEdgeMap"),y=t((()=>{let e=r.numRows()*r.numColumns(),n=t(((e,t)=>{let n=[];for(n.push(e);n.length>0;){let e=n.pop();E(e).forEach((e=>{h[e]<0&&(h[e]=t,n.push(e))}))}}),"traverse");h?h.length=e:h=new Array(e),h.fill(-1,0,e);let i=0;for(let e=0;e<a.length;e++)h[e]>=0||n(e,i),i++}),"createConnectivityMap"),v=t(((e,t)=>a[t]),"getCost"),V=t(((e,t)=>{let n=u(e),r=u(t);return n.dist(r)}),"getHeuristic"),E=t(((e,t)=>{let n=[],r=Math.floor(e%s),o=r>0&&1&l[e]&&a[e-1]!==1/0,h=e>=s&&2&l[e]&&a[e-s]!==1/0,d=r<s-1&&4&l[e]&&a[e+1]!==1/0,u=e<s*i-s-1&&8&l[e]&&a[e+s]!==1/0;return t?(o&&(h&&n.push(e-s-1),n.push(e-1),u&&n.push(e+s-1)),h&&n.push(e-s),d&&(h&&n.push(e-s+1),n.push(e+1),u&&n.push(e+s+1)),u&&n.push(e+s)):(o&&n.push(e-1),h&&n.push(e-s),d&&n.push(e+1),u&&n.push(e+s)),n}),"getNeighbours"),x={id:"level",tileWidth:()=>n.tileWidth,tileHeight:()=>n.tileHeight,spawn(e,...t){let i=c(...t),s=(()=>{if("string"!=typeof e){if(Array.isArray(e))return e;throw new Error("Expected a symbol or a component list")}if(n.tiles[e]){if("function"!=typeof n.tiles[e])throw new Error("Level symbol def must be a function returning a component list");return n.tiles[e](i)}if(n.wildcardTile)return n.wildcardTile(e,i)})();if(!s)return null;let a=!1,l=!1;for(let e of s)"tile"===e.id&&(l=!0),"pos"===e.id&&(a=!0);a||s.push(qn()),l||s.push(Sr());let h=r.add(s);return a&&(h.tilePosOffset=h.pos.clone()),h.tilePos=i,o&&(f(h),this.trigger("spatial_map_changed"),this.trigger("navigation_map_invalid")),h},numColumns:()=>s,numRows:()=>i,levelWidth(){return s*this.tileWidth()},levelHeight(){return i*this.tileHeight()},tile2Pos(...e){return c(...e).scale(this.tileWidth(),this.tileHeight())},pos2Tile(...e){let t=c(...e);return c(Math.floor(t.x/this.tileWidth()),Math.floor(t.y/this.tileHeight()))},getSpatialMap:()=>(o||p(),o),onSpatialMapChanged(e){return this.on("spatial_map_changed",e)},onNavigationMapInvalid(e){return this.on("navigation_map_invalid",e)},getAt(e){o||p();let t=d(e);return o[t]||[]},update(){o&&g()},invalidateNavigationMap(){a=null,l=null,h=null},onNavigationMapChanged(e){return this.on("navigation_map_changed",e)},getTilePath(e,t,n={}){if(a||w(),l||A(),h||y(),e.x<0||e.x>=s||e.y<0||e.y>=i||t.x<0||t.x>=s||t.y<0||t.y>=i)return null;let r=d(e),o=d(t);if(a[o]===1/0)return null;if(r===o)return[];if(-1!=h[r]&&h[r]!==h[o])return null;let c=new oe(((e,t)=>e.cost<t.cost));c.insert({cost:0,node:r});let p=new Map;p.set(r,r);let f=new Map;for(f.set(r,0);0!==c.length;){let e=c.remove()?.node;if(e===o)break;let t=E(e,n.allowDiagonals);for(let n of t){let t=(f.get(e)||0)+v(e,n)+V(n,o);(!f.has(n)||t<f.get(n))&&(f.set(n,t),c.insert({cost:t,node:n}),p.set(n,e))}}let m=[],g=o,x=u(g);for(m.push(x);g!==r;){g=p.get(g);let e=u(g);m.push(e)}return m.reverse()},getPath(e,t,n={}){let r=this.tileWidth(),i=this.tileHeight(),s=this.getTilePath(this.pos2Tile(e),this.pos2Tile(t),n);return s?[e,...s.slice(1,-1).map((e=>e.scale(r,i).add(r/2,i/2))),t]:null}};return r.use(x),r.onNavigationMapInvalid((()=>{r.invalidateNavigationMap(),r.trigger("navigation_map_changed")})),e.forEach(((e,t)=>{let n=e.split("");s=Math.max(n.length,s),n.forEach(((e,n)=>{r.spawn(e,c(n,t))}))})),r}function Mr(e={}){let t=null,n=null,r=null,i=null;return{id:"agent",require:["pos","tile"],agentSpeed:e.speed??100,allowDiagonals:e.allowDiagonals??!0,getDistanceToTarget(){return t?this.pos.dist(t):0},getNextLocation:()=>n&&r?n[r]:null,getPath:()=>n?n.slice():null,getTarget:()=>t,isNavigationFinished:()=>!n||null===r,isTargetReachable:()=>null!==n,isTargetReached(){return!t||this.pos.eq(t)},setTarget(e){t=e,n=this.getLevel().getPath(this.pos,t,{allowDiagonals:this.allowDiagonals}),r=n?0:null,n?(i||(i=this.getLevel().onNavigationMapChanged((()=>{n&&null!==r&&(n=this.getLevel().getPath(this.pos,t,{allowDiagonals:this.allowDiagonals}),r=n?0:null,n?this.trigger("navigation-next",this,n[r]):this.trigger("navigation-ended",this))})),this.onDestroy((()=>i.cancel()))),this.trigger("navigation-started",this),this.trigger("navigation-next",this,n[r])):this.trigger("navigation-ended",this)},update(){if(n&&null!==r){if(this.pos.sdist(n[r])<2){if(r===n.length-1)return this.pos=t.clone(),r=null,this.trigger("navigation-ended",this),void this.trigger("target-reached",this);r++,this.trigger("navigation-next",this,n[r])}this.moveTo(n[r],this.agentSpeed)}},onNavigationStarted(e){return this.on("navigation-started",e)},onNavigationNext(e){return this.on("navigation-next",e)},onNavigationEnded(e){return this.on("navigation-ended",e)},onTargetReached(e){return this.on("target-reached",e)},inspect:()=>JSON.stringify({target:JSON.stringify(t),path:JSON.stringify(n)})}}function Tr(e){let t=Z.canvas().captureStream(e),n=ge.ctx.createMediaStreamDestination();ge.masterNode.connect(n);let r=new MediaRecorder(t),i=[];return r.ondataavailable=e=>{e.data.size>0&&i.push(e.data)},r.onerror=()=>{ge.masterNode.disconnect(n),t.getTracks().forEach((e=>e.stop()))},r.start(),{resume(){r.resume()},pause(){r.pause()},stop:()=>(r.stop(),ge.masterNode.disconnect(n),t.getTracks().forEach((e=>e.stop())),new Promise((e=>{r.onstop=()=>{e(new Blob(i,{type:"video/mp4"}))}}))),download(e="kaboom.mp4"){this.stop().then((t=>ne(e,t)))}}}function Fr(){return document.activeElement===Z.canvas()}function Br(e){e.destroy()}t(xn,"onAdd"),t(bn,"onDestroy"),t(Sn,"onCollide"),t(Rn,"onCollideUpdate"),t(Mn,"onCollideEnd"),t(Tn,"forAllCurrentAndFuture"),t(Fn,"onClick"),t(Bn,"onHover"),t(Pn,"onHoverUpdate"),t(In,"onHoverEnd"),t(Cn,"wait"),t(kn,"loop"),t(Un,"enterDebugMode"),t(Dn,"enterBurpMode"),t(Ln,"setGravity"),t(Nn,"getGravity"),t(Gn,"setBackground"),t(On,"getBackground"),t(qn,"pos"),t(Hn,"scale"),t(Kn,"rotate"),t(Yn,"color"),t(jn,"toFixed"),t(Qn,"opacity"),t(Xn,"anchor"),t(zn,"z"),t(Jn,"follow"),t(Wn,"move"),t(Zn,"offscreen"),t(_n,"area"),t($n,"getRenderProps"),t((function(e){return{add(){for(let t of e)this.add(e)}}}),"children"),t(er,"sprite"),t(tr,"text"),t(nr,"rect"),t(rr,"uvquad"),t(ir,"circle"),t(sr,"outline"),t(or,"timer"),t(ar,"body"),t(lr,"doubleJump"),t(hr,"shader"),t(dr,"fixed"),t(ur,"stay"),t(cr,"health"),t(pr,"lifespan"),t(fr,"state"),t(mr,"fadeIn"),t(gr,"onLoad"),t(wr,"scene"),t(Ar,"go"),t(yr,"onSceneLeave"),t(vr,"getData"),t(Vr,"setData"),t(Er,"plug"),t(xr,"center"),(br=vn||={})[br.None=0]="None",br[br.Left=1]="Left",br[br.Top=2]="Top",br[br.LeftTop=3]="LeftTop",br[br.Right=4]="Right",br[br.Horizontal=5]="Horizontal",br[br.RightTop=6]="RightTop",br[br.HorizontalTop=7]="HorizontalTop",br[br.Bottom=8]="Bottom",br[br.LeftBottom=9]="LeftBottom",br[br.Vertical=10]="Vertical",br[br.LeftVertical=11]="LeftVertical",br[br.RightBottom=12]="RightBottom",br[br.HorizontalBottom=13]="HorizontalBottom",br[br.RightVertical=14]="RightVertical",br[br.All=15]="All",t(Sr,"tile"),t(Rr,"addLevel"),t(Mr,"agent"),t(Tr,"record"),t(Fr,"isFocused"),t(Br,"destroy");let Pr=Le.root.add.bind(Le.root),Ir=Le.root.readd.bind(Le.root),Cr=Le.root.removeAll.bind(Le.root),kr=Le.root.get.bind(Le.root);function Ur(e=2,t=1){let n=0;return{id:"boom",require:["scale"],update(){let r=Math.sin(n*e)*t;r<0&&this.destroy(),this.scale=c(r),n+=dn()}}}t(Ur,"boom");let Dr=$e(null,"data:image/png;base64,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"),Lr=$e(null,"data:image/png;base64,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");function Nr(e,t={}){let n=Pr([qn(e),ur()]),r=5*(t.speed||1),i=t.scale||1;n.add([er(Lr),Hn(0),Xn("center"),Ur(r,i),...t.comps??[]]);let s=n.add([er(Dr),Hn(0),Xn("center"),or(),...t.comps??[]]);return s.wait(.4/r,(()=>s.use(Ur(r,i)))),s.onDestroy((()=>n.destroy())),n}function Gr(){Le.root.update()}t(Nr,"addKaboom"),t(Gr,"updateFrame");class Or{source;target;displacement;resolved=!1;constructor(e,t,n,r=!1){this.source=e,this.target=t,this.displacement=n,this.resolved=r}reverse(){return new Or(this.target,this.source,this.displacement.scale(-1),this.resolved)}hasOverlap(){return!this.displacement.isZero()}isLeft(){return this.displacement.x>0}isRight(){return this.displacement.x<0}isTop(){return this.displacement.y>0}isBottom(){return this.displacement.y<0}preventResolution(){this.resolved=!0}}function qr(){let n={},r=e.hashGridSize||64,i=new y,s=[];function o(e){if(s.push(i.clone()),e.pos&&i.translate(e.pos),e.scale&&i.scale(e.scale),e.angle&&i.rotate(e.angle),e.transform=i.clone(),e.c("area")&&!e.paused){let t=e,i=t.worldArea().bbox(),s=Math.floor(i.pos.x/r),o=Math.floor(i.pos.y/r),a=Math.ceil((i.pos.x+i.width)/r),l=Math.ceil((i.pos.y+i.height)/r),h=new Set;for(let e=s;e<=a;e++)for(let r=o;r<=l;r++)if(n[e])if(n[e][r]){let i=n[e][r];e:for(let e of i){if(!e.exists()||h.has(e.id))continue;for(let n of t.collisionIgnore)if(e.is(n))continue e;for(let n of e.collisionIgnore)if(t.is(n))continue e;let n=Y(t.worldArea(),e.worldArea());if(n){let r=new Or(t,e,n);t.trigger("collideUpdate",e,r);let i=r.reverse();i.resolved=r.resolved,e.trigger("collideUpdate",t,i)}h.add(e.id)}i.push(t)}else n[e][r]=[t];else n[e]={},n[e][r]=[t]}e.children.forEach(o),i=s.pop()}t(o,"checkObj"),o(Le.root)}function Hr(){let e=Le.cam,t=u.fromAngle(S(0,360)).scale(e.shake);e.shake=a(e.shake,0,5*dn()),e.transform=(new y).translate(xr()).scale(e.scale).rotate(e.angle).translate((e.pos??xr()).scale(-1).add(t)),Le.root.draw(),Et()}function Kr(){let e=Ge();Le.events.numListeners("loading")>0?Le.events.trigger("loading",e):zt((()=>{let t=nn()/2,n=c(nn()/2,rn()/2).sub(c(t/2,12));Lt({pos:c(0),width:nn(),height:rn(),color:m(0,0,0)}),Lt({pos:n,width:t,height:24,fill:!1,outline:{width:4}}),Lt({pos:n,width:t*e,height:24})}))}function Yr(e,t){zt((()=>{let n=c(8);Pt(),Tt(e);let r=$t({text:t,font:Ee,size:16,pos:n,color:m(255,255,255),fixed:!0}),i=r.width+2*n.x,s=r.height+2*n.x;e.x+i>=nn()&&Tt(c(-i,0)),e.y+s>=rn()&&Tt(c(0,-s)),Lt({width:i,height:s,color:m(0,0,0),radius:4,opacity:.8,fixed:!0}),tn(r),It()}))}function jr(){if(hn.inspect){let e=null;for(let t of Le.root.get("*",{recursive:!0}))if(t.c("area")&&t.isHovering()){e=t;break}if(Le.root.drawInspect(),e){let t=[],n=e.inspect();for(let e in n)n[e]?t.push(`${e}: ${n[e]}`):t.push(`${e}`);Yr(an(ln()),t.join("\n"))}Yr(c(8),`FPS: ${hn.fps()}`)}hn.paused&&zt((()=>{Pt(),Tt(nn(),0),Tt(-8,8),Lt({width:32,height:32,anchor:"topright",color:m(0,0,0),opacity:.8,radius:4,fixed:!0});for(let e=1;e<=2;e++)Lt({width:4,height:19.2,anchor:"center",pos:c(-32/3*e,16),color:m(255,255,255),radius:2,fixed:!0});It()})),1!==hn.timeScale&&zt((()=>{Pt(),Tt(nn(),rn()),Tt(-8,-8);let e=$t({text:hn.timeScale.toFixed(1),font:Ee,size:16,color:m(255,255,255),pos:c(-8),anchor:"botright",fixed:!0});Lt({width:e.width+16+32,height:e.height+16,anchor:"botright",color:m(0,0,0),opacity:.8,radius:4,fixed:!0});for(let t=0;t<2;t++){let n=hn.timeScale<1;Ot({p1:c(-e.width-8*(n?2:3.5),-8),p2:c(-e.width-8*(n?2:3.5),-8-e.height),p3:c(-e.width-8*(n?3.5:2),-8-e.height/2),pos:c(8*-t*1+(n?-4:0),0),color:m(255,255,255),fixed:!0})}tn(e),It()})),hn.curRecording&&zt((()=>{Pt(),Tt(0,rn()),Tt(24,-24),qt({radius:12,color:m(255,0,0),opacity:v(0,1,4*Z.time()),fixed:!0}),It()})),hn.showLog&&Le.logs.length>0&&zt((()=>{Pt(),Tt(0,rn()),Tt(8,-8);let e=$t({text:Le.logs.join("\n"),font:Ee,pos:c(8,-8),anchor:"botleft",size:16,width:.6*nn(),lineSpacing:4,fixed:!0,styles:{time:{color:m(127,127,127)},info:{color:m(255,255,255)},error:{color:m(255,0,127)}}});Lt({width:e.width+16,height:e.height+16,anchor:"botleft",color:m(0,0,0),radius:4,opacity:.8,fixed:!0}),tn(e),It()}))}function Qr(e){Le.events.on("loading",e)}function Xr(e){Z.onResize(e)}function zr(e){Le.events.on("error",e)}function Jr(e){Z.run((()=>{zt((()=>{let t=nn(),n=rn(),r={size:36,width:t-64,letterSpacing:4,lineSpacing:4,font:Ee,fixed:!0};Lt({width:t,height:n,color:m(0,0,255),fixed:!0});let i=$t({...r,text:e.name,pos:c(32),color:m(255,128,0),fixed:!0});tn(i),en({...r,text:e.message,pos:c(32,32+i.height+16),fixed:!0}),It(),Le.events.trigger("error",e)}))}))}function Wr(e){ae.push(e)}function Zr(){Le.events.onOnce("frameEnd",(()=>{Z.quit();for(let e in sn)window.removeEventListener(e,sn[e]);le.clear(le.COLOR_BUFFER_BIT|le.DEPTH_BUFFER_BIT|le.STENCIL_BUFFER_BIT);let e=le.getParameter(le.MAX_TEXTURE_IMAGE_UNITS);for(let t=0;t<e;t++)le.activeTexture(le.TEXTURE0+t),le.bindTexture(le.TEXTURE_2D,null),le.bindTexture(le.TEXTURE_CUBE_MAP,null);le.bindBuffer(le.ARRAY_BUFFER,null),le.bindBuffer(le.ELEMENT_ARRAY_BUFFER,null),le.bindRenderbuffer(le.RENDERBUFFER,null),le.bindFramebuffer(le.FRAMEBUFFER,null),ae.forEach((e=>e())),le.deleteBuffer(pe.vbuf),le.deleteBuffer(pe.ibuf)}))}function _r(e,t,n,r,i=we.linear){let s=0,o=[],l=Vn((()=>{s+=dn();let h=Math.min(s/n,1);r(a(e,t,i(h))),1===h&&(l.cancel(),r(t),o.forEach((e=>e())))}));return{get paused(){return l.paused},set paused(e){l.paused=e},onEnd(e){o.push(e)},then(e){return this.onEnd(e),this},cancel(){l.cancel()},finish(){l.cancel(),r(t),o.forEach((e=>e()))}}}t(Or,"Collision"),t(qr,"checkFrame"),t(Hr,"drawFrame"),t(Kr,"drawLoadScreen"),t(Yr,"drawInspectText"),t(jr,"drawDebug"),!1!==e.debug&&Un(),e.burp&&Dn(),t(Qr,"onLoading"),t(Xr,"onResize"),t(zr,"onError"),t(Jr,"handleErr"),t(Wr,"onCleanup"),t(Zr,"quit"),t(_r,"tween");let $r=!0;function ei(){let t=B,n=le.drawingBufferWidth/t,r=le.drawingBufferHeight/t;if(Z.isFullscreen()){let e=window.innerWidth,t=window.innerHeight,i=n/r;if(e/t>i){let n=window.innerHeight*i;pe.viewport={x:(e-n)/2,y:0,width:n,height:t}}else{let n=window.innerWidth/i;pe.viewport={x:0,y:(t-n)/2,width:e,height:n}}}else if(e.letterbox){if(!e.width||!e.height)throw new Error("Letterboxing requires width and height defined.");let t=n/r,i=e.width/e.height;if(t>i){let e=r*i,t=(n-e)/2;pe.viewport={x:t,y:0,width:e,height:r}}else{let e=n/i,t=(r-e)/2;pe.viewport={x:0,y:t,width:n,height:e}}}else{if(e.stretch&&(!e.width||!e.height))throw new Error("Stretching requires width and height defined.");pe.viewport={x:0,y:0,width:n,height:r}}}Z.run((()=>{xt(),De.loaded||1===Ge()&&!$r&&(De.loaded=!0,Le.events.trigger("load")),!De.loaded&&!1!==e.loadingScreen||$r?Kr():(hn.paused||Gr(),qr(),Hr(),!1!==e.debug&&jr()),$r&&($r=!1),St(),Le.events.trigger("frameEnd")})),t(ei,"updateViewport"),Z.onResize((()=>{if(Z.isFullscreen())return;let t=e.width&&e.height;t&&!e.stretch&&!e.letterbox||(r.width=r.offsetWidth*B,r.height=r.offsetHeight*B,ei(),t||(pe.frameBuffer.free(),pe.frameBuffer=new ce(le.drawingBufferWidth,le.drawingBufferHeight),pe.width=le.drawingBufferWidth/B,pe.height=le.drawingBufferHeight/B))})),ei();let ti={VERSION:"3000.0.4",loadRoot:Oe,loadProgress:Ge,loadSprite:$e,loadSpriteAtlas:Ze,loadSound:it,loadBitmapFont:Je,loadFont:ze,loadShader:nt,loadShaderURL:rt,loadAseprite:tt,loadPedit:et,loadBean:st,loadJSON:Qe,load:Ne,getSprite:ot,getSound:at,getFont:lt,getBitmapFont:ht,getShader:dt,getAsset:ut,Asset:ke,SpriteData:fe,SoundData:me,width:nn,height:rn,center:xr,dt:dn,time:Z.time,screenshot:Z.screenshot,record:Tr,isFocused:Fr,setCursor:Z.setCursor,getCursor:Z.getCursor,setCursorLocked:Z.setCursorLocked,isCursorLocked:Z.isCursorLocked,setFullscreen:Z.setFullscreen,isFullscreen:Z.isFullscreen,isTouchscreen:Z.isTouchscreen,onLoad:gr,onLoading:Qr,onResize:Xr,onGamepadConnect:Z.onGamepadConnect,onGamepadDisconnect:Z.onGamepadDisconnect,onError:zr,onCleanup:Wr,camPos:un,camScale:cn,camRot:pn,shake:fn,toScreen:mn,toWorld:gn,setGravity:Ln,getGravity:Nn,setBackground:Gn,getBackground:On,getGamepads:Z.getGamepads,add:Pr,make:An,destroy:Br,destroyAll:Cr,get:kr,readd:Ir,pos:qn,scale:Hn,rotate:Kn,color:Yn,opacity:Qn,anchor:Xn,area:_n,sprite:er,text:tr,rect:nr,circle:ir,uvquad:rr,outline:sr,body:ar,doubleJump:lr,shader:hr,timer:or,fixed:dr,stay:ur,health:cr,lifespan:pr,z:zn,move:Wn,offscreen:Zn,follow:Jn,state:fr,fadeIn:mr,tile:Sr,agent:Mr,on:yn,onUpdate:Vn,onDraw:En,onAdd:xn,onDestroy:bn,onClick:Fn,onCollide:Sn,onCollideUpdate:Rn,onCollideEnd:Mn,onHover:Bn,onHoverUpdate:Pn,onHoverEnd:In,onKeyDown:Z.onKeyDown,onKeyPress:Z.onKeyPress,onKeyPressRepeat:Z.onKeyPressRepeat,onKeyRelease:Z.onKeyRelease,onMouseDown:Z.onMouseDown,onMousePress:Z.onMousePress,onMouseRelease:Z.onMouseRelease,onMouseMove:Z.onMouseMove,onCharInput:Z.onCharInput,onTouchStart:Z.onTouchStart,onTouchMove:Z.onTouchMove,onTouchEnd:Z.onTouchEnd,onScroll:Z.onScroll,onGamepadButtonDown:Z.onGamepadButtonDown,onGamepadButtonPress:Z.onGamepadButtonPress,onGamepadButtonRelease:Z.onGamepadButtonRelease,onGamepadStick:Z.onGamepadStick,mousePos:ln,mouseDeltaPos:Z.mouseDeltaPos,isKeyDown:Z.isKeyDown,isKeyPressed:Z.isKeyPressed,isKeyPressedRepeat:Z.isKeyPressedRepeat,isKeyReleased:Z.isKeyReleased,isMouseDown:Z.isMouseDown,isMousePressed:Z.isMousePressed,isMouseReleased:Z.isMouseReleased,isMouseMoved:Z.isMouseMoved,isGamepadButtonPressed:Z.isGamepadButtonPressed,isGamepadButtonDown:Z.isGamepadButtonDown,isGamepadButtonReleased:Z.isGamepadButtonReleased,charInputted:Z.charInputted,loop:kn,wait:Cn,play:wt,volume:gt,burp:At,audioCtx:ge.ctx,Timer:Ae,Line:G,Rect:O,Circle:q,Polygon:K,Vec2:u,Color:f,Mat4:y,Quad:w,RNG:E,rand:S,randi:R,randSeed:b,vec2:c,rgb:m,hsl2rgb:g,quad:A,choose:T,chance:M,lerp:a,tween:_r,easings:we,map:l,mapc:h,wave:v,deg2rad:i,rad2deg:s,testLineLine:P,testRectRect:F,testRectLine:I,testRectPoint:C,testCirclePolygon:L,testLinePoint:k,testLineCircle:U,drawSprite:Ut,drawText:en,formatText:$t,drawRect:Lt,drawLine:Nt,drawLines:Gt,drawTriangle:Ot,drawCircle:qt,drawEllipse:Ht,drawUVQuad:Ct,drawPolygon:Kt,drawFormattedText:tn,drawMasked:jt,drawSubtracted:Qt,pushTransform:Pt,popTransform:It,pushTranslate:Tt,pushScale:Ft,pushRotate:Bt,pushMatrix:Mt,usePostEffect:bt,debug:hn,scene:wr,go:Ar,onSceneLeave:yr,addLevel:Rr,getData:vr,setData:Vr,download:$,downloadJSON:te,downloadText:ee,downloadBlob:ne,plug:Er,ASCII_CHARS:ve,canvas:Z.canvas(),addKaboom:Nr,LEFT:u.LEFT,RIGHT:u.RIGHT,UP:u.UP,DOWN:u.DOWN,RED:f.RED,GREEN:f.GREEN,BLUE:f.BLUE,YELLOW:f.YELLOW,MAGENTA:f.MAGENTA,CYAN:f.CYAN,WHITE:f.WHITE,BLACK:f.BLACK,quit:Zr,Event:X,EventHandler:J,EventController:Q};if(e.plugins&&e.plugins.forEach(Er),!1!==e.global)for(let e in ti)window[e]=ti[e];return Z.canvas().focus(),ti}),"default");let Ue=0,De=document.querySelector(".start-solo"),Le=document.querySelector(".start-duo"),Ne=document.querySelector("body");function Ge(){location.reload()}Ne.innerHTML,De.addEventListener("click",(()=>{Ne.innerHTML="",ke({background:[255,204,204]}),loadSprite("block","/image/block1.png"),loadSprite("water","/image/water.png"),loadSprite("man","/image/mans.jpg"),loadSprite("bg","/image/bg.jpg"),loadSpriteAtlas("/image/hero.png",{left:{x:0,y:0,width:240,height:55,sliceX:5,anims:{idle:{from:0,to:4,speed:5,loop:!0}}},right:{x:0,y:45,width:240,height:55,sliceX:5,anims:{idle:{from:0,to:4,speed:5,loop:!0}}},runLeft:{x:0,y:90,width:384,height:55,sliceX:8,anims:{idle:{from:0,to:7,speed:15,loop:!0}}},runRight:{x:0,y:138,width:384,height:55,sliceX:8,anims:{idle:{from:0,to:7,speed:15,loop:!0}}},tireLeft:{x:0,y:185,width:240,height:55,sliceX:5,anims:{idle:{from:0,to:4,speed:5,loop:!0}}},tireRight:{x:0,y:240,width:240,height:55,sliceX:5,anims:{idle:{from:0,to:4,speed:5,loop:!0}}},jumpLeft:{x:0,y:285,width:240,height:55,sliceX:5,anims:{idle:{from:0,to:1,speed:5,loop:!0}}},jumpRight:{x:0,y:340,width:240,height:55,sliceX:5,anims:{idle:{from:0,to:1,speed:5,loop:!0}}}}),loadSpriteAtlas("image/monster1.png",{monster1Left:{}}),loadSpriteAtlas("/image/monster2.png",{monster2Left:{x:120,y:0,width:75,height:256,sliceY:4,anims:{idle:{from:0,to:3,speed:5,loop:!0}}}}),loadSpriteAtlas("/image/monster2Right.png",{monster2Right:{x:405,y:0,width:75,height:256,sliceY:4,anims:{idle:{from:0,to:3,speed:5,loop:!0}}}}),loadSpriteAtlas("/image/monster1.png",{monster1Left:{x:120,y:0,width:75,height:256,sliceY:4,anims:{idle:{from:0,to:3,speed:5,loop:!0}}}}),loadSpriteAtlas("/image/monster1Right.png",{monster1Right:{x:405,y:0,width:75,height:256,sliceY:4,anims:{idle:{from:0,to:3,speed:5,loop:!0}}}}),loadSpriteAtlas("/image/monster3.png",{monster3Right:{x:13,y:74,width:455,height:30,sliceX:7,anims:{idle:{from:0,to:6,speed:7,loop:!0}}},monster3Left:{x:13,y:211,width:455,height:33,sliceX:7,anims:{idle:{from:0,to:6,speed:7,loop:!0}}}}),scene("game",(()=>{add([sprite("bg"),scale(width()/580,height()/290)]),setGravity(1800),add([rect(width(),130),pos(0,height()-130),outline(4),area(),body({isStatic:!0}),opacity(0)]);const e=add([sprite("right",{anim:"idle"}),pos(width()/2,200),area(),scale(2),body(),"man"],2,2),t=360,n=200;let r="RIGHT";const i=add([text(0),pos(12,72),fixed(),{time:0}]);i.onUpdate((()=>{i.time+=dt(),i.text=i.time.toFixed(1)}));let s=0,o=0;onKeyPress("up",(()=>{e.isGrounded()&&e.jump()})),onKeyDown("right",(()=>{0===o&&e.use(sprite("runRight",{anim:"idle"})),e.move(t,0),r="RIGHT",o=1,s=0})),onKeyDown("left",(()=>{0===s&&e.use(sprite("runLeft",{anim:"idle"})),e.move(-360,0),r="LEFT",o=0,s=1})),onKeyPress("space",(()=>{var t;0===s&&0===o&&("RIGHT"===r?e.use(sprite("tireRight",{anim:"idle"})):e.use(sprite("tireLeft",{anim:"idle"})),["space"].forEach((t=>{onKeyRelease(t,(()=>{"RIGHT"===r?e.use(sprite("right",{anim:"idle"})):e.use(sprite("left",{anim:"idle"}))}))}))),o=0,s=0,t=e.pos.sub(0,-40),"LEFT"===r?add([rect(15,6),area(),pos(t),anchor("center"),color(127,127,255),outline(1),move(LEFT,1200),offscreen({destroy:!0}),"bullet"]):add([rect(15,6),area(),pos(t),anchor("center"),color(127,127,255),outline(1),move(RIGHT,1200),offscreen({destroy:!0}),"bullet"])})),["left","right"].forEach((t=>{onKeyRelease(t,(()=>{"RIGHT"===r?(e.use(sprite("right",{anim:"idle"})),o=0,s=0):(e.use(sprite("left",{anim:"idle"})),o=0,s=0)}))})),function e(){1===Math.floor(2*Math.random())?(add([sprite("monster3Left",{anim:"idle"}),scale(2),pos(width(),height()-120),anchor("bot"),move(LEFT,t),"tree"]),add([rect(12,68),area(),pos(width(),height()-95),anchor("bot"),opacity(0),move(LEFT,t),"tree"])):(add([sprite("monster3Right",{anim:"idle"}),scale(2),pos(-width(),height()-120),anchor("bot"),move(RIGHT,t),"tree"]),add([rect(12,68),area(),pos(-width(),height()-95),anchor("bot"),opacity(0),move(RIGHT,t),"tree"])),wait(rand(2,3),e)}(),function e(){let t=Math.floor(2*Math.random());if(0===Math.floor(2*Math.random()))if(0===t){let e=add([sprite("monster1Right",{anim:"idle"}),scale(2),area(),pos(0,20),body(),move(RIGHT,n),"enemy"]);e.onCollide("bullet",(t=>{destroy(e),destroy(t)}))}else{let e=add([sprite("monster1Left",{anim:"idle"}),scale(2),area(),pos(width(),20),body(),move(LEFT,n),"enemy"]);e.onCollide("bullet",(t=>{destroy(e),destroy(t)}))}else if(0===t){let e=add([sprite("monster2Right",{anim:"idle"}),scale(2),area(),pos(0,20),body(),move(RIGHT,n),"enemy"]);e.onCollide("bullet",(t=>{destroy(e),destroy(t)}))}else{let e=add([sprite("monster2Left",{anim:"idle"}),scale(2),area(),pos(width(),20),body(),move(LEFT,n),"enemy"]);e.onCollide("bullet",(t=>{destroy(e),destroy(t)}))}wait(rand(1,3),e)}(),e.onCollide("tree",(()=>{shake(),h()})),e.onCollide("enemy",(e=>{shake(),h(),destroy(e)}));let a=3;const l=add([text(a),anchor("center"),pos(width()/2,80),fixed(),z(100)]);function h(){a--,l.text=a,0===a&&(go("end"),Ue=i.text)}})),scene("end",(()=>{function e(e,t,n){const r=add([rect(240,80,{radius:8}),pos(t),area(),scale(1),anchor("center"),outline(4)]);return r.add([text(e),anchor("center"),color(0,0,0)]),r.onHoverUpdate((()=>{const e=10*time();r.color=hsl2rgb(e/10%1,.6,.7),r.scale=vec2(1.2),setCursor("pointer")})),r.onHoverEnd((()=>{r.scale=vec2(1),r.color=rgb()})),r.onClick(n),r}onUpdate((()=>setCursor("default"))),add([text("bravo votre score est de :"+Ue),pos(width()/2,height()/2),anchor("center")]),e("play again",vec2(200,100),(()=>go("game"))),e("Quit",vec2(200,200),(()=>Ge()))})),go("game")})),Le.addEventListener("click",(()=>{Ne.innerHTML="",ke({background:[255,204,204]}),loadSprite("block","/image/block1.png"),loadSprite("water","/image/water.png"),loadSprite("man","/image/mans.jpg"),loadSprite("bg","/image/bg.jpg"),loadSpriteAtlas("/image/hero.png",{left:{x:0,y:0,width:240,height:55,sliceX:5,anims:{idle:{from:0,to:4,speed:5,loop:!0}}},right:{x:0,y:45,width:240,height:55,sliceX:5,anims:{idle:{from:0,to:4,speed:5,loop:!0}}},runLeft:{x:0,y:90,width:384,height:55,sliceX:8,anims:{idle:{from:0,to:7,speed:15,loop:!0}}},runRight:{x:0,y:138,width:384,height:55,sliceX:8,anims:{idle:{from:0,to:7,speed:15,loop:!0}}},tireLeft:{x:0,y:185,width:240,height:55,sliceX:5,anims:{idle:{from:0,to:4,speed:5,loop:!0}}},tireRight:{x:0,y:240,width:240,height:55,sliceX:5,anims:{idle:{from:0,to:4,speed:5,loop:!0}}},jumpLeft:{x:0,y:285,width:240,height:55,sliceX:5,anims:{idle:{from:0,to:1,speed:5,loop:!0}}},jumpRight:{x:0,y:340,width:240,height:55,sliceX:5,anims:{idle:{from:0,to:1,speed:5,loop:!0}}}}),loadSpriteAtlas("image/monster1.png",{monster1Left:{}}),loadSpriteAtlas("/image/monster2.png",{monster2Left:{x:120,y:0,width:75,height:256,sliceY:4,anims:{idle:{from:0,to:3,speed:5,loop:!0}}}}),loadSpriteAtlas("/image/monster2Right.png",{monster2Right:{x:405,y:0,width:75,height:256,sliceY:4,anims:{idle:{from:0,to:3,speed:5,loop:!0}}}}),loadSpriteAtlas("/image/monster1.png",{monster1Left:{x:120,y:0,width:75,height:256,sliceY:4,anims:{idle:{from:0,to:3,speed:5,loop:!0}}}}),loadSpriteAtlas("/image/monster1Right.png",{monster1Right:{x:405,y:0,width:75,height:256,sliceY:4,anims:{idle:{from:0,to:3,speed:5,loop:!0}}}}),loadSpriteAtlas("/image/monster3.png",{monster3Right:{x:13,y:74,width:455,height:30,sliceX:7,anims:{idle:{from:0,to:6,speed:7,loop:!0}}},monster3Left:{x:13,y:211,width:455,height:33,sliceX:7,anims:{idle:{from:0,to:6,speed:7,loop:!0}}}}),scene("game",(()=>{add([sprite("bg"),scale(width()/580,height()/290)]),setGravity(1800),add([rect(width(),130),pos(0,height()-130),outline(4),area(),body({isStatic:!0}),opacity(0)]);const e=add([sprite("right",{anim:"idle"}),pos(width()/2,200),area(),scale(2),body(),"man"],2,2),t=add([sprite("right",{anim:"idle"}),pos(width()/2,200),area(),scale(2),body(),"man2"],2,2),n=360,r=200,i=1200;let s="RIGHT",o="RIGHT";const a=add([text(0),pos(12,72),fixed(),{time:0}]);a.onUpdate((()=>{a.time+=dt(),a.text=a.time.toFixed(1)}));let l=0,h=0,d=0,u=0;onKeyPress("up",(()=>{e.isGrounded()&&e.jump()})),onKeyPress("z",(()=>{t.isGrounded()&&t.jump()})),onKeyDown("right",(()=>{0===h&&e.use(sprite("runRight",{anim:"idle"})),e.move(n,0),s="RIGHT",h=1,l=0})),onKeyDown("d",(()=>{0===u&&t.use(sprite("runRight",{anim:"idle"})),t.move(n,0),o="RIGHT",u=1,d=0})),onKeyDown("left",(()=>{0===l&&e.use(sprite("runLeft",{anim:"idle"})),e.move(-360,0),s="LEFT",h=0,l=1})),onKeyDown("q",(()=>{0===d&&t.use(sprite("runLeft",{anim:"idle"})),t.move(-360,0),o="LEFT",u=0,d=1})),onKeyPress("space",(()=>{var t;0===l&&0===h&&("RIGHT"===s?e.use(sprite("tireRight",{anim:"idle"})):e.use(sprite("tireLeft",{anim:"idle"})),["space"].forEach((t=>{onKeyRelease(t,(()=>{"RIGHT"===s?e.use(sprite("right",{anim:"idle"})):e.use(sprite("left",{anim:"idle"}))}))}))),h=0,l=0,t=e.pos.sub(0,-40),"LEFT"===s?add([rect(15,6),area(),pos(t),anchor("center"),color(127,127,255),outline(1),move(LEFT,i),offscreen({destroy:!0}),"bullet"]):add([rect(15,6),area(),pos(t),anchor("center"),color(127,127,255),outline(1),move(RIGHT,i),offscreen({destroy:!0}),"bullet"])})),onKeyPress("a",(()=>{var e;0===d&&0===u&&("RIGHT"===o?t.use(sprite("tireRight",{anim:"idle"})):t.use(sprite("tireLeft",{anim:"idle"})),["a"].forEach((e=>{onKeyRelease(e,(()=>{"RIGHT"===o?t.use(sprite("right",{anim:"idle"})):t.use(sprite("left",{anim:"idle"}))}))}))),u=0,d=0,e=t.pos.sub(0,-40),"LEFT"===o?add([rect(15,6),area(),pos(e),anchor("center"),color(127,127,255),outline(1),move(LEFT,i),offscreen({destroy:!0}),"bullet"]):add([rect(15,6),area(),pos(e),anchor("center"),color(127,127,255),outline(1),move(RIGHT,i),offscreen({destroy:!0}),"bullet"])})),["left","right"].forEach((t=>{onKeyRelease(t,(()=>{"RIGHT"===s?(e.use(sprite("right",{anim:"idle"})),h=0,l=0):(e.use(sprite("left",{anim:"idle"})),h=0,l=0)}))})),["q","d"].forEach((e=>{onKeyRelease(e,(()=>{"d"===o?(t.use(sprite("right",{anim:"idle"})),u=0,d=0):(t.use(sprite("left",{anim:"idle"})),u=0,d=0)}))})),function e(){1===Math.floor(2*Math.random())?(add([sprite("monster3Left",{anim:"idle"}),scale(2),pos(width(),height()-120),anchor("bot"),move(LEFT,n),"tree"]),add([rect(12,68),area(),pos(width(),height()-95),anchor("bot"),opacity(0),move(LEFT,n),"tree"])):(add([sprite("monster3Right",{anim:"idle"}),scale(2),pos(-width(),height()-120),anchor("bot"),move(RIGHT,n),"tree"]),add([rect(12,68),area(),pos(-width(),height()-95),anchor("bot"),opacity(0),move(RIGHT,n),"tree"])),wait(rand(2,3),e)}(),function e(){let t=Math.floor(2*Math.random());if(0===Math.floor(2*Math.random()))if(0===t){let e=add([sprite("monster1Right",{anim:"idle"}),scale(2),area(),pos(0,20),body(),move(RIGHT,r),"enemy"]);e.onCollide("bullet",(t=>{destroy(e),destroy(t)}))}else{let e=add([sprite("monster1Left",{anim:"idle"}),scale(2),area(),pos(width(),20),body(),move(LEFT,r),"enemy"]);e.onCollide("bullet",(t=>{destroy(e),destroy(t)}))}else if(0===t){let e=add([sprite("monster2Right",{anim:"idle"}),scale(2),area(),pos(0,20),body(),move(RIGHT,r),"enemy"]);e.onCollide("bullet",(t=>{destroy(e),destroy(t)}))}else{let e=add([sprite("monster2Left",{anim:"idle"}),scale(2),area(),pos(width(),20),body(),move(LEFT,r),"enemy"]);e.onCollide("bullet",(t=>{destroy(e),destroy(t)}))}wait(rand(1,3),e)}(),e.onCollide("tree",(()=>{shake(),g()})),t.onCollide("tree",(()=>{shake(),w()})),e.onCollide("enemy",(e=>{shake(),g(),destroy(e)})),t.onCollide("enemy",(e=>{shake(),w(),destroy(e)}));let c=3,p=3;const f=add([text(c),anchor("center"),pos(width()/2,80),fixed(),z(100)]),m=add([text(p),anchor("center"),pos(width()/2,160),fixed(),z(100)]);function g(){c--,f.text=c,0===c&&(destroy(e),0===c&&0===p&&(go("end"),Ue=a.text))}function w(){p--,m.text=c,0===p&&(destroy(t),0===c&&0===p&&(go("end"),Ue=a.text))}})),scene("end",(()=>{function e(e,t,n){const r=add([rect(240,80,{radius:8}),pos(t),area(),scale(1),anchor("center"),outline(4)]);return r.add([text(e),anchor("center"),color(0,0,0)]),r.onHoverUpdate((()=>{const e=10*time();r.color=hsl2rgb(e/10%1,.6,.7),r.scale=vec2(1.2),setCursor("pointer")})),r.onHoverEnd((()=>{r.scale=vec2(1),r.color=rgb()})),r.onClick(n),r}onUpdate((()=>setCursor("default"))),add([text("bravo votre score est de :"+Ue),pos(width()/2,height()/2),anchor("center")]),e("play again",vec2(200,100),(()=>go("game"))),e("Quit",vec2(200,200),(()=>Ge()))})),go("game")}))})();
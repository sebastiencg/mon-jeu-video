(()=>{"use strict";var e=Object.defineProperty,t=(t,n)=>e(t,"name",{value:n,configurable:!0}),n=(t,n,r)=>(((t,n,r)=>{n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[n]=r})(t,"symbol"!=typeof n?n+"":n,r),r),r=(()=>{for(var e=new Uint8Array(128),t=0;t<64;t++)e[t<26?t+65:t<52?t+71:t<62?t-4:4*t-205]=t;return t=>{for(var n=t.length,r=new Uint8Array(3*(n-("="==t[n-1])-("="==t[n-2]))/4|0),i=0,s=0;i<n;){var o=e[t.charCodeAt(i++)],a=e[t.charCodeAt(i++)],h=e[t.charCodeAt(i++)],l=e[t.charCodeAt(i++)];r[s++]=o<<2|a>>4,r[s++]=a<<4|h>>2,r[s++]=h<<6|l}return r}})();function i(e){return e*Math.PI/180}function s(e){return 180*e/Math.PI}function o(e,t,n){return t>n?o(e,n,t):Math.min(Math.max(e,t),n)}function a(e,t,n){if("number"==typeof e&&"number"==typeof t)return e+(t-e)*n;if(e instanceof d&&t instanceof d)return e.lerp(t,n);if(e instanceof p&&t instanceof p)return e.lerp(t,n);throw new Error(`Bad value for lerp(): ${e}, ${t}. Only number, Vec2 and Color is supported.`)}function h(e,t,n,r,i){return r+(e-t)/(n-t)*(i-r)}function l(e,t,n,r,i){return o(h(e,t,n,r,i),r,i)}t(i,"deg2rad"),t(s,"rad2deg"),t(o,"clamp"),t(a,"lerp"),t(h,"map"),t(l,"mapc");var u=class{x=0;y=0;constructor(e=0,t=e){this.x=e,this.y=t}static fromAngle(e){let t=i(e);return new u(Math.cos(t),Math.sin(t))}clone(){return new u(this.x,this.y)}add(...e){let t=c(...e);return new u(this.x+t.x,this.y+t.y)}sub(...e){let t=c(...e);return new u(this.x-t.x,this.y-t.y)}scale(...e){let t=c(...e);return new u(this.x*t.x,this.y*t.y)}dist(...e){let t=c(...e);return this.sub(t).len()}sdist(...e){let t=c(...e);return this.sub(t).slen()}len(){return Math.sqrt(this.dot(this))}slen(){return this.dot(this)}unit(){let e=this.len();return 0===e?new u(0):this.scale(1/e)}normal(){return new u(this.y,-this.x)}reflect(e){return this.sub(e.scale(2*this.dot(e)))}project(e){return e.scale(e.dot(this)/e.len())}reject(e){return this.sub(this.project(e))}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}angle(...e){let t=c(...e);return s(Math.atan2(this.y-t.y,this.x-t.x))}angleBetween(...e){let t=c(...e);return s(Math.atan2(this.cross(t),this.dot(t)))}lerp(e,t){return new u(a(this.x,e.x,t),a(this.y,e.y,t))}slerp(e,t){let n=this.dot(e),r=this.cross(e),i=Math.atan2(r,n);return this.scale(Math.sin((1-t)*i)).add(e.scale(Math.sin(t*i))).scale(1/r)}isZero(){return 0===this.x&&0===this.y}toFixed(e){return new u(Number(this.x.toFixed(e)),Number(this.y.toFixed(e)))}transform(e){return e.multVec2(this)}eq(e){return this.x===e.x&&this.y===e.y}bbox(){return new G(this,0,0)}toString(){return`vec2(${this.x.toFixed(2)}, ${this.y.toFixed(2)})`}},d=u;function c(...e){if(1===e.length){if(e[0]instanceof d)return new d(e[0].x,e[0].y);if(Array.isArray(e[0])&&2===e[0].length)return new d(...e[0])}return new d(...e)}t(d,"Vec2"),n(d,"LEFT",new u(-1,0)),n(d,"RIGHT",new u(1,0)),n(d,"UP",new u(0,-1)),n(d,"DOWN",new u(0,1)),t(c,"vec2");var f=class{r=255;g=255;b=255;constructor(e,t,n){this.r=o(e,0,255),this.g=o(t,0,255),this.b=o(n,0,255)}static fromArray(e){return new f(e[0],e[1],e[2])}static fromHex(e){if("number"==typeof e)return new f(e>>16&255,e>>8&255,e>>0&255);if("string"==typeof e){let t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return new f(parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16))}throw new Error("Invalid hex color format")}static fromHSL(e,n,r){if(0==n)return new f(255*r,255*r,255*r);let i=t(((e,t,n)=>(n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+(t-e)*(2/3-n)*6:e)),"hue2rgb"),s=r<.5?r*(1+n):r+n-r*n,o=2*r-s,a=i(o,s,e+1/3),h=i(o,s,e),l=i(o,s,e-1/3);return new f(Math.round(255*a),Math.round(255*h),Math.round(255*l))}clone(){return new f(this.r,this.g,this.b)}lighten(e){return new f(this.r+e,this.g+e,this.b+e)}darken(e){return this.lighten(-e)}invert(){return new f(255-this.r,255-this.g,255-this.b)}mult(e){return new f(this.r*e.r/255,this.g*e.g/255,this.b*e.b/255)}lerp(e,t){return new f(a(this.r,e.r,t),a(this.g,e.g,t),a(this.b,e.b,t))}eq(e){return this.r===e.r&&this.g===e.g&&this.b===e.b}toString(){return`rgb(${this.r}, ${this.g}, ${this.b})`}toHex(){return"#"+((1<<24)+(this.r<<16)+(this.g<<8)+this.b).toString(16).slice(1)}},p=f;function g(...e){if(0===e.length)return new p(255,255,255);if(1===e.length){if(e[0]instanceof p)return e[0].clone();if("string"==typeof e[0])return p.fromHex(e[0]);if(Array.isArray(e[0])&&3===e[0].length)return p.fromArray(e[0])}return new p(...e)}t(p,"Color"),n(p,"RED",new f(255,0,0)),n(p,"GREEN",new f(0,255,0)),n(p,"BLUE",new f(0,0,255)),n(p,"YELLOW",new f(255,255,0)),n(p,"MAGENTA",new f(255,0,255)),n(p,"CYAN",new f(0,255,255)),n(p,"WHITE",new f(255,255,255)),n(p,"BLACK",new f(0,0,0)),t(g,"rgb");var m=t(((e,t,n)=>p.fromHSL(e,t,n)),"hsl2rgb"),w=class{x=0;y=0;w=1;h=1;constructor(e,t,n,r){this.x=e,this.y=t,this.w=n,this.h=r}scale(e){return new w(this.x+this.w*e.x,this.y+this.h*e.y,this.w*e.w,this.h*e.h)}pos(){return new d(this.x,this.y)}clone(){return new w(this.x,this.y,this.w,this.h)}eq(e){return this.x===e.x&&this.y===e.y&&this.w===e.w&&this.h===e.h}toString(){return`quad(${this.x}, ${this.y}, ${this.w}, ${this.h})`}};function A(e,t,n,r){return new w(e,t,n,r)}t(w,"Quad"),t(A,"quad");var V=class{m=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];constructor(e){e&&(this.m=e)}static translate(e){return new V([1,0,0,0,0,1,0,0,0,0,1,0,e.x,e.y,0,1])}static scale(e){return new V([e.x,0,0,0,0,e.y,0,0,0,0,1,0,0,0,0,1])}static rotateX(e){e=i(-e);let t=Math.cos(e),n=Math.sin(e);return new V([1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1])}static rotateY(e){e=i(-e);let t=Math.cos(e),n=Math.sin(e);return new V([t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1])}static rotateZ(e){e=i(-e);let t=Math.cos(e),n=Math.sin(e);return new V([t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1])}translate(e){return this.m[12]+=this.m[0]*e.x+this.m[4]*e.y,this.m[13]+=this.m[1]*e.x+this.m[5]*e.y,this.m[14]+=this.m[2]*e.x+this.m[6]*e.y,this.m[15]+=this.m[3]*e.x+this.m[7]*e.y,this}scale(e){return this.m[0]*=e.x,this.m[4]*=e.y,this.m[1]*=e.x,this.m[5]*=e.y,this.m[2]*=e.x,this.m[6]*=e.y,this.m[3]*=e.x,this.m[7]*=e.y,this}rotate(e){e=i(-e);let t=Math.cos(e),n=Math.sin(e),r=this.m[0],s=this.m[1],o=this.m[4],a=this.m[5];return this.m[0]=r*t+s*n,this.m[1]=-r*n+s*t,this.m[4]=o*t+a*n,this.m[5]=-o*n+a*t,this}mult(e){let t=[];for(let n=0;n<4;n++)for(let r=0;r<4;r++)t[4*n+r]=this.m[0+r]*e.m[4*n+0]+this.m[4+r]*e.m[4*n+1]+this.m[8+r]*e.m[4*n+2]+this.m[12+r]*e.m[4*n+3];return new V(t)}multVec2(e){return new d(e.x*this.m[0]+e.y*this.m[4]+this.m[12],e.x*this.m[1]+e.y*this.m[5]+this.m[13])}getTranslation(){return new d(this.m[12],this.m[13])}getScale(){if(0!=this.m[0]||0!=this.m[1]){let e=this.m[0]*this.m[5]-this.m[1]*this.m[4],t=Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]);return new d(t,e/t)}if(0!=this.m[4]||0!=this.m[5]){let e=this.m[0]*this.m[5]-this.m[1]*this.m[4],t=Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]);return new d(e/t,t)}return new d(0,0)}getRotation(){if(0!=this.m[0]||0!=this.m[1]){let e=Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]);return s(this.m[1]>0?Math.acos(this.m[0]/e):-Math.acos(this.m[0]/e))}if(0!=this.m[4]||0!=this.m[5]){let e=Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]);return s(Math.PI/2-(this.m[5]>0?Math.acos(-this.m[4]/e):-Math.acos(this.m[4]/e)))}return 0}getSkew(){if(0!=this.m[0]||0!=this.m[1]){let e=Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]);return new d(Math.atan(this.m[0]*this.m[4]+this.m[1]*this.m[5])/(e*e),0)}if(0!=this.m[4]||0!=this.m[5]){let e=Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]);return new d(0,Math.atan(this.m[0]*this.m[4]+this.m[1]*this.m[5])/(e*e))}return new d(0,0)}invert(){let e=[],t=this.m[10]*this.m[15]-this.m[14]*this.m[11],n=this.m[9]*this.m[15]-this.m[13]*this.m[11],r=this.m[9]*this.m[14]-this.m[13]*this.m[10],i=this.m[8]*this.m[15]-this.m[12]*this.m[11],s=this.m[8]*this.m[14]-this.m[12]*this.m[10],o=this.m[8]*this.m[13]-this.m[12]*this.m[9],a=this.m[6]*this.m[15]-this.m[14]*this.m[7],h=this.m[5]*this.m[15]-this.m[13]*this.m[7],l=this.m[5]*this.m[14]-this.m[13]*this.m[6],u=this.m[4]*this.m[15]-this.m[12]*this.m[7],d=this.m[4]*this.m[14]-this.m[12]*this.m[6],c=this.m[5]*this.m[15]-this.m[13]*this.m[7],f=this.m[4]*this.m[13]-this.m[12]*this.m[5],p=this.m[6]*this.m[11]-this.m[10]*this.m[7],g=this.m[5]*this.m[11]-this.m[9]*this.m[7],m=this.m[5]*this.m[10]-this.m[9]*this.m[6],w=this.m[4]*this.m[11]-this.m[8]*this.m[7],A=this.m[4]*this.m[10]-this.m[8]*this.m[6],v=this.m[4]*this.m[9]-this.m[8]*this.m[5];e[0]=this.m[5]*t-this.m[6]*n+this.m[7]*r,e[4]=-(this.m[4]*t-this.m[6]*i+this.m[7]*s),e[8]=this.m[4]*n-this.m[5]*i+this.m[7]*o,e[12]=-(this.m[4]*r-this.m[5]*s+this.m[6]*o),e[1]=-(this.m[1]*t-this.m[2]*n+this.m[3]*r),e[5]=this.m[0]*t-this.m[2]*i+this.m[3]*s,e[9]=-(this.m[0]*n-this.m[1]*i+this.m[3]*o),e[13]=this.m[0]*r-this.m[1]*s+this.m[2]*o,e[2]=this.m[1]*a-this.m[2]*h+this.m[3]*l,e[6]=-(this.m[0]*a-this.m[2]*u+this.m[3]*d),e[10]=this.m[0]*c-this.m[1]*u+this.m[3]*f,e[14]=-(this.m[0]*l-this.m[1]*d+this.m[2]*f),e[3]=-(this.m[1]*p-this.m[2]*g+this.m[3]*m),e[7]=this.m[0]*p-this.m[2]*w+this.m[3]*A,e[11]=-(this.m[0]*g-this.m[1]*w+this.m[3]*v),e[15]=this.m[0]*m-this.m[1]*A+this.m[2]*v;let y=this.m[0]*e[0]+this.m[1]*e[4]+this.m[2]*e[8]+this.m[3]*e[12];for(let t=0;t<4;t++)for(let n=0;n<4;n++)e[4*t+n]*=1/y;return new V(e)}clone(){return new V([...this.m])}toString(){return this.m.toString()}};function v(e,t,n,r=Math.sin){return e+(r(n)+1)/2*(t-e)}t(V,"Mat4"),t(v,"wave");var y=2147483648,E=class{seed;constructor(e){this.seed=e}gen(){return this.seed=(1103515245*this.seed+12345)%y,this.seed/y}genNumber(e,t){return e+this.gen()*(t-e)}genVec2(e,t){return new d(this.genNumber(e.x,t.x),this.genNumber(e.y,t.y))}genColor(e,t){return new p(this.genNumber(e.r,t.r),this.genNumber(e.g,t.g),this.genNumber(e.b,t.b))}genAny(...e){if(0===e.length)return this.gen();if(1===e.length){if("number"==typeof e[0])return this.genNumber(0,e[0]);if(e[0]instanceof d)return this.genVec2(c(0,0),e[0]);if(e[0]instanceof p)return this.genColor(g(0,0,0),e[0])}else if(2===e.length){if("number"==typeof e[0]&&"number"==typeof e[1])return this.genNumber(e[0],e[1]);if(e[0]instanceof d&&e[1]instanceof d)return this.genVec2(e[0],e[1]);if(e[0]instanceof p&&e[1]instanceof p)return this.genColor(e[0],e[1])}}};t(E,"RNG");var x=new E(Date.now());function b(e){return null!=e&&(x.seed=e),x.seed}function S(...e){return x.genAny(...e)}function R(...e){return Math.floor(S(...e))}function M(e){return S()<=e}function T(e){return e[R(e.length)]}function F(e,t){return e.pos.x+e.width>t.pos.x&&e.pos.x<t.pos.x+t.width&&e.pos.y+e.height>t.pos.y&&e.pos.y<t.pos.y+t.height}function B(e,t){if(e.p1.x===e.p2.x&&e.p1.y===e.p2.y||t.p1.x===t.p2.x&&t.p1.y===t.p2.y)return null;let n=(t.p2.y-t.p1.y)*(e.p2.x-e.p1.x)-(t.p2.x-t.p1.x)*(e.p2.y-e.p1.y);if(0===n)return null;let r=((t.p2.x-t.p1.x)*(e.p1.y-t.p1.y)-(t.p2.y-t.p1.y)*(e.p1.x-t.p1.x))/n,i=((e.p2.x-e.p1.x)*(e.p1.y-t.p1.y)-(e.p2.y-e.p1.y)*(e.p1.x-t.p1.x))/n;return r<0||r>1||i<0||i>1?null:r}function P(e,t){let n=B(e,t);return n?c(e.p1.x+n*(e.p2.x-e.p1.x),e.p1.y+n*(e.p2.y-e.p1.y)):null}function I(e,t){if(C(e,t.p1)||C(e,t.p2))return!0;let n=e.points();return!!(P(t,new O(n[0],n[1]))||P(t,new O(n[1],n[2]))||P(t,new O(n[2],n[3]))||P(t,new O(n[3],n[0])))}function C(e,t){return t.x>e.pos.x&&t.x<e.pos.x+e.width&&t.y>e.pos.y&&t.y<e.pos.y+e.height}function U(e,t){let n=t.sub(e.p1),r=e.p2.sub(e.p1);if(Math.abs(n.cross(r))>Number.EPSILON)return!1;let i=n.dot(r)/r.dot(r);return i>=0&&i<=1}function D(e,t){let n=e.p2.sub(e.p1),r=n.dot(n),i=e.p1.sub(t.center),s=2*n.dot(i),o=s*s-4*r*(i.dot(i)-t.radius*t.radius);if(r<=Number.EPSILON||o<0)return!1;if(0==o){let e=-s/(2*r);if(e>=0&&e<=1)return!0}else{let e=(-s+Math.sqrt(o))/(2*r),t=(-s-Math.sqrt(o))/(2*r);if(e>=0&&e<=1||t>=0&&t<=1)return!0}return k(t,e.p1)}function k(e,t){return e.center.sdist(t)<e.radius*e.radius}function L(e,t){let n=t.pts[t.pts.length-1];for(let r of t.pts){if(D(new O(n,r),e))return!0;n=r}return!!k(e,t.pts[0])||N(t,e.center)}function N(e,t){let n=!1,r=e.pts;for(let e=0,i=r.length-1;e<r.length;i=e++)r[e].y>t.y!=r[i].y>t.y&&t.x<(r[i].x-r[e].x)*(t.y-r[e].y)/(r[i].y-r[e].y)+r[e].x&&(n=!n);return n}t(b,"randSeed"),t(S,"rand"),t(R,"randi"),t(M,"chance"),t(T,"choose"),t(F,"testRectRect"),t(B,"testLineLineT"),t(P,"testLineLine"),t(I,"testRectLine"),t(C,"testRectPoint"),t(U,"testLinePoint"),t(D,"testLineCircle"),t(k,"testCirclePoint"),t(L,"testCirclePolygon"),t(N,"testPolygonPoint");var O=class{p1;p2;constructor(e,t){this.p1=e.clone(),this.p2=t.clone()}transform(e){return new O(e.multVec2(this.p1),e.multVec2(this.p2))}bbox(){return G.fromPoints(this.p1,this.p2)}area(){return this.p1.dist(this.p2)}clone(){return new O(this.p1,this.p2)}};t(O,"Line");var G=class{pos;width;height;constructor(e,t,n){this.pos=e.clone(),this.width=t,this.height=n}static fromPoints(e,t){return new G(e.clone(),t.x-e.x,t.y-e.y)}center(){return new d(this.pos.x+this.width/2,this.pos.y+this.height/2)}points(){return[this.pos,this.pos.add(this.width,0),this.pos.add(this.width,this.height),this.pos.add(0,this.height)]}transform(e){return new Y(this.points().map((t=>e.multVec2(t))))}bbox(){return this.clone()}area(){return this.width*this.height}clone(){return new G(this.pos.clone(),this.width,this.height)}distToPoint(e){return Math.sqrt(this.sdistToPoint(e))}sdistToPoint(e){let t=this.pos,n=this.pos.add(this.width,this.height),r=Math.max(t.x-e.x,0,e.x-n.x),i=Math.max(t.y-e.y,0,e.y-n.y);return r*r+i*i}};t(G,"Rect");var q=class{center;radius;constructor(e,t){this.center=e.clone(),this.radius=t}transform(e){return new K(this.center,this.radius,this.radius).transform(e)}bbox(){return G.fromPoints(this.center.sub(c(this.radius)),this.center.add(c(this.radius)))}area(){return this.radius*this.radius*Math.PI}clone(){return new q(this.center,this.radius)}};t(q,"Circle");var K=class{center;radiusX;radiusY;constructor(e,t,n){this.center=e.clone(),this.radiusX=t,this.radiusY=n}transform(e){return new K(e.multVec2(this.center),e.m[0]*this.radiusX,e.m[5]*this.radiusY)}bbox(){return G.fromPoints(this.center.sub(c(this.radiusX,this.radiusY)),this.center.add(c(this.radiusX,this.radiusY)))}area(){return this.radiusX*this.radiusY*Math.PI}clone(){return new K(this.center,this.radiusX,this.radiusY)}};t(K,"Ellipse");var Y=class{pts;constructor(e){if(e.length<3)throw new Error("Polygons should have at least 3 vertices");this.pts=e}transform(e){return new Y(this.pts.map((t=>e.multVec2(t))))}bbox(){let e=c(Number.MAX_VALUE),t=c(-Number.MAX_VALUE);for(let n of this.pts)e.x=Math.min(e.x,n.x),t.x=Math.max(t.x,n.x),e.y=Math.min(e.y,n.y),t.y=Math.max(t.y,n.y);return G.fromPoints(e,t)}area(){let e=0,t=this.pts.length;for(let n=0;n<t;n++){let r=this.pts[n],i=this.pts[(n+1)%t];e+=r.x*i.y*.5,e-=i.x*r.y*.5}return Math.abs(e)}clone(){return new Y(this.pts.map((e=>e.clone())))}};function H(e,t){let n=Number.MAX_VALUE,r=c(0);for(let i of[e,t])for(let s=0;s<i.pts.length;s++){let o=i.pts[s],a=i.pts[(s+1)%i.pts.length].sub(o).normal().unit(),h=Number.MAX_VALUE,l=-Number.MAX_VALUE;for(let t=0;t<e.pts.length;t++){let n=e.pts[t].dot(a);h=Math.min(h,n),l=Math.max(l,n)}let u=Number.MAX_VALUE,d=-Number.MAX_VALUE;for(let e=0;e<t.pts.length;e++){let n=t.pts[e].dot(a);u=Math.min(u,n),d=Math.max(d,n)}let c=Math.min(l,d)-Math.max(h,u);if(c<0)return null;if(c<Math.abs(n)){let e=d-h,t=u-l;n=Math.abs(e)<Math.abs(t)?e:t,r=a.scale(n)}}return r}t(Y,"Polygon"),t(H,"sat");var j=class extends Map{lastID;constructor(...e){super(...e),this.lastID=0}push(e){let t=this.lastID;return this.set(t,e),this.lastID++,t}pushd(e){let t=this.push(e);return()=>this.delete(t)}};t(j,"IDList");var Q=class{paused=!1;cancel;constructor(e){this.cancel=e}static join(e){let t=new Q((()=>e.forEach((e=>e.cancel()))));return Object.defineProperty(t,"paused",{get:()=>e[0].paused,set:t=>e.forEach((e=>e.paused=t))}),t.paused=!1,t}};t(Q,"EventController");var X=class{handlers=new j;add(e){let t=this.handlers.pushd(((...t)=>{n.paused||e(...t)})),n=new Q(t);return n}addOnce(e){let t=this.add(((...n)=>{t.cancel(),e(...n)}));return t}next(){return new Promise((e=>this.addOnce(e)))}trigger(...e){this.handlers.forEach((t=>t(...e)))}numListeners(){return this.handlers.size}};t(X,"Event");var J=class{handlers={};on(e,t){return this.handlers[e]||(this.handlers[e]=new X),this.handlers[e].add(t)}onOnce(e,t){let n=this.on(e,((...e)=>{n.cancel(),t(...e)}));return n}next(e){return new Promise((t=>{this.onOnce(e,((...e)=>t(e[0])))}))}trigger(e,...t){this.handlers[e]&&this.handlers[e].trigger(...t)}remove(e){delete this.handlers[e]}clear(){this.handlers={}}numListeners(e){return this.handlers[e]?.numListeners()??0}};function W(e,t){let n=typeof e,r=typeof t;if(n!==r)return!1;if("object"===n&&"object"===r&&null!==e&&null!==t){let n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(let r of n){let n=e[r],i=t[r];if(("function"!=typeof n||"function"!=typeof i)&&!W(n,i))return!1}return!0}return e===t}function Z(e){let t=window.atob(e),n=t.length,r=new Uint8Array(n);for(let e=0;e<n;e++)r[e]=t.charCodeAt(e);return r.buffer}function _(e){return Z(e.split(",")[1])}function $(e,t){let n=document.createElement("a");n.href=t,n.download=e,n.click()}function ee(e,t){$(e,"data:text/plain;charset=utf-8,"+t)}function te(e,t){ee(e,JSON.stringify(t))}function ne(e,t){let n=URL.createObjectURL(t);$(e,n),URL.revokeObjectURL(n)}t(J,"EventHandler"),t(W,"deepEq"),t(Z,"base64ToArrayBuffer"),t(_,"dataURLToArrayBuffer"),t($,"download"),t(ee,"downloadText"),t(te,"downloadJSON"),t(ne,"downloadBlob");var re=t((e=>e.match(/^data:\w+\/\w+;base64,.+/)),"isDataURL"),ie=t((e=>e.split(".").pop()),"getExt"),se=(()=>{let e=0;return()=>e++})(),oe=class{_items;_compareFn;constructor(e=((e,t)=>e<t)){this._compareFn=e,this._items=[]}insert(e){this._items.push(e),this.moveUp(this._items.length-1)}remove(){if(0===this._items.length)return null;let e=this._items[0],t=this._items.pop();return 0!==this._items.length&&(this._items[0]=t,this.moveDown(0)),e}clear(){this._items.splice(0,this._items.length)}moveUp(e){for(;e>0;){let t=Math.floor((e-1)/2);if(!this._compareFn(this._items[e],this._items[t])&&this._items[e]>=this._items[t])break;this.swap(e,t),e=t}}moveDown(e){for(;e<Math.floor(this._items.length/2);){let t=2*e+1;if(t<this._items.length-1&&!this._compareFn(this._items[t],this._items[t+1])&&++t,this._compareFn(this._items[e],this._items[t]))break;this.swap(e,t),e=t}}swap(e,t){[this._items[e],this._items[t]]=[this._items[t],this._items[e]]}get length(){return this._items.length}};t(oe,"BinaryHeap");var ae={"Joy-Con L+R (STANDARD GAMEPAD Vendor: 057e Product: 200e)":{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",6:"ltrigger",7:"rtrigger",8:"select",9:"start",10:"lstick",11:"rstick",12:"dpad-up",13:"dpad-down",14:"dpad-left",15:"dpad-right",16:"home",17:"capture"},sticks:{left:{x:0,y:1},right:{x:2,y:3}}},"Joy-Con (L) (STANDARD GAMEPAD Vendor: 057e Product: 2006)":{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",9:"select",10:"lstick",16:"start"},sticks:{left:{x:0,y:1}}},"Joy-Con (R) (STANDARD GAMEPAD Vendor: 057e Product: 2007)":{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",9:"start",10:"lstick",16:"select"},sticks:{left:{x:0,y:1}}},"Pro Controller (STANDARD GAMEPAD Vendor: 057e Product: 2009)":{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",6:"ltrigger",7:"rtrigger",8:"select",9:"start",10:"lstick",11:"rstick",12:"dpad-up",13:"dpad-down",14:"dpad-left",15:"dpad-right",16:"home",17:"capture"},sticks:{left:{x:0,y:1},right:{x:2,y:3}}},default:{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",6:"ltrigger",7:"rtrigger",8:"select",9:"start",10:"lstick",11:"rstick",12:"dpad-up",13:"dpad-down",14:"dpad-left",15:"dpad-right",16:"home"},sticks:{left:{x:0,y:1},right:{x:2,y:3}}}},he=class{pressed=new Set([]);pressedRepeat=new Set([]);released=new Set([]);down=new Set([]);update(){this.pressed.clear(),this.released.clear(),this.pressedRepeat.clear()}press(e){this.pressed.add(e),this.pressedRepeat.add(e),this.down.add(e)}pressRepeat(e){this.pressedRepeat.add(e)}release(e){this.down.delete(e),this.pressed.delete(e),this.released.add(e)}};t(he,"ButtonState");var le=class{buttonState=new he;stickState=new Map};t(le,"GamepadState");var ue=class{dts=[];timer=0;fps=0;tick(e){this.dts.push(e),this.timer+=e,this.timer>=1&&(this.timer=0,this.fps=Math.round(1/(this.dts.reduce(((e,t)=>e+t))/this.dts.length)),this.dts=[])}};t(ue,"FPSCounter");var de=t((e=>{if(!e.canvas)throw new Error("Please provide a canvas");let n={canvas:e.canvas,loopID:null,stopped:!1,dt:0,time:0,realTime:0,fpsCounter:new ue,timeScale:1,skipTime:!1,numFrames:0,paused:!1,mousePos:new d(0),mouseDeltaPos:new d(0),keyState:new he,mouseState:new he,mergedGamepadState:new le,gamepadStates:new Map,gamepads:[],charInputted:[],isMouseMoved:!1,lastWidth:e.canvas.offsetWidth,lastHeight:e.canvas.offsetHeight,events:new J};function r(){return n.canvas}function i(){return n.dt*n.timeScale}function s(){return n.time}function o(){return n.fpsCounter.fps}function a(){return n.numFrames}function h(){return n.canvas.toDataURL()}function l(e){n.canvas.style.cursor=e}function u(){return n.canvas.style.cursor}function c(e){if(e)try{let e=n.canvas.requestPointerLock();e.catch&&e.catch((e=>console.error(e)))}catch(e){console.error(e)}else document.exitPointerLock()}function f(){return!!document.pointerLockElement}function p(e){e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullscreen&&e.webkitRequestFullscreen()}function g(){document.exitFullscreen?document.exitFullscreen():document.webkitExitFullScreen&&document.webkitExitFullScreen()}function m(){return document.fullscreenElement||document.webkitFullscreenElement}function w(e=!0){e?p(n.canvas):g()}function A(){return!!m()}function V(){n.stopped=!0;for(let e in pe)n.canvas.removeEventListener(e,pe[e]);for(let e in ge)document.removeEventListener(e,ge[e]);for(let e in me)window.removeEventListener(e,me[e]);ve.disconnect()}function v(r){null!==n.loopID&&cancelAnimationFrame(n.loopID);let s=0,o=t((t=>{if(n.stopped)return;if(n.paused||"visible"!==document.visibilityState)return void(n.loopID=requestAnimationFrame(o));let a=t/1e3,h=a-n.realTime,l=e.maxFPS?1/e.maxFPS:0;n.realTime=a,s+=h,s>l&&(n.skipTime||(n.dt=s,n.time+=i(),n.fpsCounter.tick(n.dt)),s=0,n.skipTime=!1,n.numFrames++,se(),r(),oe()),n.loopID=requestAnimationFrame(o)}),"frame");o(0)}function y(){return"ontouchstart"in window||navigator.maxTouchPoints>0}function E(){return n.mousePos.clone()}function x(){return n.mouseDeltaPos.clone()}function b(e="left"){return n.mouseState.pressed.has(e)}function S(e="left"){return n.mouseState.down.has(e)}function R(e="left"){return n.mouseState.released.has(e)}function M(){return n.isMouseMoved}function T(e){return void 0===e?n.keyState.pressed.size>0:n.keyState.pressed.has(e)}function F(e){return void 0===e?n.keyState.pressedRepeat.size>0:n.keyState.pressedRepeat.has(e)}function B(e){return void 0===e?n.keyState.down.size>0:n.keyState.down.has(e)}function P(e){return void 0===e?n.keyState.released.size>0:n.keyState.released.has(e)}function I(e){return void 0===e?n.mergedGamepadState.buttonState.pressed.size>0:n.mergedGamepadState.buttonState.pressed.has(e)}function C(e){return void 0===e?n.mergedGamepadState.buttonState.down.size>0:n.mergedGamepadState.buttonState.down.has(e)}function U(e){return void 0===e?n.mergedGamepadState.buttonState.released.size>0:n.mergedGamepadState.buttonState.released.has(e)}function D(e){return n.events.on("resize",e)}t(r,"canvas"),t(i,"dt"),t(s,"time"),t(o,"fps"),t(a,"numFrames"),t(h,"screenshot"),t(l,"setCursor"),t(u,"getCursor"),t(c,"setCursorLocked"),t(f,"isCursorLocked"),t(p,"enterFullscreen"),t(g,"exitFullscreen"),t(m,"getFullscreenElement"),t(w,"setFullscreen"),t(A,"isFullscreen"),t(V,"quit"),t(v,"run"),t(y,"isTouchscreen"),t(E,"mousePos"),t(x,"mouseDeltaPos"),t(b,"isMousePressed"),t(S,"isMouseDown"),t(R,"isMouseReleased"),t(M,"isMouseMoved"),t(T,"isKeyPressed"),t(F,"isKeyPressedRepeat"),t(B,"isKeyDown"),t(P,"isKeyReleased"),t(I,"isGamepadButtonPressed"),t(C,"isGamepadButtonDown"),t(U,"isGamepadButtonReleased"),t(D,"onResize");let k=t(((e,t)=>"function"==typeof e?n.events.on("keyDown",e):"string"==typeof e&&"function"==typeof t?n.events.on("keyDown",(n=>n===e&&t(e))):void 0),"onKeyDown"),L=t(((e,t)=>"function"==typeof e?n.events.on("keyPress",e):"string"==typeof e&&"function"==typeof t?n.events.on("keyPress",(n=>n===e&&t(e))):void 0),"onKeyPress"),N=t(((e,t)=>"function"==typeof e?n.events.on("keyPressRepeat",e):"string"==typeof e&&"function"==typeof t?n.events.on("keyPressRepeat",(n=>n===e&&t(e))):void 0),"onKeyPressRepeat"),O=t(((e,t)=>"function"==typeof e?n.events.on("keyRelease",e):"string"==typeof e&&"function"==typeof t?n.events.on("keyRelease",(n=>n===e&&t(e))):void 0),"onKeyRelease");function G(e,t){return"function"==typeof e?n.events.on("mouseDown",(t=>e(t))):n.events.on("mouseDown",(n=>n===e&&t(n)))}function q(e,t){return"function"==typeof e?n.events.on("mousePress",(t=>e(t))):n.events.on("mousePress",(n=>n===e&&t(n)))}function K(e,t){return"function"==typeof e?n.events.on("mouseRelease",(t=>e(t))):n.events.on("mouseRelease",(n=>n===e&&t(n)))}function Y(e){return n.events.on("mouseMove",(()=>e(E(),x())))}function H(e){return n.events.on("charInput",e)}function j(e){return n.events.on("touchStart",e)}function Q(e){return n.events.on("touchMove",e)}function X(e){return n.events.on("touchEnd",e)}function z(e){return n.events.on("scroll",e)}function W(e,t){return"function"==typeof e?n.events.on("gamepadButtonDown",e):"string"==typeof e&&"function"==typeof t?n.events.on("gamepadButtonDown",(n=>n===e&&t(e))):void 0}function Z(e,t){return"function"==typeof e?n.events.on("gamepadButtonPress",e):"string"==typeof e&&"function"==typeof t?n.events.on("gamepadButtonPress",(n=>n===e&&t(e))):void 0}function _(e,t){return"function"==typeof e?n.events.on("gamepadButtonRelease",e):"string"==typeof e&&"function"==typeof t?n.events.on("gamepadButtonRelease",(n=>n===e&&t(e))):void 0}function $(e,t){return n.events.on("gamepadStick",((n,r)=>n===e&&t(r)))}function ee(e){n.events.on("gamepadConnect",e)}function te(e){n.events.on("gamepadDisconnect",e)}function ne(e){return n.mergedGamepadState.stickState.get(e)||new d(0)}function re(){return[...n.charInputted]}function ie(){return[...n.gamepads]}function se(){n.events.trigger("input"),n.keyState.down.forEach((e=>n.events.trigger("keyDown",e))),n.mouseState.down.forEach((e=>n.events.trigger("mouseDown",e))),fe()}function oe(){n.keyState.update(),n.mouseState.update(),n.mergedGamepadState.buttonState.update(),n.mergedGamepadState.stickState.forEach(((e,t)=>{n.mergedGamepadState.stickState.set(t,new d(0))})),n.charInputted=[],n.isMouseMoved=!1,n.gamepadStates.forEach((e=>{e.buttonState.update(),e.stickState.forEach(((t,n)=>{e.stickState.set(n,new d(0))}))}))}function de(e){let t={index:e.index,isPressed:t=>n.gamepadStates.get(e.index).buttonState.pressed.has(t),isDown:t=>n.gamepadStates.get(e.index).buttonState.down.has(t),isReleased:t=>n.gamepadStates.get(e.index).buttonState.released.has(t),getStick:t=>n.gamepadStates.get(e.index).stickState.get(t)};return n.gamepads.push(t),n.gamepadStates.set(e.index,{buttonState:new he,stickState:new Map([["left",new d(0)],["right",new d(0)]])}),t}function ce(e){n.gamepads=n.gamepads.filter((t=>t.index!==e.index)),n.gamepadStates.delete(e.index)}function fe(){for(let e of navigator.getGamepads())e&&!n.gamepadStates.has(e.index)&&de(e);for(let t of n.gamepads){let r=navigator.getGamepads()[t.index],i=(e.gamepads??{})[r.id]??ae[r.id]??ae.default,s=n.gamepadStates.get(t.index);for(let e=0;e<r.buttons.length;e++)r.buttons[e].pressed?(s.buttonState.down.has(i.buttons[e])||(n.mergedGamepadState.buttonState.press(i.buttons[e]),s.buttonState.press(i.buttons[e]),n.events.trigger("gamepadButtonPress",i.buttons[e])),n.events.trigger("gamepadButtonDown",i.buttons[e])):s.buttonState.down.has(i.buttons[e])&&(n.mergedGamepadState.buttonState.release(i.buttons[e]),s.buttonState.release(i.buttons[e]),n.events.trigger("gamepadButtonRelease",i.buttons[e]));for(let e in i.sticks){let t=i.sticks[e],o=new d(r.axes[t.x],r.axes[t.y]);s.stickState.set(e,o),n.mergedGamepadState.stickState.set(e,o),n.events.trigger("gamepadStick",e,o)}}}t(G,"onMouseDown"),t(q,"onMousePress"),t(K,"onMouseRelease"),t(Y,"onMouseMove"),t(H,"onCharInput"),t(j,"onTouchStart"),t(Q,"onTouchMove"),t(X,"onTouchEnd"),t(z,"onScroll"),t(W,"onGamepadButtonDown"),t(Z,"onGamepadButtonPress"),t(_,"onGamepadButtonRelease"),t($,"onGamepadStick"),t(ee,"onGamepadConnect"),t(te,"onGamepadDisconnect"),t(ne,"getGamepadStick"),t(re,"charInputted"),t(ie,"getGamepads"),t(se,"processInput"),t(oe,"resetInput"),t(de,"registerGamepad"),t(ce,"removeGamepad"),t(fe,"processGamepad");let pe={},ge={},me={};pe.mousemove=e=>{let t=new d(e.offsetX,e.offsetY),r=new d(e.movementX,e.movementY);n.events.onOnce("input",(()=>{n.isMouseMoved=!0,n.mousePos=t,n.mouseDeltaPos=r,n.events.trigger("mouseMove")}))};let we=["left","middle","right","back","forward"];pe.mousedown=e=>{n.events.onOnce("input",(()=>{let t=we[e.button];t&&(n.mouseState.press(t),n.events.trigger("mousePress",t))}))},pe.mouseup=e=>{n.events.onOnce("input",(()=>{let t=we[e.button];t&&(n.mouseState.release(t),n.events.trigger("mouseRelease",t))}))};let Ae=new Set([" ","ArrowLeft","ArrowRight","ArrowUp","ArrowDown","Tab"]),Ve={ArrowLeft:"left",ArrowRight:"right",ArrowUp:"up",ArrowDown:"down"," ":"space"};pe.keydown=e=>{Ae.has(e.key)&&e.preventDefault(),n.events.onOnce("input",(()=>{let t=Ve[e.key]||e.key.toLowerCase();1===t.length?(n.events.trigger("charInput",t),n.charInputted.push(t)):"space"===t&&(n.events.trigger("charInput"," "),n.charInputted.push(" ")),e.repeat?(n.keyState.pressRepeat(t),n.events.trigger("keyPressRepeat",t)):(n.keyState.press(t),n.events.trigger("keyPressRepeat",t),n.events.trigger("keyPress",t))}))},pe.keyup=e=>{n.events.onOnce("input",(()=>{let t=Ve[e.key]||e.key.toLowerCase();n.keyState.release(t),n.events.trigger("keyRelease",t)}))},pe.touchstart=t=>{t.preventDefault(),n.events.onOnce("input",(()=>{let r=[...t.changedTouches];r.forEach((e=>{n.events.trigger("touchStart",new d(e.clientX,e.clientY),e)})),!1!==e.touchToMouse&&(n.mousePos=new d(r[0].clientX,r[0].clientY),n.mouseState.press("left"),n.events.trigger("mousePress","left"))}))},pe.touchmove=t=>{t.preventDefault(),n.events.onOnce("input",(()=>{let r=[...t.changedTouches];r.forEach((e=>{n.events.trigger("touchMove",new d(e.clientX,e.clientY),e)})),!1!==e.touchToMouse&&(n.mousePos=new d(r[0].clientX,r[0].clientY),n.events.trigger("mouseMove"))}))},pe.touchend=t=>{n.events.onOnce("input",(()=>{let r=[...t.changedTouches];r.forEach((e=>{n.events.trigger("touchEnd",new d(e.clientX,e.clientY),e)})),!1!==e.touchToMouse&&(n.mousePos=new d(r[0].clientX,r[0].clientY),n.mouseState.release("left"),n.events.trigger("mouseRelease","left"))}))},pe.touchcancel=t=>{n.events.onOnce("input",(()=>{let r=[...t.changedTouches];r.forEach((e=>{n.events.trigger("touchEnd",new d(e.clientX,e.clientY),e)})),!1!==e.touchToMouse&&(n.mousePos=new d(r[0].clientX,r[0].clientY),n.mouseState.release("left"),n.events.trigger("mouseRelease","left"))}))},pe.wheel=e=>{e.preventDefault(),n.events.onOnce("input",(()=>{n.events.trigger("scroll",new d(e.deltaX,e.deltaY))}))},pe.contextmenu=e=>e.preventDefault(),ge.visibilitychange=()=>{"visible"===document.visibilityState&&(n.skipTime=!0)},me.gamepadconnected=e=>{let t=de(e.gamepad);n.events.onOnce("input",(()=>{n.events.trigger("gamepadConnect",t)}))},me.gamepaddisconnected=e=>{let t=ie().filter((t=>t.index===e.gamepad.index))[0];ce(e.gamepad),n.events.onOnce("input",(()=>{n.events.trigger("gamepadDisconnect",t)}))};for(let e in pe)n.canvas.addEventListener(e,pe[e]);for(let e in ge)document.addEventListener(e,ge[e]);for(let e in me)window.addEventListener(e,me[e]);let ve=new ResizeObserver((e=>{for(let t of e)if(t.target===n.canvas){if(n.lastWidth===n.canvas.offsetWidth&&n.lastHeight===n.canvas.offsetHeight)return;n.lastWidth=n.canvas.offsetWidth,n.lastHeight=n.canvas.offsetHeight,n.events.onOnce("input",(()=>{n.events.trigger("resize")}))}}));return ve.observe(n.canvas),{dt:i,time:s,run:v,canvas:r,fps:o,numFrames:a,quit:V,setFullscreen:w,isFullscreen:A,setCursor:l,screenshot:h,getGamepads:ie,getCursor:u,setCursorLocked:c,isCursorLocked:f,isTouchscreen:y,mousePos:E,mouseDeltaPos:x,isKeyDown:B,isKeyPressed:T,isKeyPressedRepeat:F,isKeyReleased:P,isMouseDown:S,isMousePressed:b,isMouseReleased:R,isMouseMoved:M,isGamepadButtonPressed:I,isGamepadButtonDown:C,isGamepadButtonReleased:U,getGamepadStick:ne,charInputted:re,onResize:D,onKeyDown:k,onKeyPress:L,onKeyPressRepeat:N,onKeyRelease:O,onMouseDown:G,onMousePress:q,onMouseRelease:K,onMouseMove:Y,onCharInput:H,onTouchStart:j,onTouchMove:Q,onTouchEnd:X,onScroll:z,onGamepadButtonDown:W,onGamepadButtonPress:Z,onGamepadButtonRelease:_,onGamepadStick:$,onGamepadConnect:ee,onGamepadDisconnect:te,events:n.events,get paused(){return n.paused},set paused(e){n.paused=e}}}),"default"),ce=2.5949095,fe=2.70158,pe=2*Math.PI/3,ge=2*Math.PI/4.5,me={linear:e=>e,easeInSine:e=>1-Math.cos(e*Math.PI/2),easeOutSine:e=>Math.sin(e*Math.PI/2),easeInOutSine:e=>-(Math.cos(Math.PI*e)-1)/2,easeInQuad:e=>e*e,easeOutQuad:e=>1-(1-e)*(1-e),easeInOutQuad:e=>e<.5?2*e*e:1-Math.pow(-2*e+2,2)/2,easeInCubic:e=>e*e*e,easeOutCubic:e=>1-Math.pow(1-e,3),easeInOutCubic:e=>e<.5?4*e*e*e:1-Math.pow(-2*e+2,3)/2,easeInQuart:e=>e*e*e*e,easeOutQuart:e=>1-Math.pow(1-e,4),easeInOutQuart:e=>e<.5?8*e*e*e*e:1-Math.pow(-2*e+2,4)/2,easeInQuint:e=>e*e*e*e*e,easeOutQuint:e=>1-Math.pow(1-e,5),easeInOutQuint:e=>e<.5?16*e*e*e*e*e:1-Math.pow(-2*e+2,5)/2,easeInExpo:e=>0===e?0:Math.pow(2,10*e-10),easeOutExpo:e=>1===e?1:1-Math.pow(2,-10*e),easeInOutExpo:e=>0===e?0:1===e?1:e<.5?Math.pow(2,20*e-10)/2:(2-Math.pow(2,-20*e+10))/2,easeInCirc:e=>1-Math.sqrt(1-Math.pow(e,2)),easeOutCirc:e=>Math.sqrt(1-Math.pow(e-1,2)),easeInOutCirc:e=>e<.5?(1-Math.sqrt(1-Math.pow(2*e,2)))/2:(Math.sqrt(1-Math.pow(-2*e+2,2))+1)/2,easeInBack:e=>fe*e*e*e-1.70158*e*e,easeOutBack:e=>1+fe*Math.pow(e-1,3)+1.70158*Math.pow(e-1,2),easeInOutBack:e=>e<.5?Math.pow(2*e,2)*(7.189819*e-ce)/2:(Math.pow(2*e-2,2)*((ce+1)*(2*e-2)+ce)+2)/2,easeInElastic:e=>0===e?0:1===e?1:-Math.pow(2,10*e-10)*Math.sin((10*e-10.75)*pe),easeOutElastic:e=>0===e?0:1===e?1:Math.pow(2,-10*e)*Math.sin((10*e-.75)*pe)+1,easeInOutElastic:e=>0===e?0:1===e?1:e<.5?-Math.pow(2,20*e-10)*Math.sin((20*e-11.125)*ge)/2:Math.pow(2,-20*e+10)*Math.sin((20*e-11.125)*ge)/2+1,easeInBounce:e=>1-me.easeOutBounce(1-e),easeOutBounce:e=>e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375,easeInOutBounce:e=>e<.5?(1-me.easeOutBounce(1-2*e))/2:(1+me.easeOutBounce(2*e-1))/2},we=me,Ae=class{time;action;finished=!1;paused=!1;constructor(e,t){this.time=e,this.action=t}tick(e){return!this.finished&&!this.paused&&(this.time-=e,this.time<=0&&(this.action(),this.finished=!0,this.time=0,!0))}reset(e){this.time=e,this.finished=!1}};t(Ae,"Timer"),((t,n)=>{for(var r in n)e(t,r,{get:n[r],enumerable:!0})})({},{default:()=>Ve});var Ve=r("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L5QNSqT5iiySS9Ja2SV//5ME0ak//+4KgAAABgQBAADAMDgYCAEgCteQ0fZH6+ICXA357+MPfhR/+ywRf/U///LVTEFNRTMuMTAwVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+5JknQAFoWhGLm5gBClBmT3GiAAAAAGkHAAAIAAANIOAAARVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV"),ve=" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~",ye="topleft",Ee="monospace",xe="nearest",be=[{name:"a_pos",size:2},{name:"a_uv",size:2},{name:"a_color",size:4}],Se=be.reduce(((e,t)=>e+t.size),0),Re=8192*Se,Me="\nvec4 vert(vec2 pos, vec2 uv, vec4 color) {\n\treturn def_vert();\n}\n",Te="\nvec4 frag(vec2 pos, vec2 uv, vec4 color, sampler2D tex) {\n\treturn def_frag();\n}\n",Fe=new Set(["id","require"]),Be=new Set(["add","update","draw","destroy","inspect","drawInspect"]);function Pe(e){switch(e){case"topleft":return new d(-1,-1);case"top":return new d(0,-1);case"topright":return new d(1,-1);case"left":return new d(-1,0);case"center":return new d(0,0);case"right":return new d(1,0);case"botleft":return new d(-1,1);case"bot":return new d(0,1);case"botright":return new d(1,1);default:return e}}function Ie(e){switch(e){case"left":default:return 0;case"center":return.5;case"right":return 1}}function Ce(e){return e.createBuffer(1,1,44100)}t(Pe,"anchorPt"),t(Ie,"alignPt"),t(Ce,"createEmptyAudioBuffer"),t(((e={})=>{let n=e.root??document.body;n===document.body&&(document.body.style.width="100%",document.body.style.height="100%",document.body.style.margin="0px",document.documentElement.style.width="100%",document.documentElement.style.height="100%");let r=e.canvas??(()=>{let e=document.createElement("canvas");return n.appendChild(e),e})(),u=e.scale??1,f=e.width&&e.height&&!e.stretch&&!e.letterbox;f?(r.width=e.width*u,r.height=e.height*u):(r.width=r.parentElement.offsetWidth,r.height=r.parentElement.offsetHeight);let y=r.width,x=r.height,B=e.pixelDensity||window.devicePixelRatio;r.width*=B,r.height*=B;let k=["outline: none","cursor: default"];f?(k.push(`width: ${y}px`),k.push(`height: ${x}px`)):(k.push("width: 100%"),k.push("height: 100%")),e.crisp&&(k.push("image-rendering: pixelated"),k.push("image-rendering: crisp-edges")),r.style.cssText=k.join(";"),r.tabIndex=0;let K=document.createElement("canvas");K.width=256,K.height=256;let z=K.getContext("2d",{willReadFrequently:!0}),Z=de({canvas:r,touchToMouse:e.touchToMouse,gamepads:e.gamepads,pixelDensity:e.pixelDensity,maxFPS:e.maxFPS}),ae=[],he=Z.canvas().getContext("webgl",{antialias:!0,depth:!0,stencil:!0,alpha:!0,preserveDrawingBuffer:!0});class le{src=null;glTex;width;height;constructor(t,n,r={}){this.glTex=he.createTexture(),ae.push((()=>this.free())),this.bind(),t&&n&&he.texImage2D(he.TEXTURE_2D,0,he.RGBA,t,n,0,he.RGBA,he.UNSIGNED_BYTE,null),this.width=t,this.height=n;let i="linear"===(r.filter??e.texFilter)?he.LINEAR:he.NEAREST,s="repeat"===r.wrap?he.REPEAT:he.CLAMP_TO_EDGE;he.texParameteri(he.TEXTURE_2D,he.TEXTURE_MIN_FILTER,i),he.texParameteri(he.TEXTURE_2D,he.TEXTURE_MAG_FILTER,i),he.texParameteri(he.TEXTURE_2D,he.TEXTURE_WRAP_S,s),he.texParameteri(he.TEXTURE_2D,he.TEXTURE_WRAP_T,s),this.unbind()}static fromImage(e,t={}){let n=new le(0,0,t);return n.bind(),he.texImage2D(he.TEXTURE_2D,0,he.RGBA,he.RGBA,he.UNSIGNED_BYTE,e),n.width=e.width,n.height=e.height,n.unbind(),n.src=e,n}update(e,t=0,n=0){this.bind(),he.texSubImage2D(he.TEXTURE_2D,0,t,n,he.RGBA,he.UNSIGNED_BYTE,e),this.unbind()}bind(){he.bindTexture(he.TEXTURE_2D,this.glTex)}unbind(){he.bindTexture(he.TEXTURE_2D,null)}free(){he.deleteTexture(this.glTex)}}t(le,"Texture");class ue{tex;canvas;ctx;x=0;y=0;curHeight=0;constructor(e,t){this.canvas=document.createElement("canvas"),this.canvas.width=e,this.canvas.height=t,this.tex=le.fromImage(this.canvas),this.ctx=this.canvas.getContext("2d")}add(e){if(e.width>this.canvas.width||e.height>this.canvas.height)throw new Error(`Texture size (${e.width} x ${e.height}) exceeds limit (${this.canvas.width} x ${this.canvas.height})`);this.x+e.width>this.canvas.width&&(this.x=0,this.y+=this.curHeight,this.curHeight=0),this.y+e.height>this.canvas.height&&(this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.tex=le.fromImage(this.canvas),this.x=0,this.y=0,this.curHeight=0);let t=new d(this.x,this.y);return this.x+=e.width,e.height>this.curHeight&&(this.curHeight=e.height),e instanceof ImageData?this.ctx.putImageData(e,t.x,t.y):this.ctx.drawImage(e,t.x,t.y),this.tex.update(this.canvas),[this.tex,new w(t.x/this.canvas.width,t.y/this.canvas.height,e.width/this.canvas.width,e.height/this.canvas.height)]}}t(ue,"TexPacker");class ce{tex;glFrameBuffer;glRenderBuffer;constructor(e,t,n={}){this.tex=new le(e,t,n),this.glFrameBuffer=he.createFramebuffer(),this.glRenderBuffer=he.createRenderbuffer(),ae.push((()=>this.free())),this.bind(),he.renderbufferStorage(he.RENDERBUFFER,he.DEPTH_STENCIL,e,t),he.framebufferTexture2D(he.FRAMEBUFFER,he.COLOR_ATTACHMENT0,he.TEXTURE_2D,this.tex.glTex,0),he.framebufferRenderbuffer(he.FRAMEBUFFER,he.DEPTH_STENCIL_ATTACHMENT,he.RENDERBUFFER,this.glRenderBuffer),this.unbind()}get width(){return this.tex.width}get height(){return this.tex.height}bind(){he.bindFramebuffer(he.FRAMEBUFFER,this.glFrameBuffer),he.bindRenderbuffer(he.RENDERBUFFER,this.glRenderBuffer)}unbind(){he.bindFramebuffer(he.FRAMEBUFFER,null),he.bindRenderbuffer(he.RENDERBUFFER,null)}free(){he.deleteFramebuffer(this.glFrameBuffer),he.deleteRenderbuffer(this.glRenderBuffer),this.tex.free()}}t(ce,"FrameBuffer");let fe=(()=>{let t=Vt(Me,Te),n=le.fromImage(new ImageData(new Uint8ClampedArray([255,255,255,255]),1,1)),r=e.width&&e.height?new ce(e.width*B,e.height*B):new ce(he.drawingBufferWidth/u,he.drawingBufferHeight/u),i=null,s=1;e.background&&(i=p.fromArray(e.background),s=e.background[3]??1,he.clearColor(i.r/255,i.g/255,i.b/255,s)),he.enable(he.BLEND),he.enable(he.SCISSOR_TEST),he.blendFuncSeparate(he.SRC_ALPHA,he.ONE_MINUS_SRC_ALPHA,he.ONE,he.ONE_MINUS_SRC_ALPHA);let o=he.createBuffer();he.bindBuffer(he.ARRAY_BUFFER,o),he.bufferData(he.ARRAY_BUFFER,4*Re,he.DYNAMIC_DRAW),be.reduce(((e,t,n)=>(he.vertexAttribPointer(n,t.size,he.FLOAT,!1,4*Se,e),he.enableVertexAttribArray(n),e+4*t.size)),0),he.bindBuffer(he.ARRAY_BUFFER,null);let a=he.createBuffer();he.bindBuffer(he.ELEMENT_ARRAY_BUFFER,a),he.bufferData(he.ELEMENT_ARRAY_BUFFER,49152,he.DYNAMIC_DRAW),he.bindBuffer(he.ELEMENT_ARRAY_BUFFER,null);let h=le.fromImage(new ImageData(new Uint8ClampedArray([128,128,128,255,190,190,190,255,190,190,190,255,128,128,128,255]),2,2),{wrap:"repeat",filter:"nearest"});return{drawCalls:0,lastDrawCalls:0,defShader:t,curShader:t,frameBuffer:r,postShader:null,postShaderUniform:null,defTex:n,curTex:n,curUniform:{},vbuf:o,ibuf:a,vqueue:[],iqueue:[],transform:new V,transformStack:[],bgTex:h,bgColor:i,bgAlpha:s,width:e.width??he.drawingBufferWidth/B/u,height:e.height??he.drawingBufferHeight/B/u,viewport:{x:0,y:0,width:he.drawingBufferWidth,height:he.drawingBufferHeight}}})();class pe{tex;frames=[new w(0,0,1,1)];anims={};slice9=null;constructor(e,t,n={},r=null){this.tex=e,t&&(this.frames=t),this.anims=n,this.slice9=r}static from(e,t={}){return"string"==typeof e?pe.fromURL(e,t):Promise.resolve(pe.fromImage(e,t))}static fromImage(e,t={}){let[n,r]=ke.packer.add(e),i=t.frames?t.frames.map((e=>new w(r.x+e.x*r.w,r.y+e.y*r.h,e.w*r.w,e.h*r.h))):We(t.sliceX||1,t.sliceY||1,r.x,r.y,r.w,r.h);return new pe(n,i,t.anims,t.slice9)}static fromURL(e,t={}){return je(e).then((e=>pe.fromImage(e,t)))}}t(pe,"SpriteData");class ge{buf;constructor(e){this.buf=e}static fromArrayBuffer(e){return new Promise(((t,n)=>me.ctx.decodeAudioData(e,t,n))).then((e=>new ge(e)))}static fromURL(e){return re(e)?ge.fromArrayBuffer(_(e)):He(e).then((e=>ge.fromArrayBuffer(e)))}}t(ge,"SoundData");let me=(()=>{let e=new(window.AudioContext||window.webkitAudioContext),t=e.createGain();t.connect(e.destination);let n=new ge(Ce(e));return e.decodeAudioData(Ve.buffer.slice(0)).then((e=>{n.buf=e})).catch((e=>{console.error("Failed to load burp: ",e)})),{ctx:e,masterNode:t,burpSnd:n}})();class Ue{loaded=!1;data=null;error=null;onLoadEvents=new X;onErrorEvents=new X;onFinishEvents=new X;constructor(e){e.then((e=>{this.data=e,this.onLoadEvents.trigger(e)})).catch((e=>{if(this.error=e,!(this.onErrorEvents.numListeners()>0))throw e;this.onErrorEvents.trigger(e)})).finally((()=>{this.onFinishEvents.trigger(),this.loaded=!0}))}static loaded(e){let t=new Ue(Promise.resolve(e));return t.data=e,t.loaded=!0,t}onLoad(e){return this.loaded&&this.data?e(this.data):this.onLoadEvents.add(e),this}onError(e){return this.loaded&&this.error?e(this.error):this.onErrorEvents.add(e),this}onFinish(e){return this.loaded?e():this.onFinishEvents.add(e),this}then(e){return this.onLoad(e)}catch(e){return this.onError(e)}finally(e){return this.onFinish(e)}}t(Ue,"Asset");class De{assets=new Map;lastUID=0;add(e,t){let n=e??this.lastUID+++"",r=new Ue(t);return this.assets.set(n,r),r}addLoaded(e,t){let n=e??this.lastUID+++"",r=Ue.loaded(t);return this.assets.set(n,r),r}get(e){return this.assets.get(e)}progress(){if(0===this.assets.size)return 1;let e=0;return this.assets.forEach((t=>{t.loaded&&e++})),e/this.assets.size}}t(De,"AssetBucket");let ke={urlPrefix:"",sprites:new De,fonts:new De,bitmapFonts:new De,sounds:new De,shaders:new De,custom:new De,packer:new ue(2048,2048),loaded:!1},Le={events:new J,objEvents:new J,root:An([]),gravity:0,scenes:{},logs:[],cam:{pos:null,scale:new d(1),angle:0,shake:0,transform:new V}};function Ne(e){return ke.custom.add(null,e)}function Oe(){let e=[ke.sprites,ke.sounds,ke.shaders,ke.fonts,ke.bitmapFonts,ke.custom];return e.reduce(((e,t)=>e+t.progress()),0)/e.length}function Ge(e){return void 0!==e&&(ke.urlPrefix=e),ke.urlPrefix}function qe(e){let t=ke.urlPrefix+e;return fetch(t).then((e=>{if(!e.ok)throw new Error(`Failed to fetch ${t}`);return e}))}function Ke(e){return qe(e).then((e=>e.json()))}function Ye(e){return qe(e).then((e=>e.text()))}function He(e){return qe(e).then((e=>e.arrayBuffer()))}function je(e){let t=new Image;return t.crossOrigin="anonymous",t.src=re(e)?e:ke.urlPrefix+e,new Promise(((n,r)=>{t.onload=()=>n(t),t.onerror=()=>r(new Error(`Failed to load image from "${e}"`))}))}function Qe(e,t){return ke.custom.add(e,Ke(t))}t(Ne,"load"),t(Oe,"loadProgress"),t(Ge,"loadRoot"),t(qe,"fetchURL"),t(Ke,"fetchJSON"),t(Ye,"fetchText"),t(He,"fetchArrayBuffer"),t(je,"loadImg"),t(Qe,"loadJSON");class Xe{fontface;outline;filter;constructor(e,t={}){this.fontface=e,this.outline=t.outline??0,this.filter=t.filter??xe}}function ze(e,t,n={}){let r=new FontFace(e,"string"==typeof t?`url(${t})`:t);return document.fonts.add(r),ke.fonts.add(e,r.load().catch((e=>{throw new Error(`Failed to load font from "${t}": ${e}`)})).then((e=>new Xe(e,n))))}function Je(e,t,n,r,i={}){return ke.bitmapFonts.add(e,je(t).then((e=>vt(le.fromImage(e,i),n,r,i.chars??ve))))}function We(e=1,t=1,n=0,r=0,i=1,s=1){let o=[],a=i/e,h=s/t;for(let i=0;i<t;i++)for(let t=0;t<e;t++)o.push(new w(n+t*a,r+i*h,a,h));return o}function Ze(e,t){return Ne("string"==typeof t?new Promise(((n,r)=>{Ke(t).then((t=>{Ze(e,t).then(n).catch(r)}))})):pe.from(e).then((e=>{let n={};for(let r in t){let i=t[r],s=e.frames[0],o=2048*s.w,a=2048*s.h,h=i.frames?i.frames.map((e=>new w(s.x+(i.x+e.x)/o*s.w,s.y+(i.y+e.y)/a*s.h,e.w/o*s.w,e.h/a*s.h))):We(i.sliceX||1,i.sliceY||1,s.x+i.x/o*s.w,s.y+i.y/a*s.h,i.width/o*s.w,i.height/a*s.h),l=new pe(e.tex,h,i.anims);ke.sprites.addLoaded(r,l),n[r]=l}return n})))}function _e(e,t={}){let n=document.createElement("canvas"),r=e[0].width,i=e[0].height;n.width=r*e.length,n.height=i;let s=n.getContext("2d");e.forEach(((e,t)=>{e instanceof ImageData?s.putImageData(e,t*r,0):s.drawImage(e,t*r,0)}));let o=s.getImageData(0,0,e.length*r,i);return pe.fromImage(o,{...t,sliceX:e.length,sliceY:1})}function $e(e,t,n={sliceX:1,sliceY:1,anims:{}}){return Array.isArray(t)?t.some((e=>"string"==typeof e))?ke.sprites.add(e,Promise.all(t.map((e=>"string"==typeof e?je(e):Promise.resolve(e)))).then((e=>_e(e,n)))):ke.sprites.addLoaded(e,_e(t,n)):"string"==typeof t?ke.sprites.add(e,pe.from(t,n)):ke.sprites.addLoaded(e,pe.fromImage(t,n))}function et(e,t){return ke.sprites.add(e,new Promise((async e=>{let n="string"==typeof t?await Ke(t):t,r=await Promise.all(n.frames.map(je)),i=document.createElement("canvas");i.width=n.width,i.height=n.height*n.frames.length;let s=i.getContext("2d");r.forEach(((e,t)=>{s.drawImage(e,0,t*n.height)})),e(await $e(null,i,{sliceY:n.frames.length,anims:n.anims}))})))}function tt(e,t,n){"string"==typeof t&&!n&&(n=t.replace(new RegExp(`${ie(t)}$`),"json"));let r="string"==typeof n?Ke(n):Promise.resolve(n);return ke.sprites.add(e,r.then((e=>{let n=e.meta.size,r=e.frames.map((e=>new w(e.frame.x/n.w,e.frame.y/n.h,e.frame.w/n.w,e.frame.h/n.h))),i={};for(let t of e.meta.frameTags)t.from===t.to?i[t.name]=t.from:i[t.name]={from:t.from,to:t.to,speed:10,loop:!0,pingpong:"pingpong"===t.direction};return pe.from(t,{frames:r,anims:i})})))}function nt(e,t,n){return ke.shaders.addLoaded(e,Vt(t,n))}function rt(e,n,r){let i=t((e=>e?Ye(e):Promise.resolve(null)),"resolveUrl"),s=Promise.all([i(n),i(r)]).then((([e,t])=>Vt(e,t)));return ke.shaders.add(e,s)}function it(e,t,n={}){return ke.sounds.add(e,"string"==typeof t?ge.fromURL(t):ge.fromArrayBuffer(t))}function st(e="bean"){return $e(e,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAD0AAAA1CAYAAADyMeOEAAAAAXNSR0IArs4c6QAAAoVJREFUaIHdm7txwkAQhheGAqACiCHzOKQDQrqgILpwSAeEDBnEUAF0gCMxZ7G72qce/mec2Lpf9+3unaS78wgSNZ8uX5729+d1FNWXUuGmXlBOUUEIMckEpeQJgBu6C+BSFngztBR2vd+ovY+7g+p6LbgaWgJrAeUkDYIUXgXdBBwNi6kpABJwMTQH3AZsXRR8GHTfgEth8E3gjdAUcNewpbTgY85sCMCUuOokozE0YM0YRzM9NGAAXd8+omAF5h4lnmBRvpSnZHyLoLEbaN+aKB9KWv/KWw0tAbbANnlG+UvB2dm77NxxdwgBpjrF/d7rW9cbmpvio2A5z8iAYpVU8pGZlo6/2+MSco2lHfd3rv9jAP038e1xef9o2mjvYb2OqpqKE81028/jeietlSEVO5FRWsxWsJit1G3aFpW8iWe5RwpiCZAk25QvV6nz6fIlynRGuTd5WqpJ4guAlDfVKBK87hXljflgv1ON6fV+4+5gVlA17SfeG0heKqQd4l4jI/wrmaA9N9R4ar+wpHJDZyrrfcH0nB66PqAzPi76pn+faSyJk/vzOorYhGurQrzj/P68jtBMawHaHBIR9xoD5O34dy0qQOSYHvqExq2TpT2nf76+w7y251OYF0CRaU+J920TwLUa6inx6OxE6g80lu2ux7Y2eJLF/rCXE6zEPdnenk9o+4ih9AEdnW2q81HXl5LuU6OTl2fXUhqganbXAGq3g6jJOWV/OnoesO6YqqEB/GdNsjf7uHtwj2DzmRNpp7iOZfm6D9oAxB6Yi1gC4oIYeo4MIPdopEQRB+cAko5J1tW386HpB2Kz1eop4Epdwls/kgZ1sh8gZsEjdcWkr//D8Qu3Z3l5Nl1NtAAAAABJRU5ErkJggg==")}function ot(e){return ke.sprites.get(e)}function at(e){return ke.sounds.get(e)}function ht(e){return ke.fonts.get(e)}function lt(e){return ke.bitmapFonts.get(e)}function ut(e){return ke.shaders.get(e)}function dt(e){return ke.custom.get(e)}function ct(e){if("string"==typeof e){let t=ot(e);if(t)return t;if(Oe()<1)return null;throw new Error(`Sprite not found: ${e}`)}if(e instanceof pe)return Ue.loaded(e);if(e instanceof Ue)return e;throw new Error(`Invalid sprite: ${e}`)}function ft(e){if("string"==typeof e){let t=at(e);if(t)return t;if(Oe()<1)return null;throw new Error(`Sound not found: ${e}`)}if(e instanceof ge)return Ue.loaded(e);if(e instanceof Ue)return e;throw new Error(`Invalid sound: ${e}`)}function pt(e){if(!e)return fe.defShader;if("string"==typeof e){let t=ut(e);if(t)return t.data??t;if(Oe()<1)return null;throw new Error(`Shader not found: ${e}`)}return e instanceof Ue&&e.data?e.data:e}function gt(t){if(!t)return gt(e.font??"monospace");if("string"==typeof t){let e=lt(t),n=ht(t);if(e)return e.data??e;if(n)return n.data??n;if(document.fonts.check(`64px ${t}`))return t;if(Oe()<1)return null;throw new Error(`Font not found: ${t}`)}return t instanceof Ue&&t.data?t.data:t}function mt(e){return void 0!==e&&(me.masterNode.gain.value=e),me.masterNode.gain.value}function wt(e,n={}){let r=me.ctx,i=n.paused??!1,s=r.createBufferSource(),o=new X,a=r.createGain(),h=n.seek??0,l=0,u=0,d=!1;s.loop=!!n.loop,s.detune.value=n.detune??0,s.playbackRate.value=n.speed??1,s.connect(a),s.onended=()=>{p()>=s.buffer?.duration&&o.trigger()},a.connect(me.masterNode),a.gain.value=n.volume??1;let c=t((e=>{s.buffer=e.buf,i||(l=r.currentTime,s.start(0,h),d=!0)}),"start"),f=ft(e);f instanceof Ue&&f.onLoad(c);let p=t((()=>{if(!s.buffer)return 0;let e=i?u-l:r.currentTime-l,t=s.buffer.duration;return s.loop?e%t:Math.min(e,t)}),"getTime"),g=t((e=>{let t=r.createBufferSource();return t.buffer=e.buffer,t.loop=e.loop,t.playbackRate.value=e.playbackRate.value,t.detune.value=e.detune.value,t.onended=e.onended,t.connect(a),t}),"cloneNode");return{set paused(e){if(i!==e)if(i=e,e)d&&(s.stop(),d=!1),u=r.currentTime;else{s=g(s);let e=u-l;s.start(0,e),d=!0,l=r.currentTime-e,u=0}},get paused(){return i},play(e=0){this.seek(e),this.paused=!1},seek(e){s.buffer?.duration&&(e>s.buffer.duration||(i?(s=g(s),l=u-e):(s.stop(),s=g(s),l=r.currentTime-e,s.start(0,e),d=!0,u=0)))},set speed(e){s.playbackRate.value=e},get speed(){return s.playbackRate.value},set detune(e){s.detune.value=e},get detune(){return s.detune.value},set volume(e){a.gain.value=Math.max(e,0)},get volume(){return a.gain.value},set loop(e){s.loop=e},get loop(){return s.loop},duration:()=>s.buffer?.duration??0,time(){return p()%this.duration()},onEnd:e=>o.add(e),then(e){return this.onEnd(e)}}}function At(e){return wt(me.burpSnd,e)}function Vt(e=Me,n=Te){let r="\nattribute vec2 a_pos;\nattribute vec2 a_uv;\nattribute vec4 a_color;\n\nvarying vec2 v_pos;\nvarying vec2 v_uv;\nvarying vec4 v_color;\n\nvec4 def_vert() {\n\treturn vec4(a_pos, 0.0, 1.0);\n}\n\n{{user}}\n\nvoid main() {\n\tvec4 pos = vert(a_pos, a_uv, a_color);\n\tv_pos = a_pos;\n\tv_uv = a_uv;\n\tv_color = a_color;\n\tgl_Position = pos;\n}\n".replace("{{user}}",e??Me),i="\nprecision mediump float;\n\nvarying vec2 v_pos;\nvarying vec2 v_uv;\nvarying vec4 v_color;\n\nuniform sampler2D u_tex;\n\nvec4 def_frag() {\n\treturn v_color * texture2D(u_tex, v_uv);\n}\n\n{{user}}\n\nvoid main() {\n\tgl_FragColor = frag(v_pos, v_uv, v_color, u_tex);\n\tif (gl_FragColor.a == 0.0) {\n\t\tdiscard;\n\t}\n}\n".replace("{{user}}",n??Te),s=he.createShader(he.VERTEX_SHADER),o=he.createShader(he.FRAGMENT_SHADER);he.shaderSource(s,r),he.shaderSource(o,i),he.compileShader(s),he.compileShader(o);let a=he.createProgram();if(ae.push((()=>he.deleteProgram(a))),he.attachShader(a,s),he.attachShader(a,o),he.bindAttribLocation(a,0,"a_pos"),he.bindAttribLocation(a,1,"a_uv"),he.bindAttribLocation(a,2,"a_color"),he.linkProgram(a),!he.getProgramParameter(a,he.LINK_STATUS)){let e=t((e=>{let t=e.match(/^ERROR:\s0:(?<line>\d+):\s(?<msg>.+)/);return{line:Number(t.groups.line),msg:t.groups.msg.replace(/\n\0$/,"")}}),"formatShaderError"),n=he.getShaderInfoLog(s),r=he.getShaderInfoLog(o),i="";if(n){let t=e(n);i+=`Vertex shader line ${t.line-14}: ${t.msg}`}if(r){let t=e(r);i+=`Fragment shader line ${t.line-14}: ${t.msg}`}throw new Error(i)}return he.deleteShader(s),he.deleteShader(o),{bind(){he.useProgram(a)},unbind(){he.useProgram(null)},free(){he.deleteProgram(a)},send(e){for(let t in e){let n=e[t],r=he.getUniformLocation(a,t);"number"==typeof n?he.uniform1f(r,n):n instanceof V?he.uniformMatrix4fv(r,!1,new Float32Array(n.m)):n instanceof p?he.uniform3f(r,n.r,n.g,n.b):n instanceof d&&he.uniform2f(r,n.x,n.y)}}}}function vt(e,t,n,r){let i=e.width/t,s={},o=r.split("").entries();for(let[e,r]of o)s[r]=new w(e%i*t,Math.floor(e/i)*n,t,n);return{tex:e,map:s,size:n}}function yt(e,t,n,r=fe.defTex,i=fe.defShader,s={}){let o=pt(i);if(!o||o instanceof Ue)return;(r!==fe.curTex||o!==fe.curShader||!W(fe.curUniform,s)||fe.vqueue.length+e.length*Se>Re||fe.iqueue.length+t.length>12288)&&Et();let a=n?fe.transform:Le.cam.transform.mult(fe.transform);for(let t of e){let e=Rt(a.multVec2(t.pos));fe.vqueue.push(e.x,e.y,t.uv.x,t.uv.y,t.color.r/255,t.color.g/255,t.color.b/255,t.opacity)}for(let n of t)fe.iqueue.push(n+fe.vqueue.length/Se-e.length);fe.curTex=r,fe.curShader=o,fe.curUniform=s}function Et(){!fe.curTex||!fe.curShader||0===fe.vqueue.length||0===fe.iqueue.length||(he.bindBuffer(he.ARRAY_BUFFER,fe.vbuf),he.bufferSubData(he.ARRAY_BUFFER,0,new Float32Array(fe.vqueue)),he.bindBuffer(he.ELEMENT_ARRAY_BUFFER,fe.ibuf),he.bufferSubData(he.ELEMENT_ARRAY_BUFFER,0,new Uint16Array(fe.iqueue)),fe.curShader.bind(),fe.curShader.send(fe.curUniform),fe.curTex.bind(),he.drawElements(he.TRIANGLES,fe.iqueue.length,he.UNSIGNED_SHORT,0),fe.curTex.unbind(),fe.curShader.unbind(),he.bindBuffer(he.ARRAY_BUFFER,null),he.bindBuffer(he.ELEMENT_ARRAY_BUFFER,null),fe.vqueue.length=0,fe.iqueue.length=0,fe.drawCalls++)}function xt(){he.clear(he.COLOR_BUFFER_BIT),fe.frameBuffer.bind(),he.viewport(0,0,fe.frameBuffer.width,fe.frameBuffer.height),he.clear(he.COLOR_BUFFER_BIT),fe.bgColor||zt((()=>{Ct({width:nn(),height:rn(),quad:new w(0,0,nn()/64,rn()/64),tex:fe.bgTex,fixed:!0})})),fe.drawCalls=0,fe.transformStack.length=0,fe.transform=new V}function bt(e,t){fe.postShader=e,fe.postShaderUniform=t??null}function St(){Et(),fe.frameBuffer.unbind(),he.viewport(0,0,he.drawingBufferWidth,he.drawingBufferHeight),Et();let e=fe.width,t=fe.height;fe.width=he.drawingBufferWidth/B,fe.height=he.drawingBufferHeight/B,Ut({flipY:!0,tex:fe.frameBuffer.tex,pos:new d(fe.viewport.x,fe.viewport.y),width:fe.viewport.width,height:fe.viewport.height,shader:fe.postShader,uniform:"function"==typeof fe.postShaderUniform?fe.postShaderUniform():fe.postShaderUniform,fixed:!0}),Et(),fe.width=e,fe.height=t,fe.lastDrawCalls=fe.drawCalls}function Rt(e){return new d(e.x/nn()*2-1,-e.y/rn()*2+1)}function Mt(e){fe.transform=e.clone()}function Tt(...e){if(void 0===e[0])return;let t=c(...e);0===t.x&&0===t.y||fe.transform.translate(t)}function Ft(...e){if(void 0===e[0])return;let t=c(...e);1===t.x&&1===t.y||fe.transform.scale(t)}function Bt(e){e&&fe.transform.rotate(e)}function Pt(){fe.transformStack.push(fe.transform.clone())}function It(){fe.transformStack.length>0&&(fe.transform=fe.transformStack.pop())}function Ct(e){if(void 0===e.width||void 0===e.height)throw new Error('drawUVQuad() requires property "width" and "height".');if(e.width<=0||e.height<=0)return;let t=e.width,n=e.height,r=Pe(e.anchor||ye).scale(new d(t,n).scale(-.5)),i=e.quad||new w(0,0,1,1),s=e.color||g(255,255,255),o=e.opacity??1,a=e.tex?.1/e.tex.width:0,h=e.tex?.1/e.tex.height:0,l=i.x+a,u=i.y+h,c=i.w-2*a,f=i.h-2*h;Pt(),Tt(e.pos),Bt(e.angle),Ft(e.scale),Tt(r),yt([{pos:new d(-t/2,n/2),uv:new d(e.flipX?l+c:l,e.flipY?u:u+f),color:s,opacity:o},{pos:new d(-t/2,-n/2),uv:new d(e.flipX?l+c:l,e.flipY?u+f:u),color:s,opacity:o},{pos:new d(t/2,-n/2),uv:new d(e.flipX?l:l+c,e.flipY?u+f:u),color:s,opacity:o},{pos:new d(t/2,n/2),uv:new d(e.flipX?l:l+c,e.flipY?u:u+f),color:s,opacity:o}],[0,1,3,1,2,3],e.fixed,e.tex,e.shader,e.uniform),It()}function Ut(e){if(!e.tex)throw new Error('drawTexture() requires property "tex".');let t=e.quad??new w(0,0,1,1),n=e.tex.width*t.w,r=e.tex.height*t.h,i=new d(1);if(e.tiled){let s=Math.ceil((e.width||n)/n),o=Math.ceil((e.height||r)/r),a=Pe(e.anchor||ye).add(new d(1,1)).scale(.5).scale(s*n,o*r);for(let h=0;h<s;h++)for(let s=0;s<o;s++)Ct(Object.assign({},e,{pos:(e.pos||new d(0)).add(new d(n*h,r*s)).sub(a),scale:i.scale(e.scale||new d(1)),tex:e.tex,quad:t,width:n,height:r,anchor:"topleft"}))}else e.width&&e.height?(i.x=e.width/n,i.y=e.height/r):e.width?(i.x=e.width/n,i.y=i.x):e.height&&(i.y=e.height/r,i.x=i.y),Ct(Object.assign({},e,{scale:i.scale(e.scale||new d(1)),tex:e.tex,quad:t,width:n,height:r}))}function Dt(e){if(!e.sprite)throw new Error('drawSprite() requires property "sprite"');let t=ct(e.sprite);if(!t||!t.data)return;let n=t.data.frames[e.frame??0];if(!n)throw new Error(`Frame not found: ${e.frame??0}`);Ut(Object.assign({},e,{tex:t.data.tex,quad:n.scale(e.quad??new w(0,0,1,1))}))}function kt(e,t,n,r,s,o=1){r=i(r%360),(s=i(s%360))<=r&&(s+=2*Math.PI);let a=[],h=(s-r)/Math.ceil((s-r)/i(8)*o);for(let i=r;i<s;i+=h)a.push(e.add(t*Math.cos(i),n*Math.sin(i)));return a.push(e.add(t*Math.cos(s),n*Math.sin(s))),a}function Lt(e){if(void 0===e.width||void 0===e.height)throw new Error('drawRect() requires property "width" and "height".');if(e.width<=0||e.height<=0)return;let t=e.width,n=e.height,r=Pe(e.anchor||ye).add(1,1).scale(new d(t,n).scale(-.5)),i=[new d(0,0),new d(t,0),new d(t,n),new d(0,n)];if(e.radius){let r=Math.min(Math.min(t,n)/2,e.radius);i=[new d(r,0),new d(t-r,0),...kt(new d(t-r,r),r,r,270,360),new d(t,r),new d(t,n-r),...kt(new d(t-r,n-r),r,r,0,90),new d(t-r,n),new d(r,n),...kt(new d(r,n-r),r,r,90,180),new d(0,n-r),new d(0,r),...kt(new d(r,r),r,r,180,270)]}Yt(Object.assign({},e,{offset:r,pts:i,...e.gradient?{colors:e.horizontal?[e.gradient[0],e.gradient[1],e.gradient[1],e.gradient[0]]:[e.gradient[0],e.gradient[0],e.gradient[1],e.gradient[1]]}:{}}))}function Nt(e){let{p1:t,p2:n}=e;if(!t||!n)throw new Error('drawLine() requires properties "p1" and "p2".');let r=e.width||1,i=n.sub(t).unit().normal().scale(.5*r);yt([t.sub(i),t.add(i),n.add(i),n.sub(i)].map((t=>({pos:new d(t.x,t.y),uv:new d(0),color:e.color??p.WHITE,opacity:e.opacity??1}))),[0,1,3,1,2,3],e.fixed,fe.defTex,e.shader,e.uniform)}function Ot(e){let t=e.pts;if(!t)throw new Error('drawLines() requires property "pts".');if(!(t.length<2))if(e.radius&&t.length>=3){let n=t[0].sdist(t[1]);for(let e=1;e<t.length-1;e++)n=Math.min(t[e].sdist(t[e+1]),n);Math.min(e.radius,Math.sqrt(n)/2),Nt(Object.assign({},e,{p1:t[0],p2:t[1]}));for(let n=1;n<t.length-2;n++){let r=t[n],i=t[n+1];Nt(Object.assign({},e,{p1:r,p2:i}))}Nt(Object.assign({},e,{p1:t[t.length-2],p2:t[t.length-1]}))}else for(let n=0;n<t.length-1;n++)Nt(Object.assign({},e,{p1:t[n],p2:t[n+1]})),"none"!==e.join&&qt(Object.assign({},e,{pos:t[n],radius:e.width/2}))}function Gt(e){if(!e.p1||!e.p2||!e.p3)throw new Error('drawPolygon() requires properties "p1", "p2" and "p3".');return Yt(Object.assign({},e,{pts:[e.p1,e.p2,e.p3]}))}function qt(e){if(!e.radius)throw new Error('drawCircle() requires property "radius".');0!==e.radius&&Kt(Object.assign({},e,{radiusX:e.radius,radiusY:e.radius,angle:0}))}function Kt(e){if(void 0===e.radiusX||void 0===e.radiusY)throw new Error('drawEllipse() requires properties "radiusX" and "radiusY".');if(0===e.radiusX||0===e.radiusY)return;let t=e.start??0,n=e.end??360,r=Pe(e.anchor??"center").scale(new d(-e.radiusX,-e.radiusY)),i=kt(r,e.radiusX,e.radiusY,t,n,e.resolution);i.unshift(r);let s=Object.assign({},e,{pts:i,radius:0,...e.gradient?{colors:[e.gradient[0],...Array(i.length-1).fill(e.gradient[1])]}:{}});if(n-t>=360&&e.outline)return!1!==e.fill&&Yt(Object.assign(s,{outline:null})),void Yt(Object.assign(s,{pts:i.slice(1),fill:!1}));Yt(s)}function Yt(e){if(!e.pts)throw new Error('drawPolygon() requires property "pts".');let t=e.pts.length;if(!(t<3)){if(Pt(),Tt(e.pos),Ft(e.scale),Bt(e.angle),Tt(e.offset),!1!==e.fill){let n=e.color??p.WHITE,r=e.pts.map(((t,r)=>({pos:new d(t.x,t.y),uv:new d(0,0),color:e.colors?e.colors[r]??n:n,opacity:e.opacity??1}))),i=[...Array(t-2).keys()].map((e=>[0,e+1,e+2])).flat();yt(r,e.indices??i,e.fixed,fe.defTex,e.shader,e.uniform)}e.outline&&Ot({pts:[...e.pts,e.pts[0]],radius:e.radius,width:e.outline.width,color:e.outline.color,join:e.outline.join,uniform:e.uniform,fixed:e.fixed,opacity:e.opacity}),It()}}function Ht(e,t,n){Et(),he.clear(he.STENCIL_BUFFER_BIT),he.enable(he.STENCIL_TEST),he.stencilFunc(he.NEVER,1,255),he.stencilOp(he.REPLACE,he.REPLACE,he.REPLACE),t(),Et(),he.stencilFunc(n,1,255),he.stencilOp(he.KEEP,he.KEEP,he.KEEP),e(),Et(),he.disable(he.STENCIL_TEST)}function jt(e,t){Ht(e,t,he.EQUAL)}function Qt(e,t){Ht(e,t,he.NOTEQUAL)}function Xt(){return(fe.viewport.width+fe.viewport.height)/(fe.width+fe.height)}function zt(e){Et();let t=fe.width,n=fe.height;fe.width=fe.viewport.width,fe.height=fe.viewport.height,e(),Et(),fe.width=t,fe.height=n}function Jt(e,t){t.pos&&(e.pos=e.pos.add(t.pos)),t.scale&&(e.scale=e.scale.scale(c(t.scale))),t.angle&&(e.angle+=t.angle),t.color&&(e.color=e.color.mult(t.color)),t.opacity&&(e.opacity*=t.opacity)}t(Xe,"FontData"),t(ze,"loadFont"),t(Je,"loadBitmapFont"),t(We,"slice"),t(Ze,"loadSpriteAtlas"),t(_e,"createSpriteSheet"),t($e,"loadSprite"),t(et,"loadPedit"),t(tt,"loadAseprite"),t(nt,"loadShader"),t(rt,"loadShaderURL"),t(it,"loadSound"),t(st,"loadBean"),t(ot,"getSprite"),t(at,"getSound"),t(ht,"getFont"),t(lt,"getBitmapFont"),t(ut,"getShader"),t(dt,"getAsset"),t(ct,"resolveSprite"),t(ft,"resolveSound"),t(pt,"resolveShader"),t(gt,"resolveFont"),t(mt,"volume"),t(wt,"play"),t(At,"burp"),t(Vt,"makeShader"),t(vt,"makeFont"),t(yt,"drawRaw"),t(Et,"flush"),t(xt,"frameStart"),t(bt,"usePostEffect"),t(St,"frameEnd"),t(Rt,"screen2ndc"),t(Mt,"pushMatrix"),t(Tt,"pushTranslate"),t(Ft,"pushScale"),t(Bt,"pushRotate"),t(Pt,"pushTransform"),t(It,"popTransform"),t(Ct,"drawUVQuad"),t(Ut,"drawTexture"),t(Dt,"drawSprite"),t(kt,"getArcPts"),t(Lt,"drawRect"),t(Nt,"drawLine"),t(Ot,"drawLines"),t(Gt,"drawTriangle"),t(qt,"drawCircle"),t(Kt,"drawEllipse"),t(Yt,"drawPolygon"),t(Ht,"drawStenciled"),t(jt,"drawMasked"),t(Qt,"drawSubtracted"),t(Xt,"getViewportScale"),t(zt,"drawUnscaled"),t(Jt,"applyCharTransform");let Wt=/\[(?<style>\w+)\](?<text>.*?)\[\/\k<style>\]/g;function Zt(e){let t={},n=e.replace(Wt,"$2"),r=0;for(let n of e.matchAll(Wt)){let e=n.index-r;for(let r=0;r<n.groups.text.length;r++)t[r+e]=[n.groups.style];r+=n[0].length-n.groups.text.length}return{charStyleMap:t,text:n}}t(Zt,"compileStyledText");let _t={};function $t(e){if(void 0===e.text)throw new Error('formatText() requires property "text".');let t=gt(e.font);if(""===e.text||t instanceof Ue||!t)return{width:0,height:0,chars:[],opt:e};let{charStyleMap:n,text:r}=Zt(e.text+""),i=r.split("");if(t instanceof Xe||"string"==typeof t){let e=t instanceof Xe?t.fontface.family:t,n=t instanceof Xe?{outline:t.outline,filter:t.filter}:{outline:0,filter:xe},r=_t[e]??{font:{tex:new le(2048,2048,{filter:n.filter}),map:{},size:64},cursor:new d(0),outline:n.outline};_t[e]||(_t[e]=r),t=r.font;for(let n of i)if(!r.font.map[n]){let i=z;i.clearRect(0,0,K.width,K.height),i.font=`${t.size}px ${e}`,i.textBaseline="top",i.textAlign="left",i.fillStyle="#ffffff";let s=i.measureText(n),o=Math.ceil(s.width),a=t.size;r.outline&&(i.lineJoin="round",i.lineWidth=2*r.outline,i.strokeStyle="#000000",i.strokeText(n,r.outline,r.outline),o+=2*r.outline,a+=3*r.outline),i.fillText(n,r.outline,r.outline);let h=i.getImageData(0,0,o,a);if(r.cursor.x+o>2048&&(r.cursor.x=0,r.cursor.y+=a,r.cursor.y>2048))throw new Error("Font atlas exceeds character limit");t.tex.update(h,r.cursor.x,r.cursor.y),t.map[n]=new w(r.cursor.x,r.cursor.y,o,a),r.cursor.x+=o}}let s=e.size||t.size,o=c(e.scale??1).scale(s/t.size),a=e.lineSpacing??0,h=e.letterSpacing??0,l=0,u=0,f=0,g=[],m=[],A=0,V=null,v=null;for(;A<i.length;){let n=i[A];if("\n"===n)f+=s+a,g.push({width:l-h,chars:m}),V=null,v=null,l=0,m=[];else{let r=t.map[n];if(r){let y=r.w*o.x;e.width&&l+y>e.width&&(f+=s+a,null!=V&&(A-=m.length-V,n=i[A],r=t.map[n],y=r.w*o.x,m=m.slice(0,V-1),l=v),V=null,v=null,g.push({width:l-h,chars:m}),l=0,m=[]),m.push({tex:t.tex,width:r.w,height:r.h,quad:new w(r.x/t.tex.width,r.y/t.tex.height,r.w/t.tex.width,r.h/t.tex.height),ch:n,pos:new d(l,f),opacity:e.opacity??1,color:e.color??p.WHITE,scale:c(o),angle:0})," "===n&&(V=m.length,v=l),l+=y,u=Math.max(u,l),l+=h}}A++}g.push({width:l-h,chars:m}),f+=s,e.width&&(u=e.width);let y=[];for(let r of g){let i=(u-r.width)*Ie(e.align??"left");for(let s of r.chars){let r=t.map[s.ch],a=y.length;if(s.pos=s.pos.add(i,0).add(r.w*o.x*.5,r.h*o.y*.5),e.transform){let t="function"==typeof e.transform?e.transform(a,s.ch):e.transform;t&&Jt(s,t)}if(n[a]){let t=n[a];for(let n of t){let t=e.styles[n],r="function"==typeof t?t(a,s.ch):t;r&&Jt(s,r)}}y.push(s)}}return{width:u,height:f,chars:y,opt:e}}function en(e){tn($t(e))}function tn(e){Pt(),Tt(e.opt.pos),Bt(e.opt.angle),Tt(Pe(e.opt.anchor??"topleft").add(1,1).scale(e.width,e.height).scale(-.5)),e.chars.forEach((t=>{Ct({tex:t.tex,width:t.width,height:t.height,pos:t.pos,scale:t.scale,angle:t.angle,color:t.color,opacity:t.opacity,quad:t.quad,anchor:"center",uniform:e.opt.uniform,shader:e.opt.shader,fixed:e.opt.fixed})})),It()}function nn(){return fe.width}function rn(){return fe.height}t($t,"formatText"),t(en,"drawText"),t(tn,"drawFormattedText"),t(nn,"width"),t(rn,"height");let sn={};function on(e){return new d((e.x-fe.viewport.x)*nn()/fe.viewport.width,(e.y-fe.viewport.y)*rn()/fe.viewport.height)}function an(e){return new d(e.x*fe.viewport.width/fe.width,e.y*fe.viewport.height/fe.height)}function hn(){return on(Z.mousePos())}t(on,"windowToContent"),t(an,"contentToView"),t(hn,"mousePos"),sn.error=e=>{e.error?Jr(e.error):Jr(new Error(e.message))},sn.unhandledrejection=e=>Jr(e.reason);for(let e in sn)window.addEventListener(e,sn[e]);let ln={inspect:!1,timeScale:1,showLog:!0,fps:()=>Z.fps(),numFrames:()=>Z.numFrames(),stepFrame:Or,drawCalls:()=>fe.drawCalls,clearLog:()=>Le.logs=[],log:t=>{let n=e.logMax??1,r=t instanceof Error?"error":"info";Le.logs.unshift(`[time]${Z.time().toFixed(2)}[/time] [${r}]${t?.toString?t.toString():t}[/${r}]`),Le.logs.length>n&&(Le.logs=Le.logs.slice(0,n))},error:e=>ln.log(new Error(e.toString?e.toString():e)),curRecording:null,get paused(){return Z.paused},set paused(e){Z.paused=e,e?me.ctx.suspend():me.ctx.resume()}};function un(){return Z.dt()}function dn(...e){return e.length>0&&(Le.cam.pos=c(...e)),Le.cam.pos?Le.cam.pos.clone():xr()}function cn(...e){return e.length>0&&(Le.cam.scale=c(...e)),Le.cam.scale.clone()}function fn(e){return void 0!==e&&(Le.cam.angle=e),Le.cam.angle}function pn(e=12){Le.cam.shake=e}function gn(e){return Le.cam.transform.multVec2(e)}function mn(e){return Le.cam.transform.invert().multVec2(e)}function wn(e){let t=new V;return e.pos&&t.translate(e.pos),e.scale&&t.scale(e.scale),e.angle&&t.rotate(e.angle),e.parent?t.mult(e.parent.transform):t}function An(e){let n=new Map,r={},i=new J,s=null,o={id:se(),hidden:!1,paused:!1,transform:new V,children:[],parent:null,add(e){let t=(()=>{if(Array.isArray(e))return An(e);if(e.parent)throw new Error("Cannot add a game obj that already has a parent.");return e})();return t.parent=this,t.transform=wn(t),this.children.push(t),t.trigger("add",t),Le.events.trigger("add",t),t},readd(e){let t=this.children.indexOf(e);return-1!==t&&(this.children.splice(t,1),this.children.push(e)),e},remove(e){let t=this.children.indexOf(e);-1!==t&&(e.trigger("destroy"),Le.events.trigger("destroy",e),e.parent=null,this.children.splice(t,1))},removeAll(e){this.get(e).forEach((e=>this.remove(e)))},update(){this.paused||(this.children.sort(((e,t)=>(e.z??0)-(t.z??0))).forEach((e=>e.update())),this.trigger("update"))},draw(){this.hidden||(Pt(),Tt(this.pos),Ft(this.scale),Bt(this.angle),this.trigger("draw"),this.children.sort(((e,t)=>(e.z??0)-(t.z??0))).forEach((e=>e.draw())),It())},drawInspect(){this.hidden||(Pt(),Tt(this.pos),Ft(this.scale),Bt(this.angle),this.children.sort(((e,t)=>(e.z??0)-(t.z??0))).forEach((e=>e.drawInspect())),this.trigger("drawInspect"),It())},use(e){if(!e)return;if("string"==typeof e)return this.use({id:e});let i=[];e.id&&(this.unuse(e.id),r[e.id]=[],i=r[e.id],n.set(e.id,e));for(let n in e){if(Fe.has(n))continue;let r=Object.getOwnPropertyDescriptor(e,n);if("function"==typeof r.value&&(e[n]=e[n].bind(this)),r.set&&Object.defineProperty(e,n,{set:r.set.bind(this)}),r.get&&Object.defineProperty(e,n,{get:r.get.bind(this)}),Be.has(n)){let r="add"===n?()=>{s=t((e=>i.push(e)),"onCurCompCleanup"),e[n](),s=null}:e[n];i.push(this.on(n,r).cancel)}else{if(void 0!==this[n])throw new Error(`Duplicate component property: "${n}"`);Object.defineProperty(this,n,{get:()=>e[n],set:t=>e[n]=t,configurable:!0,enumerable:!0}),i.push((()=>delete this[n]))}}let o=t((()=>{if(e.require)for(let t of e.require)if(!this.c(t))throw new Error(`Component "${e.id}" requires component "${t}"`)}),"checkDeps");e.destroy&&i.push(e.destroy.bind(this)),this.exists()?(o(),e.add&&(s=t((e=>i.push(e)),"onCurCompCleanup"),e.add.call(this),s=null)):e.require&&i.push(this.on("add",o).cancel)},unuse(e){r[e]&&(r[e].forEach((e=>e())),delete r[e]),n.has(e)&&n.delete(e)},c:e=>n.get(e),get(e,n={}){let r=n.recursive?this.children.flatMap(t((function e(t){return[t,...t.children.flatMap(e)]}),"recurse")):this.children;if(r=r.filter((t=>!e||t.is(e))),n.liveUpdate){let i=t((e=>n.recursive?this.isAncestorOf(e):e.parent===this),"isChild");xn((t=>{i(t)&&t.is(e)&&r.push(t)})),bn((t=>{if(i(t)&&t.is(e)){let e=r.findIndex((e=>e.id===t.id));-1!==e&&r.splice(e,1)}}))}return r},isAncestorOf(e){return!!e.parent&&(e.parent===this||this.isAncestorOf(e.parent))},exists(){return Le.root.isAncestorOf(this)},is(e){if("*"===e)return!0;if(Array.isArray(e)){for(let t of e)if(!this.c(t))return!1;return!0}return null!=this.c(e)},on(e,t){let n=i.on(e,t.bind(this));return s&&s((()=>n.cancel())),n},trigger(e,...t){i.trigger(e,...t),Le.objEvents.trigger(e,this,...t)},destroy(){this.parent&&this.parent.remove(this)},inspect(){let e={};for(let[t,r]of n)e[t]=r.inspect?r.inspect():null;return e},onAdd(e){return this.on("add",e)},onUpdate(e){return this.on("update",e)},onDraw(e){return this.on("draw",e)},onDestroy(e){return this.on("destroy",e)},clearEvents(){i.clear()}};for(let t of e)o.use(t);return o}function Vn(e,t,n){return Le.objEvents[e]||(Le.objEvents[e]=new j),Le.objEvents.on(e,((e,...r)=>{e.is(t)&&n(e,...r)}))}t(un,"dt"),t(dn,"camPos"),t(cn,"camScale"),t(fn,"camRot"),t(pn,"shake"),t(gn,"toScreen"),t(mn,"toWorld"),t(wn,"calcTransform"),t(An,"make"),t(Vn,"on");let vn,yn=t(((e,t)=>{if("function"==typeof e&&void 0===t){let t=Pr([{update:e}]);return{get paused(){return t.paused},set paused(e){t.paused=e},cancel:()=>t.destroy()}}if("string"==typeof e)return Vn("update",e,t)}),"onUpdate"),En=t(((e,t)=>{if("function"==typeof e&&void 0===t){let t=Pr([{draw:e}]);return{get paused(){return t.hidden},set paused(e){t.hidden=e},cancel:()=>t.destroy()}}if("string"==typeof e)return Vn("draw",e,t)}),"onDraw");function xn(e,t){return"function"==typeof e&&void 0===t?Le.events.on("add",e):"string"==typeof e?Vn("add",e,t):void 0}function bn(e,t){return"function"==typeof e&&void 0===t?Le.events.on("destroy",e):"string"==typeof e?Vn("destroy",e,t):void 0}function Sn(e,t,n){return Vn("collide",e,((e,r,i)=>r.is(t)&&n(e,r,i)))}function Rn(e,t,n){return Vn("collideUpdate",e,((e,r,i)=>r.is(t)&&n(e,r,i)))}function Mn(e,t,n){return Vn("collideEnd",e,((e,r,i)=>r.is(t)&&n(e,r,i)))}function Tn(e,t){Ur(e,{recursive:!0}).forEach(t),xn(e,t)}function Fn(e,t){if("function"==typeof e)return Z.onMousePress(e);{let n=[];return Tn(e,(e=>{if(!e.area)throw new Error("onClick() requires the object to have area() component");n.push(e.onClick((()=>t(e))))})),Q.join(n)}}function Bn(e,t){let n=[];return Tn(e,(e=>{if(!e.area)throw new Error("onHover() requires the object to have area() component");n.push(e.onHover((()=>t(e))))})),Q.join(n)}function Pn(e,t){let n=[];return Tn(e,(e=>{if(!e.area)throw new Error("onHoverUpdate() requires the object to have area() component");n.push(e.onHoverUpdate((()=>t(e))))})),Q.join(n)}function In(e,t){let n=[];return Tn(e,(e=>{if(!e.area)throw new Error("onHoverEnd() requires the object to have area() component");n.push(e.onHoverEnd((()=>t(e))))})),Q.join(n)}function Cn(e,t){let n=0,r=[];t&&r.push(t);let i=yn((()=>{n+=un(),n>=e&&(i.cancel(),r.forEach((e=>e())))}));return{paused:i.paused,cancel:i.cancel,onEnd(e){r.push(e)},then(e){return this.onEnd(e),this}}}function Un(e,n){let r=null,i=t((()=>{r=Cn(e,i),n()}),"newAction");return r=Cn(0,i),{get paused(){return r.paused},set paused(e){r.paused=e},cancel:()=>r.cancel()}}function Dn(){Z.onKeyPress("f1",(()=>{ln.inspect=!ln.inspect})),Z.onKeyPress("f2",(()=>{ln.clearLog()})),Z.onKeyPress("f8",(()=>{ln.paused=!ln.paused})),Z.onKeyPress("f7",(()=>{ln.timeScale=jn(o(ln.timeScale-.2,0,2),1)})),Z.onKeyPress("f9",(()=>{ln.timeScale=jn(o(ln.timeScale+.2,0,2),1)})),Z.onKeyPress("f10",(()=>{ln.stepFrame()}))}function kn(){Z.onKeyPress("b",(()=>At()))}function Ln(e){Le.gravity=e}function Nn(){return Le.gravity}function On(...e){1===e.length||2===e.length?(fe.bgColor=g(e[0]),e[1]&&(fe.bgAlpha=e[1])):(3===e.length||4===e.length)&&(fe.bgColor=g(e[0],e[1],e[2]),e[3]&&(fe.bgAlpha=e[3])),he.clearColor(fe.bgColor.r/255,fe.bgColor.g/255,fe.bgColor.b/255,fe.bgAlpha)}function Gn(){return fe.bgColor.clone()}function qn(...e){return{id:"pos",pos:c(...e),moveBy(...e){this.pos=this.pos.add(c(...e))},move(...e){this.moveBy(c(...e).scale(un()))},moveTo(...e){if("number"==typeof e[0]&&"number"==typeof e[1])return this.moveTo(c(e[0],e[1]),e[2]);let t=e[0],n=e[1];if(void 0===n)return void(this.pos=c(t));let r=t.sub(this.pos);r.len()<=n*un()?this.pos=c(t):this.move(r.unit().scale(n))},worldPos(){return this.parent?this.parent.transform.multVec2(this.pos):this.pos},screenPos(){return this.fixed?this.pos:gn(this.pos)},inspect(){return`(${Math.round(this.pos.x)}, ${Math.round(this.pos.y)})`},drawInspect(){qt({color:g(255,0,0),radius:4/Xt()})}}}function Kn(...e){return 0===e.length?Kn(1):{id:"scale",scale:c(...e),scaleTo(...e){this.scale=c(...e)},scaleBy(...e){this.scale.scale(c(...e))},inspect(){return`(${jn(this.scale.x,2)}, ${jn(this.scale.y,2)})`}}}function Yn(e){return{id:"rotate",angle:e??0,rotateBy(e){this.angle+=e},rotateTo(e){this.angle=e},inspect(){return`${Math.round(this.angle)}`}}}function Hn(...e){return{id:"color",color:g(...e),inspect(){return this.color.toString()}}}function jn(e,t){return Number(e.toFixed(t))}function Qn(e){return{id:"opacity",opacity:e??1,inspect(){return`${jn(this.opacity,1)}`},fadeOut(e=1,t=we.linear){return _r(this.opacity,0,e,(e=>this.opacity=e),t)}}}function Xn(e){if(!e)throw new Error("Please define an anchor");return{id:"anchor",anchor:e,inspect(){return"string"==typeof this.anchor?this.anchor:this.anchor.toString()}}}function zn(e){return{id:"z",z:e,inspect(){return`${this.z}`}}}function Jn(e,t){return{id:"follow",require:["pos"],follow:{obj:e,offset:t??c(0)},add(){e.exists()&&(this.pos=this.follow.obj.pos.add(this.follow.offset))},update(){e.exists()&&(this.pos=this.follow.obj.pos.add(this.follow.offset))}}}function Wn(e,t){let n="number"==typeof e?d.fromAngle(e):e.unit();return{id:"move",require:["pos"],update(){this.move(n.scale(t))}}}function Zn(e={}){let t=e.distance??200,n=!1;return{id:"offscreen",require:["pos"],isOffScreen(){let e=gn(this.pos),n=new G(c(0),nn(),rn());return!C(n,e)&&n.sdistToPoint(e)>t*t},onExitScreen(e){return this.on("exitView",e)},onEnterScreen(e){return this.on("enterView",e)},update(){this.isOffScreen()?(n||(this.trigger("exitView"),n=!0),e.hide&&(this.hidden=!0),e.pause&&(this.paused=!0),e.destroy&&this.destroy()):(n&&(this.trigger("enterView"),n=!1),e.hide&&(this.hidden=!1),e.pause&&(this.paused=!1))}}}function _n(e={}){let t={},n=new Set;return{id:"area",collisionIgnore:e.collisionIgnore??[],add(){this.area.cursor&&this.onHover((()=>Z.setCursor(this.area.cursor))),this.onCollideUpdate(((e,r)=>{t[e.id]||this.trigger("collide",e,r),t[e.id]=r,n.add(e.id)}))},update(){for(let e in t)n.has(Number(e))||(this.trigger("collideEnd",t[e].target),delete t[e]);n.clear()},drawInspect(){let e=this.localArea();Pt(),Ft(this.area.scale),Tt(this.area.offset);let t={outline:{width:4/Xt(),color:g(0,0,255)},anchor:this.anchor,fill:!1,fixed:this.fixed};e instanceof G?Lt({...t,pos:e.pos,width:e.width,height:e.height}):e instanceof Y?Yt({...t,pts:e.pts}):e instanceof q&&qt({...t,pos:e.center,radius:e.radius}),It()},area:{shape:e.shape??null,scale:e.scale?c(e.scale):c(1),offset:e.offset??c(0),cursor:e.cursor??null},isClicked(){return Z.isMousePressed()&&this.isHovering()},isHovering(){let e=this.fixed?hn():mn(hn());return this.hasPoint(e)},checkCollision:e=>t[e.id]??null,getCollisions:()=>Object.values(t),isColliding:e=>!!t[e.id],isOverlapping(e){let n=t[e.id];return n&&n.hasOverlap()},onClick(e){let t=Z.onMousePress("left",(()=>{this.isHovering()&&e()}));return this.onDestroy((()=>t.cancel())),t},onHover(e){let t=!1;return this.onUpdate((()=>{t?t=this.isHovering():this.isHovering()&&(t=!0,e())}))},onHoverUpdate(e){return this.onUpdate((()=>{this.isHovering()&&e()}))},onHoverEnd(e){let t=!1;return this.onUpdate((()=>{t?this.isHovering()||(t=!1,e()):t=this.isHovering()}))},onCollide(e,t){return"function"==typeof e&&void 0===t?this.on("collide",e):"string"==typeof e?this.onCollide(((n,r)=>{n.is(e)&&t(n,r)})):void 0},onCollideUpdate(e,t){return"function"==typeof e&&void 0===t?this.on("collideUpdate",e):"string"==typeof e?this.on("collideUpdate",((n,r)=>n.is(e)&&t(n,r))):void 0},onCollideEnd(e,t){return"function"==typeof e&&void 0===t?this.on("collideEnd",e):"string"==typeof e?this.on("collideEnd",(n=>n.is(e)&&t(n))):void 0},hasPoint(e){return N(this.worldArea(),e)},resolveCollision(e){let t=this.checkCollision(e);t&&!t.resolved&&(this.pos=this.pos.add(t.displacement),t.resolved=!0)},localArea(){return this.area.shape?this.area.shape:this.renderArea()},worldArea(){let e=this.localArea();if(!(e instanceof Y||e instanceof G))throw new Error("Only support polygon and rect shapes for now");let t=this.transform.clone().scale(c(this.area.scale??1)).translate(this.area.offset);if(e instanceof G){let n=Pe(this.anchor||ye).add(1,1).scale(-.5).scale(e.width,e.height);t.translate(n)}return e.transform(t)},screenArea(){let e=this.worldArea();return this.fixed?e:e.transform(Le.cam.transform)}}}function $n(e){return{color:e.color,opacity:e.opacity,anchor:e.anchor,outline:e.outline,fixed:e.fixed,shader:e.shader,uniform:e.uniform}}function er(e,n={}){let r=null,i=null,s=new X;if(!e)throw new Error("Please pass the resource name or data to sprite()");let o=t(((e,t,n,r)=>{let i=c(1,1);return n&&r?(i.x=n/(e.width*t.w),i.y=r/(e.height*t.h)):n?(i.x=n/(e.width*t.w),i.y=i.x):r&&(i.y=r/(e.height*t.h),i.x=i.y),i}),"calcTexScale");return{id:"sprite",width:0,height:0,frame:n.frame||0,quad:n.quad||new w(0,0,1,1),animSpeed:n.animSpeed??1,flipX:n.flipX??!1,flipY:n.flipY??!1,draw(){if(!r)return;let e=r.frames[this.frame??0];if(!e)throw new Error(`Frame not found: ${this.frame??0}`);if(r.slice9){let{left:t,right:i,top:s,bottom:o}=r.slice9,a=r.tex.width*e.w,h=r.tex.height*e.h,l=this.width-t-i,u=this.height-s-o,d=t/a,c=i/a,f=1-d-c,p=s/h,g=o/h,m=1-p-g,w=[A(0,0,d,p),A(d,0,f,p),A(d+f,0,c,p),A(0,p,d,m),A(d,p,f,m),A(d+f,p,c,m),A(0,p+m,d,g),A(d,p+m,f,g),A(d+f,p+m,c,g),A(0,0,t,s),A(t,0,l,s),A(t+l,0,i,s),A(0,s,t,u),A(t,s,l,u),A(t+l,s,i,u),A(0,s+u,t,o),A(t,s+u,l,o),A(t+l,s+u,i,o)];for(let t=0;t<9;t++){let i=w[t],s=w[t+9];Ut(Object.assign($n(this),{pos:s.pos(),tex:r.tex,quad:e.scale(i),flipX:this.flipX,flipY:this.flipY,tiled:n.tiled,width:s.w,height:s.h}))}}else Ut(Object.assign($n(this),{tex:r.tex,quad:e,flipX:this.flipX,flipY:this.flipY,tiled:n.tiled,width:this.width,height:this.height}))},add(){let i=t((e=>{let t=e.frames[0].clone();n.quad&&(t=t.scale(n.quad));let i=o(e.tex,t,n.width,n.height);this.width=e.tex.width*t.w*i.x,this.height=e.tex.height*t.h*i.y,n.anim&&this.play(n.anim),r=e,s.trigger(r)}),"setSpriteData"),a=ct(e);a?a.onLoad(i):mr((()=>i(ct(e).data)))},update(){if(!i)return;let e=r.anims[i.name];if("number"!=typeof e){if(0===e.speed)throw new Error("Sprite anim speed cannot be 0");i.timer+=un()*this.animSpeed,i.timer>=1/i.speed&&(i.timer=0,e.from>e.to?(this.frame--,this.frame<e.to&&(i.loop?this.frame=e.from:(this.frame++,i.onEnd(),this.stop()))):(this.frame++,this.frame>e.to&&(i.loop?this.frame=e.from:(this.frame--,i.onEnd(),this.stop()))))}else this.frame=e},play(e,t={}){if(!r)return void s.add((()=>this.play(e,t)));let n=r.anims[e];if(void 0===n)throw new Error(`Anim not found: ${e}`);i&&this.stop(),i="number"==typeof n?{name:e,timer:0,loop:!1,pingpong:!1,speed:0,onEnd:()=>{}}:{name:e,timer:0,loop:t.loop??n.loop??!1,pingpong:t.pingpong??n.pingpong??!1,speed:t.speed??n.speed??10,onEnd:t.onEnd??(()=>{})},this.frame="number"==typeof n?n:n.from,this.trigger("animStart",e)},stop(){if(!i)return;let e=i.name;i=null,this.trigger("animEnd",e)},numFrames:()=>r?.frames.length??0,curAnim:()=>i?.name,onAnimEnd(e){return this.on("animEnd",e)},onAnimStart(e){return this.on("animStart",e)},renderArea(){return new G(c(0),this.width,this.height)},inspect(){if("string"==typeof e)return`"${e}"`}}}function tr(e,n={}){function r(e){let t=$t(Object.assign($n(e),{text:e.text+"",size:e.textSize,font:e.font,width:n.width&&e.width,align:e.align,letterSpacing:e.letterSpacing,lineSpacing:e.lineSpacing,transform:e.textTransform,styles:e.textStyles}));return n.width||(e.width=t.width/(e.scale?.x||1)),e.height=t.height/(e.scale?.y||1),t}return t(r,"update"),{id:"text",text:e,textSize:n.size??36,font:n.font,width:n.width,height:0,align:n.align,lineSpacing:n.lineSpacing,letterSpacing:n.letterSpacing,textTransform:n.transform,textStyles:n.styles,add(){mr((()=>r(this)))},draw(){tn(r(this))},renderArea(){return new G(c(0),this.width,this.height)}}}function nr(e,t,n={}){return{id:"rect",width:e,height:t,radius:n.radius||0,draw(){Lt(Object.assign($n(this),{width:this.width,height:this.height,radius:this.radius}))},renderArea(){return new G(c(0),this.width,this.height)},inspect(){return`${Math.ceil(this.width)}, ${Math.ceil(this.height)}`}}}function rr(e,t){return{id:"rect",width:e,height:t,draw(){Ct(Object.assign($n(this),{width:this.width,height:this.height}))},renderArea(){return new G(c(0),this.width,this.height)},inspect(){return`${Math.ceil(this.width)}, ${Math.ceil(this.height)}`}}}function ir(e){return{id:"circle",radius:e,draw(){qt(Object.assign($n(this),{radius:this.radius}))},renderArea(){return new G(new d(this.anchor?0:-this.radius),2*this.radius,2*this.radius)},inspect(){return`${Math.ceil(this.radius)}`}}}function sr(e=1,t=g(0,0,0)){return{id:"outline",outline:{width:e,color:t}}}function or(){return{id:"timer",wait(e,t){let n=[t],r=0,i=this.onUpdate((()=>{r+=un(),r>=e&&(n.forEach((e=>e())),i.cancel())}));return{get paused(){return i.paused},set paused(e){i.paused=e},cancel:i.cancel,onEnd(e){n.push(e)},then(e){return this.onEnd(e),this}}},loop(e,n){let r=null,i=t((()=>{r=this.wait(e,i),n()}),"newAction");return r=Cn(0,i),{get paused(){return r.paused},set paused(e){r.paused=e},cancel:()=>r.cancel()}},tween(e,t,n,r,i=we.linear){let s=0,o=[],h=this.onUpdate((()=>{s+=un();let l=Math.min(s/n,1);r(a(e,t,i(l))),1===l&&(h.cancel(),r(t),o.forEach((e=>e())))}));return{get paused(){return h.paused},set paused(e){h.paused=e},onEnd(e){o.push(e)},then(e){return this.onEnd(e),this},cancel(){h.cancel()},finish(){h.cancel(),r(t),o.forEach((e=>e()))}}}}}function ar(e={}){let t=c(0),n=null,r=null,i=!1;return{id:"body",require:["pos","area"],jumpForce:e.jumpForce??640,gravityScale:e.gravityScale??1,isStatic:e.isStatic??!1,mass:e.mass??1,add(){if(0===this.mass)throw new Error("Can't set body mass to 0");this.onCollideUpdate(((e,t)=>{if(e.is("body")&&!t.resolved&&(this.trigger("beforePhysicsResolve",t),e.trigger("beforePhysicsResolve",t.reverse()),!(t.resolved||this.isStatic&&e.isStatic))){if(this.isStatic||e.isStatic){let n=!this.isStatic&&e.isStatic?t:t.reverse();n.source.pos=n.source.pos.add(n.displacement),n.source.transform=wn(n.source)}else{let n=this.mass+e.mass;this.pos=this.pos.add(t.displacement.scale(e.mass/n)),e.pos=e.pos.add(t.displacement.scale(-this.mass/n)),this.transform=wn(this),e.transform=wn(e)}t.resolved=!0,this.trigger("physicsResolve",t),e.trigger("physicsResolve",t.reverse())}})),this.onPhysicsResolve((e=>{Le.gravity&&(e.isBottom()&&this.isFalling()?(t.y=0,n=e.target,r=e.target.pos,i?i=!1:this.trigger("ground",n)):e.isTop()&&this.isJumping()&&(t.y=0,this.trigger("headbutt",e.target)))}))},update(){if(!Le.gravity||this.isStatic)return;if(i&&(n=null,r=null,this.trigger("fallOff"),i=!1),n){if(this.isOverlapping(n)&&n.exists()&&n.is("body"))return!n.pos.eq(r)&&!1!==e.stickToPlatform&&this.moveBy(n.pos.sub(r)),void(r=n.pos);i=!0}let s=t.y;t.y+=Le.gravity*this.gravityScale*un(),t.y=Math.min(t.y,e.maxVelocity??65536),s<0&&t.y>=0&&this.trigger("fall"),this.move(t)},onPhysicsResolve(e){return this.on("physicsResolve",e)},onBeforePhysicsResolve(e){return this.on("beforePhysicsResolve",e)},curPlatform:()=>n,isGrounded:()=>null!==n,isFalling:()=>t.y>0,isJumping:()=>t.y<0,jump(e){n=null,r=null,t.y=-e||-this.jumpForce},onGround(e){return this.on("ground",e)},onFall(e){return this.on("fall",e)},onFallOff(e){return this.on("fallOff",e)},onHeadbutt(e){return this.on("headbutt",e)}}}function hr(e=2){let t=e;return{id:"doubleJump",require:["body"],numJumps:e,add(){this.onGround((()=>{t=this.numJumps}))},doubleJump(e){t<=0||(t<this.numJumps&&this.trigger("doubleJump"),t--,this.jump(e))},onDoubleJump(e){return this.on("doubleJump",e)},inspect:()=>`${t}`}}function lr(e,t){return{id:"shader",shader:e,..."function"==typeof t?{uniform:t(),update(){this.uniform=t()}}:{uniform:t}}}function ur(){return{id:"fixed",fixed:!0}}function dr(e){return{id:"stay",stay:!0,scenesToStay:e}}function cr(e){if(null==e)throw new Error("health() requires the initial amount of hp");return{id:"health",hurt(t=1){this.setHP(e-t),this.trigger("hurt",t)},heal(t=1){this.setHP(e+t),this.trigger("heal",t)},hp:()=>e,setHP(t){(e=t)<=0&&this.trigger("death")},onHurt(e){return this.on("hurt",e)},onHeal(e){return this.on("heal",e)},onDeath(e){return this.on("death",e)},inspect:()=>`${e}`}}function fr(e,t={}){if(null==e)throw new Error("lifespan() requires time");let n=t.fade??0;return{id:"lifespan",async add(){await Cn(e),n>0&&this.opacity&&await _r(this.opacity,0,n,(e=>this.opacity=e),we.linear),this.destroy()}}}function pr(e,n,r){if(!e)throw new Error("state() requires an initial state");let i={};function s(e){i[e]||(i[e]={enter:new X,end:new X,update:new X,draw:new X})}function o(e,t,n){return s(t),i[t][e].add(n)}function a(e,t,...n){s(t),i[t][e].trigger(...n)}t(s,"initStateEvents"),t(o,"on"),t(a,"trigger");let h=!1;return{id:"state",state:e,enterState(e,...t){if(h=!0,n&&!n.includes(e))throw new Error(`State not found: ${e}`);let i=this.state;if(r){if(!r?.[i])return;let t="string"==typeof r[i]?[r[i]]:r[i];if(!t.includes(e))throw new Error(`Cannot transition state from "${i}" to "${e}". Available transitions: ${t.map((e=>`"${e}"`)).join(", ")}`)}a("end",i,...t),this.state=e,a("enter",e,...t),a("enter",`${i} -> ${e}`,...t)},onStateTransition:(e,t,n)=>o("enter",`${e} -> ${t}`,n),onStateEnter:(e,t)=>o("enter",e,t),onStateUpdate:(e,t)=>o("update",e,t),onStateDraw:(e,t)=>o("draw",e,t),onStateEnd:(e,t)=>o("end",e,t),update(){h||(a("enter",e),h=!0),a("update",this.state)},draw(){a("draw",this.state)},inspect(){return this.state}}}function gr(e=1){let t=0,n=!1;return{require:["opacity"],add(){this.opacity=0},update(){n||(t+=un(),this.opacity=h(t,0,e,0,1),t>=e&&(this.opacity=1,n=!0))}}}function mr(e){ke.loaded?e():Le.events.on("load",e)}function wr(e,t){Le.scenes[e]=t}function Ar(t,...n){if(!Le.scenes[t])throw new Error(`Scene not found: ${t}`);Le.events.onOnce("frameEnd",(()=>{Le.events.trigger("sceneLeave",t),Z.events.clear(),Le.events.clear(),Le.objEvents.clear(),[...Le.root.children].forEach((e=>{(!e.stay||e.scenesToStay&&!e.scenesToStay.includes(t))&&Le.root.remove(e)})),Le.root.clearEvents(),Le.cam={pos:null,scale:c(1),angle:0,shake:0,transform:new V},Le.scenes[t](...n),!1!==e.debug&&Dn(),e.burp&&kn()}))}function Vr(e){return Le.events.on("sceneLeave",e)}function vr(e,t){try{return JSON.parse(window.localStorage[e])}catch{return t?(yr(e,t),t):null}}function yr(e,t){window.localStorage[e]=JSON.stringify(t)}function Er(t){let n=t(ti);for(let t in n)ti[t]=n[t],!1!==e.global&&(window[t]=n[t]);return ti}function xr(){return c(nn()/2,rn()/2)}var br;function Sr(e={}){let n=c(0),r=e.isObstacle??!1,i=e.cost??0,s=e.edges??[],o=t((()=>{let e={left:1,top:2,right:4,bottom:8};return s.map((t=>e[t]||0)).reduce(((e,t)=>e|t),0)}),"getEdgeMask"),a=o();return{id:"tile",tilePosOffset:e.offset??c(0),set tilePos(e){let t=this.getLevel();n=e.clone(),this.pos=c(this.tilePos.x*t.tileWidth(),this.tilePos.y*t.tileHeight()).add(this.tilePosOffset)},get tilePos(){return n},set isObstacle(e){r!==e&&(r=e,this.getLevel().invalidateNavigationMap())},get isObstacle(){return r},set cost(e){i!==e&&(i=e,this.getLevel().invalidateNavigationMap())},get cost(){return i},set edges(e){s=e,a=o(),this.getLevel().invalidateNavigationMap()},get edges(){return s},get edgeMask(){return a},getLevel(){return this.parent},moveLeft(){this.tilePos=this.tilePos.add(c(-1,0))},moveRight(){this.tilePos=this.tilePos.add(c(1,0))},moveUp(){this.tilePos=this.tilePos.add(c(0,-1))},moveDown(){this.tilePos=this.tilePos.add(c(0,1))}}}function Rr(e,n){if(!n.tileWidth||!n.tileHeight)throw new Error("Must provide tileWidth and tileHeight.");let r=Pr([qn(n.pos??c(0))]),i=e.length,s=0,o=null,a=null,h=null,l=null,u=t((e=>e.x+e.y*s),"tile2Hash"),d=t((e=>c(Math.floor(e%s),Math.floor(e/s))),"hash2Tile"),f=t((()=>{o=[];for(let e of r.children)p(e)}),"createSpatialMap"),p=t((e=>{let t=u(e.tilePos);o[t]?o[t].push(e):o[t]=[e]}),"insertIntoSpatialMap"),g=t((e=>{let t=u(e.tilePos);if(o[t]){let n=o[t].indexOf(e);n>=0&&o[t].splice(n,1)}}),"removeFromSpatialMap"),m=t((()=>{let e=!1;for(let t of r.children){let n=r.pos2Tile(t.pos);(t.tilePos.x!=n.x||t.tilePos.y!=n.y)&&(e=!0,g(t),t.tilePos.x=n.x,t.tilePos.y=n.y,p(t))}e&&r.trigger("spatial_map_changed")}),"updateSpatialMap"),w=t((()=>{let e=r.getSpatialMap(),t=r.numRows()*r.numColumns();a?a.length=t:a=new Array(t),a.fill(1,0,t);for(let t=0;t<e.length;t++){let n=e[t];if(n){let e=0;for(let t of n){if(t.isObstacle){e=1/0;break}e+=t.cost}a[t]=e||1}}}),"createCostMap"),A=t((()=>{let e=r.getSpatialMap(),t=r.numRows()*r.numColumns();h?h.length=t:h=new Array(t),h.fill(15,0,t);for(let t=0;t<e.length;t++){let n=e[t];if(n){let e=n.length,r=15;for(let t=0;t<e;t++)r|=n[t].edgeMask;h[t]=r}}}),"createEdgeMap"),V=t((()=>{let e=r.numRows()*r.numColumns(),n=t(((e,t)=>{let n=[];for(n.push(e);n.length>0;){let e=n.pop();E(e).forEach((e=>{l[e]<0&&(l[e]=t,n.push(e))}))}}),"traverse");l?l.length=e:l=new Array(e),l.fill(-1,0,e);let i=0;for(let e=0;e<a.length;e++)l[e]>=0||n(e,i),i++}),"createConnectivityMap"),v=t(((e,t)=>a[t]),"getCost"),y=t(((e,t)=>{let n=d(e),r=d(t);return n.dist(r)}),"getHeuristic"),E=t(((e,t)=>{let n=[],r=Math.floor(e%s),o=r>0&&1&h[e]&&a[e-1]!==1/0,l=e>=s&&2&h[e]&&a[e-s]!==1/0,u=r<s-1&&4&h[e]&&a[e+1]!==1/0,d=e<s*i-s-1&&8&h[e]&&a[e+s]!==1/0;return t?(o&&(l&&n.push(e-s-1),n.push(e-1),d&&n.push(e+s-1)),l&&n.push(e-s),u&&(l&&n.push(e-s+1),n.push(e+1),d&&n.push(e+s+1)),d&&n.push(e+s)):(o&&n.push(e-1),l&&n.push(e-s),u&&n.push(e+1),d&&n.push(e+s)),n}),"getNeighbours"),x={id:"level",tileWidth:()=>n.tileWidth,tileHeight:()=>n.tileHeight,spawn(e,...t){let i=c(...t),s=(()=>{if("string"!=typeof e){if(Array.isArray(e))return e;throw new Error("Expected a symbol or a component list")}if(n.tiles[e]){if("function"!=typeof n.tiles[e])throw new Error("Level symbol def must be a function returning a component list");return n.tiles[e](i)}if(n.wildcardTile)return n.wildcardTile(e,i)})();if(!s)return null;let a=!1,h=!1;for(let e of s)"tile"===e.id&&(h=!0),"pos"===e.id&&(a=!0);a||s.push(qn()),h||s.push(Sr());let l=r.add(s);return a&&(l.tilePosOffset=l.pos.clone()),l.tilePos=i,o&&(p(l),this.trigger("spatial_map_changed"),this.trigger("navigation_map_invalid")),l},numColumns:()=>s,numRows:()=>i,levelWidth(){return s*this.tileWidth()},levelHeight(){return i*this.tileHeight()},tile2Pos(...e){return c(...e).scale(this.tileWidth(),this.tileHeight())},pos2Tile(...e){let t=c(...e);return c(Math.floor(t.x/this.tileWidth()),Math.floor(t.y/this.tileHeight()))},getSpatialMap:()=>(o||f(),o),onSpatialMapChanged(e){return this.on("spatial_map_changed",e)},onNavigationMapInvalid(e){return this.on("navigation_map_invalid",e)},getAt(e){o||f();let t=u(e);return o[t]||[]},update(){o&&m()},invalidateNavigationMap(){a=null,h=null,l=null},onNavigationMapChanged(e){return this.on("navigation_map_changed",e)},getTilePath(e,t,n={}){if(a||w(),h||A(),l||V(),e.x<0||e.x>=s||e.y<0||e.y>=i||t.x<0||t.x>=s||t.y<0||t.y>=i)return null;let r=u(e),o=u(t);if(a[o]===1/0)return null;if(r===o)return[];if(-1!=l[r]&&l[r]!==l[o])return null;let c=new oe(((e,t)=>e.cost<t.cost));c.insert({cost:0,node:r});let f=new Map;f.set(r,r);let p=new Map;for(p.set(r,0);0!==c.length;){let e=c.remove()?.node;if(e===o)break;let t=E(e,n.allowDiagonals);for(let n of t){let t=(p.get(e)||0)+v(e,n)+y(n,o);(!p.has(n)||t<p.get(n))&&(p.set(n,t),c.insert({cost:t,node:n}),f.set(n,e))}}let g=[],m=o,x=d(m);for(g.push(x);m!==r;){m=f.get(m);let e=d(m);g.push(e)}return g.reverse()},getPath(e,t,n={}){let r=this.tileWidth(),i=this.tileHeight(),s=this.getTilePath(this.pos2Tile(e),this.pos2Tile(t),n);return s?[e,...s.slice(1,-1).map((e=>e.scale(r,i).add(r/2,i/2))),t]:null}};return r.use(x),r.onNavigationMapInvalid((()=>{r.invalidateNavigationMap(),r.trigger("navigation_map_changed")})),e.forEach(((e,t)=>{let n=e.split("");s=Math.max(n.length,s),n.forEach(((e,n)=>{r.spawn(e,c(n,t))}))})),r}function Mr(e={}){let t=null,n=null,r=null,i=null;return{id:"agent",require:["pos","tile"],agentSpeed:e.speed??100,allowDiagonals:e.allowDiagonals??!0,getDistanceToTarget(){return t?this.pos.dist(t):0},getNextLocation:()=>n&&r?n[r]:null,getPath:()=>n?n.slice():null,getTarget:()=>t,isNavigationFinished:()=>!n||null===r,isTargetReachable:()=>null!==n,isTargetReached(){return!t||this.pos.eq(t)},setTarget(e){t=e,n=this.getLevel().getPath(this.pos,t,{allowDiagonals:this.allowDiagonals}),r=n?0:null,n?(i||(i=this.getLevel().onNavigationMapChanged((()=>{n&&null!==r&&(n=this.getLevel().getPath(this.pos,t,{allowDiagonals:this.allowDiagonals}),r=n?0:null,n?this.trigger("navigation-next",this,n[r]):this.trigger("navigation-ended",this))})),this.onDestroy((()=>i.cancel()))),this.trigger("navigation-started",this),this.trigger("navigation-next",this,n[r])):this.trigger("navigation-ended",this)},update(){if(n&&null!==r){if(this.pos.sdist(n[r])<2){if(r===n.length-1)return this.pos=t.clone(),r=null,this.trigger("navigation-ended",this),void this.trigger("target-reached",this);r++,this.trigger("navigation-next",this,n[r])}this.moveTo(n[r],this.agentSpeed)}},onNavigationStarted(e){return this.on("navigation-started",e)},onNavigationNext(e){return this.on("navigation-next",e)},onNavigationEnded(e){return this.on("navigation-ended",e)},onTargetReached(e){return this.on("target-reached",e)},inspect:()=>JSON.stringify({target:JSON.stringify(t),path:JSON.stringify(n)})}}function Tr(e){let t=Z.canvas().captureStream(e),n=me.ctx.createMediaStreamDestination();me.masterNode.connect(n);let r=new MediaRecorder(t),i=[];return r.ondataavailable=e=>{e.data.size>0&&i.push(e.data)},r.onerror=()=>{me.masterNode.disconnect(n),t.getTracks().forEach((e=>e.stop()))},r.start(),{resume(){r.resume()},pause(){r.pause()},stop:()=>(r.stop(),me.masterNode.disconnect(n),t.getTracks().forEach((e=>e.stop())),new Promise((e=>{r.onstop=()=>{e(new Blob(i,{type:"video/mp4"}))}}))),download(e="kaboom.mp4"){this.stop().then((t=>ne(e,t)))}}}function Fr(){return document.activeElement===Z.canvas()}function Br(e){e.destroy()}t(xn,"onAdd"),t(bn,"onDestroy"),t(Sn,"onCollide"),t(Rn,"onCollideUpdate"),t(Mn,"onCollideEnd"),t(Tn,"forAllCurrentAndFuture"),t(Fn,"onClick"),t(Bn,"onHover"),t(Pn,"onHoverUpdate"),t(In,"onHoverEnd"),t(Cn,"wait"),t(Un,"loop"),t(Dn,"enterDebugMode"),t(kn,"enterBurpMode"),t(Ln,"setGravity"),t(Nn,"getGravity"),t(On,"setBackground"),t(Gn,"getBackground"),t(qn,"pos"),t(Kn,"scale"),t(Yn,"rotate"),t(Hn,"color"),t(jn,"toFixed"),t(Qn,"opacity"),t(Xn,"anchor"),t(zn,"z"),t(Jn,"follow"),t(Wn,"move"),t(Zn,"offscreen"),t(_n,"area"),t($n,"getRenderProps"),t((function(e){return{add(){for(let t of e)this.add(e)}}}),"children"),t(er,"sprite"),t(tr,"text"),t(nr,"rect"),t(rr,"uvquad"),t(ir,"circle"),t(sr,"outline"),t(or,"timer"),t(ar,"body"),t(hr,"doubleJump"),t(lr,"shader"),t(ur,"fixed"),t(dr,"stay"),t(cr,"health"),t(fr,"lifespan"),t(pr,"state"),t(gr,"fadeIn"),t(mr,"onLoad"),t(wr,"scene"),t(Ar,"go"),t(Vr,"onSceneLeave"),t(vr,"getData"),t(yr,"setData"),t(Er,"plug"),t(xr,"center"),(br=vn||={})[br.None=0]="None",br[br.Left=1]="Left",br[br.Top=2]="Top",br[br.LeftTop=3]="LeftTop",br[br.Right=4]="Right",br[br.Horizontal=5]="Horizontal",br[br.RightTop=6]="RightTop",br[br.HorizontalTop=7]="HorizontalTop",br[br.Bottom=8]="Bottom",br[br.LeftBottom=9]="LeftBottom",br[br.Vertical=10]="Vertical",br[br.LeftVertical=11]="LeftVertical",br[br.RightBottom=12]="RightBottom",br[br.HorizontalBottom=13]="HorizontalBottom",br[br.RightVertical=14]="RightVertical",br[br.All=15]="All",t(Sr,"tile"),t(Rr,"addLevel"),t(Mr,"agent"),t(Tr,"record"),t(Fr,"isFocused"),t(Br,"destroy");let Pr=Le.root.add.bind(Le.root),Ir=Le.root.readd.bind(Le.root),Cr=Le.root.removeAll.bind(Le.root),Ur=Le.root.get.bind(Le.root);function Dr(e=2,t=1){let n=0;return{id:"boom",require:["scale"],update(){let r=Math.sin(n*e)*t;r<0&&this.destroy(),this.scale=c(r),n+=un()}}}t(Dr,"boom");let kr=$e(null,"data:image/png;base64,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"),Lr=$e(null,"data:image/png;base64,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");function Nr(e,t={}){let n=Pr([qn(e),dr()]),r=5*(t.speed||1),i=t.scale||1;n.add([er(Lr),Kn(0),Xn("center"),Dr(r,i),...t.comps??[]]);let s=n.add([er(kr),Kn(0),Xn("center"),or(),...t.comps??[]]);return s.wait(.4/r,(()=>s.use(Dr(r,i)))),s.onDestroy((()=>n.destroy())),n}function Or(){Le.root.update()}t(Nr,"addKaboom"),t(Or,"updateFrame");class Gr{source;target;displacement;resolved=!1;constructor(e,t,n,r=!1){this.source=e,this.target=t,this.displacement=n,this.resolved=r}reverse(){return new Gr(this.target,this.source,this.displacement.scale(-1),this.resolved)}hasOverlap(){return!this.displacement.isZero()}isLeft(){return this.displacement.x>0}isRight(){return this.displacement.x<0}isTop(){return this.displacement.y>0}isBottom(){return this.displacement.y<0}preventResolution(){this.resolved=!0}}function qr(){let n={},r=e.hashGridSize||64,i=new V,s=[];function o(e){if(s.push(i.clone()),e.pos&&i.translate(e.pos),e.scale&&i.scale(e.scale),e.angle&&i.rotate(e.angle),e.transform=i.clone(),e.c("area")&&!e.paused){let t=e,i=t.worldArea().bbox(),s=Math.floor(i.pos.x/r),o=Math.floor(i.pos.y/r),a=Math.ceil((i.pos.x+i.width)/r),h=Math.ceil((i.pos.y+i.height)/r),l=new Set;for(let e=s;e<=a;e++)for(let r=o;r<=h;r++)if(n[e])if(n[e][r]){let i=n[e][r];e:for(let e of i){if(!e.exists()||l.has(e.id))continue;for(let n of t.collisionIgnore)if(e.is(n))continue e;for(let n of e.collisionIgnore)if(t.is(n))continue e;let n=H(t.worldArea(),e.worldArea());if(n){let r=new Gr(t,e,n);t.trigger("collideUpdate",e,r);let i=r.reverse();i.resolved=r.resolved,e.trigger("collideUpdate",t,i)}l.add(e.id)}i.push(t)}else n[e][r]=[t];else n[e]={},n[e][r]=[t]}e.children.forEach(o),i=s.pop()}t(o,"checkObj"),o(Le.root)}function Kr(){let e=Le.cam,t=d.fromAngle(S(0,360)).scale(e.shake);e.shake=a(e.shake,0,5*un()),e.transform=(new V).translate(xr()).scale(e.scale).rotate(e.angle).translate((e.pos??xr()).scale(-1).add(t)),Le.root.draw(),Et()}function Yr(){let e=Oe();Le.events.numListeners("loading")>0?Le.events.trigger("loading",e):zt((()=>{let t=nn()/2,n=c(nn()/2,rn()/2).sub(c(t/2,12));Lt({pos:c(0),width:nn(),height:rn(),color:g(0,0,0)}),Lt({pos:n,width:t,height:24,fill:!1,outline:{width:4}}),Lt({pos:n,width:t*e,height:24})}))}function Hr(e,t){zt((()=>{let n=c(8);Pt(),Tt(e);let r=$t({text:t,font:Ee,size:16,pos:n,color:g(255,255,255),fixed:!0}),i=r.width+2*n.x,s=r.height+2*n.x;e.x+i>=nn()&&Tt(c(-i,0)),e.y+s>=rn()&&Tt(c(0,-s)),Lt({width:i,height:s,color:g(0,0,0),radius:4,opacity:.8,fixed:!0}),tn(r),It()}))}function jr(){if(ln.inspect){let e=null;for(let t of Le.root.get("*",{recursive:!0}))if(t.c("area")&&t.isHovering()){e=t;break}if(Le.root.drawInspect(),e){let t=[],n=e.inspect();for(let e in n)n[e]?t.push(`${e}: ${n[e]}`):t.push(`${e}`);Hr(an(hn()),t.join("\n"))}Hr(c(8),`FPS: ${ln.fps()}`)}ln.paused&&zt((()=>{Pt(),Tt(nn(),0),Tt(-8,8),Lt({width:32,height:32,anchor:"topright",color:g(0,0,0),opacity:.8,radius:4,fixed:!0});for(let e=1;e<=2;e++)Lt({width:4,height:19.2,anchor:"center",pos:c(-32/3*e,16),color:g(255,255,255),radius:2,fixed:!0});It()})),1!==ln.timeScale&&zt((()=>{Pt(),Tt(nn(),rn()),Tt(-8,-8);let e=$t({text:ln.timeScale.toFixed(1),font:Ee,size:16,color:g(255,255,255),pos:c(-8),anchor:"botright",fixed:!0});Lt({width:e.width+16+32,height:e.height+16,anchor:"botright",color:g(0,0,0),opacity:.8,radius:4,fixed:!0});for(let t=0;t<2;t++){let n=ln.timeScale<1;Gt({p1:c(-e.width-8*(n?2:3.5),-8),p2:c(-e.width-8*(n?2:3.5),-8-e.height),p3:c(-e.width-8*(n?3.5:2),-8-e.height/2),pos:c(8*-t*1+(n?-4:0),0),color:g(255,255,255),fixed:!0})}tn(e),It()})),ln.curRecording&&zt((()=>{Pt(),Tt(0,rn()),Tt(24,-24),qt({radius:12,color:g(255,0,0),opacity:v(0,1,4*Z.time()),fixed:!0}),It()})),ln.showLog&&Le.logs.length>0&&zt((()=>{Pt(),Tt(0,rn()),Tt(8,-8);let e=$t({text:Le.logs.join("\n"),font:Ee,pos:c(8,-8),anchor:"botleft",size:16,width:.6*nn(),lineSpacing:4,fixed:!0,styles:{time:{color:g(127,127,127)},info:{color:g(255,255,255)},error:{color:g(255,0,127)}}});Lt({width:e.width+16,height:e.height+16,anchor:"botleft",color:g(0,0,0),radius:4,opacity:.8,fixed:!0}),tn(e),It()}))}function Qr(e){Le.events.on("loading",e)}function Xr(e){Z.onResize(e)}function zr(e){Le.events.on("error",e)}function Jr(e){Z.run((()=>{zt((()=>{let t=nn(),n=rn(),r={size:36,width:t-64,letterSpacing:4,lineSpacing:4,font:Ee,fixed:!0};Lt({width:t,height:n,color:g(0,0,255),fixed:!0});let i=$t({...r,text:e.name,pos:c(32),color:g(255,128,0),fixed:!0});tn(i),en({...r,text:e.message,pos:c(32,32+i.height+16),fixed:!0}),It(),Le.events.trigger("error",e)}))}))}function Wr(e){ae.push(e)}function Zr(){Le.events.onOnce("frameEnd",(()=>{Z.quit();for(let e in sn)window.removeEventListener(e,sn[e]);he.clear(he.COLOR_BUFFER_BIT|he.DEPTH_BUFFER_BIT|he.STENCIL_BUFFER_BIT);let e=he.getParameter(he.MAX_TEXTURE_IMAGE_UNITS);for(let t=0;t<e;t++)he.activeTexture(he.TEXTURE0+t),he.bindTexture(he.TEXTURE_2D,null),he.bindTexture(he.TEXTURE_CUBE_MAP,null);he.bindBuffer(he.ARRAY_BUFFER,null),he.bindBuffer(he.ELEMENT_ARRAY_BUFFER,null),he.bindRenderbuffer(he.RENDERBUFFER,null),he.bindFramebuffer(he.FRAMEBUFFER,null),ae.forEach((e=>e())),he.deleteBuffer(fe.vbuf),he.deleteBuffer(fe.ibuf)}))}function _r(e,t,n,r,i=we.linear){let s=0,o=[],h=yn((()=>{s+=un();let l=Math.min(s/n,1);r(a(e,t,i(l))),1===l&&(h.cancel(),r(t),o.forEach((e=>e())))}));return{get paused(){return h.paused},set paused(e){h.paused=e},onEnd(e){o.push(e)},then(e){return this.onEnd(e),this},cancel(){h.cancel()},finish(){h.cancel(),r(t),o.forEach((e=>e()))}}}t(Gr,"Collision"),t(qr,"checkFrame"),t(Kr,"drawFrame"),t(Yr,"drawLoadScreen"),t(Hr,"drawInspectText"),t(jr,"drawDebug"),!1!==e.debug&&Dn(),e.burp&&kn(),t(Qr,"onLoading"),t(Xr,"onResize"),t(zr,"onError"),t(Jr,"handleErr"),t(Wr,"onCleanup"),t(Zr,"quit"),t(_r,"tween");let $r=!0;function ei(){let t=B,n=he.drawingBufferWidth/t,r=he.drawingBufferHeight/t;if(Z.isFullscreen()){let e=window.innerWidth,t=window.innerHeight,i=n/r;if(e/t>i){let n=window.innerHeight*i;fe.viewport={x:(e-n)/2,y:0,width:n,height:t}}else{let n=window.innerWidth/i;fe.viewport={x:0,y:(t-n)/2,width:e,height:n}}}else if(e.letterbox){if(!e.width||!e.height)throw new Error("Letterboxing requires width and height defined.");let t=n/r,i=e.width/e.height;if(t>i){let e=r*i,t=(n-e)/2;fe.viewport={x:t,y:0,width:e,height:r}}else{let e=n/i,t=(r-e)/2;fe.viewport={x:0,y:t,width:n,height:e}}}else{if(e.stretch&&(!e.width||!e.height))throw new Error("Stretching requires width and height defined.");fe.viewport={x:0,y:0,width:n,height:r}}}Z.run((()=>{xt(),ke.loaded||1===Oe()&&!$r&&(ke.loaded=!0,Le.events.trigger("load")),!ke.loaded&&!1!==e.loadingScreen||$r?Yr():(ln.paused||Or(),qr(),Kr(),!1!==e.debug&&jr()),$r&&($r=!1),St(),Le.events.trigger("frameEnd")})),t(ei,"updateViewport"),Z.onResize((()=>{if(Z.isFullscreen())return;let t=e.width&&e.height;t&&!e.stretch&&!e.letterbox||(r.width=r.offsetWidth*B,r.height=r.offsetHeight*B,ei(),t||(fe.frameBuffer.free(),fe.frameBuffer=new ce(he.drawingBufferWidth,he.drawingBufferHeight),fe.width=he.drawingBufferWidth/B,fe.height=he.drawingBufferHeight/B))})),ei();let ti={VERSION:"3000.0.4",loadRoot:Ge,loadProgress:Oe,loadSprite:$e,loadSpriteAtlas:Ze,loadSound:it,loadBitmapFont:Je,loadFont:ze,loadShader:nt,loadShaderURL:rt,loadAseprite:tt,loadPedit:et,loadBean:st,loadJSON:Qe,load:Ne,getSprite:ot,getSound:at,getFont:ht,getBitmapFont:lt,getShader:ut,getAsset:dt,Asset:Ue,SpriteData:pe,SoundData:ge,width:nn,height:rn,center:xr,dt:un,time:Z.time,screenshot:Z.screenshot,record:Tr,isFocused:Fr,setCursor:Z.setCursor,getCursor:Z.getCursor,setCursorLocked:Z.setCursorLocked,isCursorLocked:Z.isCursorLocked,setFullscreen:Z.setFullscreen,isFullscreen:Z.isFullscreen,isTouchscreen:Z.isTouchscreen,onLoad:mr,onLoading:Qr,onResize:Xr,onGamepadConnect:Z.onGamepadConnect,onGamepadDisconnect:Z.onGamepadDisconnect,onError:zr,onCleanup:Wr,camPos:dn,camScale:cn,camRot:fn,shake:pn,toScreen:gn,toWorld:mn,setGravity:Ln,getGravity:Nn,setBackground:On,getBackground:Gn,getGamepads:Z.getGamepads,add:Pr,make:An,destroy:Br,destroyAll:Cr,get:Ur,readd:Ir,pos:qn,scale:Kn,rotate:Yn,color:Hn,opacity:Qn,anchor:Xn,area:_n,sprite:er,text:tr,rect:nr,circle:ir,uvquad:rr,outline:sr,body:ar,doubleJump:hr,shader:lr,timer:or,fixed:ur,stay:dr,health:cr,lifespan:fr,z:zn,move:Wn,offscreen:Zn,follow:Jn,state:pr,fadeIn:gr,tile:Sr,agent:Mr,on:Vn,onUpdate:yn,onDraw:En,onAdd:xn,onDestroy:bn,onClick:Fn,onCollide:Sn,onCollideUpdate:Rn,onCollideEnd:Mn,onHover:Bn,onHoverUpdate:Pn,onHoverEnd:In,onKeyDown:Z.onKeyDown,onKeyPress:Z.onKeyPress,onKeyPressRepeat:Z.onKeyPressRepeat,onKeyRelease:Z.onKeyRelease,onMouseDown:Z.onMouseDown,onMousePress:Z.onMousePress,onMouseRelease:Z.onMouseRelease,onMouseMove:Z.onMouseMove,onCharInput:Z.onCharInput,onTouchStart:Z.onTouchStart,onTouchMove:Z.onTouchMove,onTouchEnd:Z.onTouchEnd,onScroll:Z.onScroll,onGamepadButtonDown:Z.onGamepadButtonDown,onGamepadButtonPress:Z.onGamepadButtonPress,onGamepadButtonRelease:Z.onGamepadButtonRelease,onGamepadStick:Z.onGamepadStick,mousePos:hn,mouseDeltaPos:Z.mouseDeltaPos,isKeyDown:Z.isKeyDown,isKeyPressed:Z.isKeyPressed,isKeyPressedRepeat:Z.isKeyPressedRepeat,isKeyReleased:Z.isKeyReleased,isMouseDown:Z.isMouseDown,isMousePressed:Z.isMousePressed,isMouseReleased:Z.isMouseReleased,isMouseMoved:Z.isMouseMoved,isGamepadButtonPressed:Z.isGamepadButtonPressed,isGamepadButtonDown:Z.isGamepadButtonDown,isGamepadButtonReleased:Z.isGamepadButtonReleased,charInputted:Z.charInputted,loop:Un,wait:Cn,play:wt,volume:mt,burp:At,audioCtx:me.ctx,Timer:Ae,Line:O,Rect:G,Circle:q,Polygon:Y,Vec2:d,Color:p,Mat4:V,Quad:w,RNG:E,rand:S,randi:R,randSeed:b,vec2:c,rgb:g,hsl2rgb:m,quad:A,choose:T,chance:M,lerp:a,tween:_r,easings:we,map:h,mapc:l,wave:v,deg2rad:i,rad2deg:s,testLineLine:P,testRectRect:F,testRectLine:I,testRectPoint:C,testCirclePolygon:L,testLinePoint:U,testLineCircle:D,drawSprite:Dt,drawText:en,formatText:$t,drawRect:Lt,drawLine:Nt,drawLines:Ot,drawTriangle:Gt,drawCircle:qt,drawEllipse:Kt,drawUVQuad:Ct,drawPolygon:Yt,drawFormattedText:tn,drawMasked:jt,drawSubtracted:Qt,pushTransform:Pt,popTransform:It,pushTranslate:Tt,pushScale:Ft,pushRotate:Bt,pushMatrix:Mt,usePostEffect:bt,debug:ln,scene:wr,go:Ar,onSceneLeave:Vr,addLevel:Rr,getData:vr,setData:yr,download:$,downloadJSON:te,downloadText:ee,downloadBlob:ne,plug:Er,ASCII_CHARS:ve,canvas:Z.canvas(),addKaboom:Nr,LEFT:d.LEFT,RIGHT:d.RIGHT,UP:d.UP,DOWN:d.DOWN,RED:p.RED,GREEN:p.GREEN,BLUE:p.BLUE,YELLOW:p.YELLOW,MAGENTA:p.MAGENTA,CYAN:p.CYAN,WHITE:p.WHITE,BLACK:p.BLACK,quit:Zr,Event:X,EventHandler:J,EventController:Q};if(e.plugins&&e.plugins.forEach(Er),!1!==e.global)for(let e in ti)window[e]=ti[e];return Z.canvas().focus(),ti}),"default")({background:[255,204,204]}),loadSprite("block","/image/block1.png"),loadSprite("water","/image/water.png"),loadSprite("man","/image/mans.jpg"),loadSprite("bg","/image/bg.jpg"),loadSpriteAtlas("/image/hero.png",{left:{x:0,y:0,width:240,height:55,sliceX:5,anims:{idle:{from:0,to:4,speed:5,loop:!0}}},right:{x:0,y:45,width:240,height:55,sliceX:5,anims:{idle:{from:0,to:4,speed:5,loop:!0}}},runLeft:{x:0,y:90,width:384,height:55,sliceX:8,anims:{idle:{from:0,to:7,speed:15,loop:!0}}},runRight:{x:0,y:138,width:384,height:55,sliceX:8,anims:{idle:{from:0,to:7,speed:15,loop:!0}}},tireLeft:{x:0,y:185,width:240,height:55,sliceX:5,anims:{idle:{from:0,to:4,speed:5,loop:!0}}},tireRight:{x:0,y:240,width:240,height:55,sliceX:5,anims:{idle:{from:0,to:4,speed:5,loop:!0}}},jumpLeft:{x:0,y:285,width:240,height:55,sliceX:5,anims:{idle:{from:0,to:1,speed:5,loop:!0}}},jumpRight:{x:0,y:340,width:240,height:55,sliceX:5,anims:{idle:{from:0,to:1,speed:5,loop:!0}}}}),loadSpriteAtlas("image/monster1.png",{monster1Left:{}}),loadSpriteAtlas("/image/monster2.png",{monster2Left:{x:120,y:0,width:75,height:256,sliceY:4,anims:{idle:{from:0,to:3,speed:5,loop:!0}}}}),loadSpriteAtlas("/image/monster2Right.png",{monster2Right:{x:405,y:0,width:75,height:256,sliceY:4,anims:{idle:{from:0,to:3,speed:5,loop:!0}}}}),loadSpriteAtlas("/image/monster1.png",{monster1Left:{x:120,y:0,width:75,height:256,sliceY:4,anims:{idle:{from:0,to:3,speed:5,loop:!0}}}}),loadSpriteAtlas("/image/monster1Right.png",{monster1Right:{x:405,y:0,width:75,height:256,sliceY:4,anims:{idle:{from:0,to:3,speed:5,loop:!0}}}}),loadSpriteAtlas("/image/monster3.png",{monster3Right:{x:13,y:74,width:455,height:30,sliceX:7,anims:{idle:{from:0,to:6,speed:7,loop:!0}}},monster3Left:{x:13,y:211,width:455,height:33,sliceX:7,anims:{idle:{from:0,to:6,speed:7,loop:!0}}}});let Ue=0;scene("game",(()=>{add([sprite("bg"),scale(width()/580,height()/290)]),setGravity(1800),add([rect(width(),130),pos(0,height()-130),outline(4),area(),body({isStatic:!0}),color(0,0,1)]);const e=add([sprite("right",{anim:"idle"}),pos(width()/2,200),area(),scale(2),body(),"man"],2,2),t=360,n=200;let r="RIGHT";const i=add([text(0),pos(12,72),fixed(),{time:0}]);i.onUpdate((()=>{i.time+=dt(),i.text=i.time.toFixed(1)}));let s=0,o=0;onKeyPress("up",(()=>{e.isGrounded()&&e.jump()})),onKeyDown("right",(()=>{0===o&&e.use(sprite("runRight",{anim:"idle"})),e.move(t,0),r="RIGHT",o=1,s=0})),onKeyDown("left",(()=>{0===s&&e.use(sprite("runLeft",{anim:"idle"})),e.move(-360,0),r="LEFT",o=0,s=1})),onKeyPress("space",(()=>{var t;0===s&&0===o&&("RIGHT"===r?e.use(sprite("tireRight",{anim:"idle"})):e.use(sprite("tireLeft",{anim:"idle"})),["space"].forEach((t=>{onKeyRelease(t,(()=>{"RIGHT"===r?e.use(sprite("right",{anim:"idle"})):e.use(sprite("left",{anim:"idle"}))}))}))),o=0,s=0,t=e.pos.sub(0,-40),"LEFT"===r?add([rect(15,6),area(),pos(t),anchor("center"),color(127,127,255),outline(1),move(LEFT,1200),offscreen({destroy:!0}),"bullet"]):add([rect(15,6),area(),pos(t),anchor("center"),color(127,127,255),outline(1),move(RIGHT,1200),offscreen({destroy:!0}),"bullet"])})),["left","right"].forEach((t=>{onKeyRelease(t,(()=>{"RIGHT"===r?(e.use(sprite("right",{anim:"idle"})),o=0,s=0):(e.use(sprite("left",{anim:"idle"})),o=0,s=0)}))})),function e(){1===Math.floor(2*Math.random())?(add([sprite("monster3Left",{anim:"idle"}),scale(2),pos(width(),height()-120),anchor("bot"),move(LEFT,t),"tree"]),add([rect(12,68),area(),pos(width(),height()-95),anchor("bot"),opacity(0),move(LEFT,t),"tree"])):(add([sprite("monster3Right",{anim:"idle"}),scale(2),pos(-width(),height()-120),anchor("bot"),move(RIGHT,t),"tree"]),add([rect(12,68),area(),pos(-width(),height()-95),anchor("bot"),opacity(0),move(RIGHT,t),"tree"])),wait(rand(2,3),e)}(),function e(){let t=Math.floor(2*Math.random());if(0===Math.floor(2*Math.random()))if(0===t){let e=add([sprite("monster1Right",{anim:"idle"}),scale(2),area(),pos(0,20),body(),move(RIGHT,n),"enemy"]);e.onCollide("bullet",(t=>{destroy(e),destroy(t)}))}else{let e=add([sprite("monster1Left",{anim:"idle"}),scale(2),area(),pos(width(),20),body(),move(LEFT,n),"enemy"]);e.onCollide("bullet",(t=>{destroy(e),destroy(t)}))}else if(0===t){let e=add([sprite("monster2Right",{anim:"idle"}),scale(2),area(),pos(0,20),body(),move(RIGHT,n),"enemy"]);e.onCollide("bullet",(t=>{destroy(e),destroy(t)}))}else{let e=add([sprite("monster2Left",{anim:"idle"}),scale(2),area(),pos(width(),20),body(),move(LEFT,n),"enemy"]);e.onCollide("bullet",(t=>{destroy(e),destroy(t)}))}wait(rand(1,3),e)}(),e.onCollide("tree",(()=>{shake(),l()})),e.onCollide("enemy",(e=>{shake(),l(),destroy(e)}));let a=3;const h=add([text(a),anchor("center"),pos(width()/2,80),fixed(),z(100)]);function l(){a--,h.text=a,0===a&&(go("end"),Ue=i.text)}})),scene("end",(()=>{add([text("bravo votre score est de :"+Ue),pos(width()/2,height()/2),anchor("center")])})),go("game")})();